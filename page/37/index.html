<!doctype html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Double">
<meta property="og:url" content="http://yoursite.com/page/37/index.html">
<meta property="og:site_name" content="Double">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Double">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/37/">





  <title>Double</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Double</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/22/Android/aidl/aidl_官方文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/22/Android/aidl/aidl_官方文档/" itemprop="url">AIDL 官方文档</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-22T13:18:12+08:00">
                2016-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>AIDL (Android Interface Definition Language):用于进程间通讯.</p>
<h1 id="定义一个AIDL接口"><a href="#定义一个AIDL接口" class="headerlink" title="定义一个AIDL接口"></a>定义一个AIDL接口</h1><ol>
<li>Create the <code>.aidl</code> 文件:这个文件内定义了相关的接口方法</li>
<li>Implement the interface:实现上面定义的接口文件, 会自动生成<code>Stub</code>类并且实现了上面接口中定义的方法.</li>
<li>Expose the interface to client:向客户端提供接口, 创建一个<code>Service</code> 重写<code>onBind()</code>方法返回<code>Stub</code>类对象.</li>
</ol>
<h2 id="Create-the-aidl-文件"><a href="#Create-the-aidl-文件" class="headerlink" title="Create the .aidl 文件"></a>Create the .aidl 文件</h2><p>这个文件中定义一些方法,通过这些方法的返回值,获得数据, 默认支持的数据类型可以为:</p>
<ol>
<li>基本数据类型</li>
<li>String</li>
<li>CharSequence</li>
<li>List</li>
<li>Map</li>
</ol>
<p>其他自定义的类,需要导入.</p>
<h2 id="Implement-the-interface"><a href="#Implement-the-interface" class="headerlink" title="Implement the interface"></a>Implement the interface</h2><p>运行工程后会生成相应的<code>.java</code>文件,这个文件中有个内部类<code>Stub</code></p>
<p><code>Stub</code>类中有个方法<code>asInterface()</code>返回<code>IBinder</code>(在服务端调用<code>onServiceConnected()</code>方法的参数)</p>
<p>实现<code>.aidl</code>中定义的方法需要继承<code>Binder</code>接口(Stub)实现里面的方法,</p>
<pre><code>private final IRemoteService.Stub mBinder = new IRemoteService.Stub() {
    public int getPid(){ 
    return Process.myPid(); 
    } 
    public void basicTypes(int anInt, long aLong, boolean aBoolean,
    float aFloat, double aDouble, String aString) {
    // Does nothing 
    } 
}; 
</code></pre><p>这里的<code>mBinder</code>是<code>Stub</code>的实现类,</p>
<h2 id="Expose-the-interface-to-clients"><a href="#Expose-the-interface-to-clients" class="headerlink" title="Expose the interface to clients"></a>Expose the interface to clients</h2><p>通过服务来实现: 服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class RemoteService extends Service &#123;</span><br><span class="line">    @Override </span><br><span class="line">    public void onCreate() &#123; </span><br><span class="line">			super.onCreate(); </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override </span><br><span class="line">    public IBinder onBind(Intent intent) &#123;</span><br><span class="line">	// Return the interface </span><br><span class="line">	return mBinder;</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    private final IRemoteService.Stub mBinder = new IRemoteService.Stub() &#123;</span><br><span class="line">	public int getPid()&#123; </span><br><span class="line">	    return Process.myPid(); </span><br><span class="line">	&#125; </span><br><span class="line">	public void basicTypes(int anInt, long aLong, boolean aBoolean,</span><br><span class="line">	    float aFloat, double aDouble, String aString) &#123;</span><br><span class="line">	    // Does nothing </span><br><span class="line">	&#125; </span><br><span class="line">    &#125;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">IRemoteService mIRemoteService;</span><br><span class="line">private ServiceConnection mConnection = new ServiceConnection() &#123;</span><br><span class="line">    // Called when the connection with the service is established </span><br><span class="line">    public void onServiceConnected(ComponentName className, IBinder service) &#123;</span><br><span class="line">	// Following the example above for an AIDL interface, </span><br><span class="line">	// this gets an instance of the IRemoteInterface, which we can use to call on the service </span><br><span class="line">	mIRemoteService = IRemoteService.Stub.asInterface(service);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    // Called when the connection with the service disconnects unexpectedly </span><br><span class="line">    public void onServiceDisconnected(ComponentName className) &#123;</span><br><span class="line">	Log.e(TAG, &quot;Service has unexpectedly disconnected&quot;);</span><br><span class="line">	mIRemoteService = null;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="Passing-Objects-over-IPC"><a href="#Passing-Objects-over-IPC" class="headerlink" title="Passing Objects over IPC"></a>Passing Objects over IPC</h1><p>在进程间传递自己定义的对象, 需要对象的类实现序列化接口<code>Parcelable</code></p>
<h1 id="Calling-an-IPC-Method"><a href="#Calling-an-IPC-Method" class="headerlink" title="Calling an IPC Method"></a>Calling an IPC Method</h1><p>一个调用AIDL的类需要做的:</p>
<ol>
<li>和服务端相同的AIDL文件</li>
<li>Declare an instance of the IBinder interface (generated based on the AIDL).</li>
<li>实现<code>ServiceConnection</code></li>
<li>调用<code>Context.bindService()</code>,传入<code>ServiceConnextion</code>实现类</li>
<li>在<code>onServiceConnected()</code>方法中获取<code>IBinder</code>对象,<code>YourInterfaceName.Stub.asInterface((IBinder)service)</code></li>
<li>调用<code>IBinder</code>对象的方法,获取服务端的数据.</li>
<li>断开连接:<code>Context.unbindService()</code></li>
</ol>
<pre><code>public static class Binding extends Activity {
    /** The primary interface we will be calling on the service. */ 
    IRemoteService mService = null;
    /** Another interface we use on the service. */ 
    ISecondary mSecondaryService = null;

    Button mKillButton;
    TextView mCallbackText;

    private boolean mIsBound;

    /** 
     * Standard initialization of this activity.  Set up the UI, then wait 
     * for the user to poke it before doing anything. 
     */ 
    @Override 
    protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    setContentView(R.layout.remote_service_binding);

    // Watch for button clicks. 
    Button button = (Button)findViewById(R.id.bind);
    button.setOnClickListener(mBindListener);
    button = (Button)findViewById(R.id.unbind);
    button.setOnClickListener(mUnbindListener);
    mKillButton = (Button)findViewById(R.id.kill);
    mKillButton.setOnClickListener(mKillListener);
    mKillButton.setEnabled(false);

    mCallbackText = (TextView)findViewById(R.id.callback);
    mCallbackText.setText(&quot;Not attached.&quot;);
    } 

    /** 
     * Class for interacting with the main interface of the service. 
     */ 
    private ServiceConnection mConnection = new ServiceConnection() {
    public void onServiceConnected(ComponentName className,
        IBinder service) {
        // This is called when the connection with the service has been 
        // established, giving us the service object we can use to 
        // interact with the service.  We are communicating with our 
        // service through an IDL interface, so get a client-side 
        // representation of that from the raw service object. 
        mService = IRemoteService.Stub.asInterface(service);
        mKillButton.setEnabled(true);
        mCallbackText.setText(&quot;Attached.&quot;);

        // We want to monitor the service for as long as we are 
        // connected to it. 
        try { 
        mService.registerCallback(mCallback);
        } catch (RemoteException e) {
        // In this case the service has crashed before we could even 
        // do anything with it; we can count on soon being 
        // disconnected (and then reconnected if it can be restarted) 
        // so there is no need to do anything here. 
        } 

        // As part of the sample, tell the user what happened. 
        Toast.makeText(Binding.this, R.string.remote_service_connected,
            Toast.LENGTH_SHORT).show();
    } 

    public void onServiceDisconnected(ComponentName className) {
        // This is called when the connection with the service has been 
        // unexpectedly disconnected -- that is, its process crashed. 
        mService = null;
        mKillButton.setEnabled(false);
        mCallbackText.setText(&quot;Disconnected.&quot;);

        // As part of the sample, tell the user what happened. 
        Toast.makeText(Binding.this, R.string.remote_service_disconnected,
            Toast.LENGTH_SHORT).show();
    } 
    }; 

    /** 
     * Class for interacting with the secondary interface of the service. 
     */ 
    private ServiceConnection mSecondaryConnection = new ServiceConnection() {
    public void onServiceConnected(ComponentName className,
        IBinder service) {
        // Connecting to a secondary interface is the same as any 
        // other interface. 
        mSecondaryService = ISecondary.Stub.asInterface(service);
        mKillButton.setEnabled(true);
    } 

    public void onServiceDisconnected(ComponentName className) {
        mSecondaryService = null;
        mKillButton.setEnabled(false);
    } 
    }; 

    private OnClickListener mBindListener = new OnClickListener() {
    public void onClick(View v) {
        // Establish a couple connections with the service, binding 
        // by interface names.  This allows other applications to be 
        // installed that replace the remote service by implementing 
        // the same interface. 
        Intent intent = new Intent(Binding.this, RemoteService.class);
        intent.setAction(IRemoteService.class.getName());
        bindService(intent, mConnection, Context.BIND_AUTO_CREATE);
        intent.setAction(ISecondary.class.getName());
        bindService(intent, mSecondaryConnection, Context.BIND_AUTO_CREATE);
        mIsBound = true;
        mCallbackText.setText(&quot;Binding.&quot;);
    } 
    }; 

    private OnClickListener mUnbindListener = new OnClickListener() {
    public void onClick(View v) {
        if (mIsBound) {
        // If we have received the service, and hence registered with 
        // it, then now is the time to unregister. 
        if (mService != null) {
            try { 
                mService.unregisterCallback(mCallback);
            } catch (RemoteException e) {
                // There is nothing special we need to do if the service 
                // has crashed. 
            } 
        } 

        // Detach our existing connection. 
        unbindService(mConnection);
        unbindService(mSecondaryConnection);
        mKillButton.setEnabled(false);
        mIsBound = false;
        mCallbackText.setText(&quot;Unbinding.&quot;);
        } 
    } 
    }; 

    private OnClickListener mKillListener = new OnClickListener() {
    public void onClick(View v) {
        // To kill the process hosting our service, we need to know its 
        // PID.  Conveniently our service has a call that will return 
        // to us that information. 
        if (mSecondaryService != null) {
        try { 
            int pid = mSecondaryService.getPid();
            // Note that, though this API allows us to request to 
            // kill any process based on its PID, the kernel will 
            // still impose standard restrictions on which PIDs you 
            // are actually able to kill.  Typically this means only 
            // the process running your application and any additional 
            // processes created by that app as shown here; packages 
            // sharing a common UID will also be able to kill each 
            // other&apos;s processes. 
            Process.killProcess(pid);
            mCallbackText.setText(&quot;Killed service process.&quot;);
        } catch (RemoteException ex) {
            // Recover gracefully from the process hosting the 
            // server dying. 
            // Just for purposes of the sample, put up a notification. 
            Toast.makeText(Binding.this,
                    R.string.remote_call_failed,
                    Toast.LENGTH_SHORT).show();
        } 
        } 
    } 
    }; 

    // ---------------------------------------------------------------------- 
    // Code showing how to deal with callbacks. 
    // ---------------------------------------------------------------------- 

    /** 
     * This implementation is used to receive callbacks from the remote 
     * service. 
     */ 
    private IRemoteServiceCallback mCallback = new IRemoteServiceCallback.Stub() {
    /** 
     * This is called by the remote service regularly to tell us about 
     * new values.  Note that IPC calls are dispatched through a thread 
     * pool running in each process, so the code executing here will 
     * NOT be running in our main thread like most other things -- so, 
     * to update the UI, we need to use a Handler to hop over there. 
     */ 
    public void valueChanged(int value) {
        mHandler.sendMessage(mHandler.obtainMessage(BUMP_MSG, value, 0));
    } 
    }; 

    private static final int BUMP_MSG = 1;

    private Handler mHandler = new Handler() { 
    @Override public void handleMessage(Message msg) { 
        switch (msg.what) { 
        case BUMP_MSG: 
            mCallbackText.setText(&quot;Received from service: &quot; + msg.arg1); 
            break; 
        default: 
            super.handleMessage(msg); 
        } 
    } 

    }; 
}     
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/17/ReadNote/Android开发艺术探索/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/17/ReadNote/Android开发艺术探索/" itemprop="url">Android 开发艺术探秘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-17T13:18:12+08:00">
                2016-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Activity-的生命周期和启动模式"><a href="#Activity-的生命周期和启动模式" class="headerlink" title="Activity 的生命周期和启动模式"></a>Activity 的生命周期和启动模式</h1><p>Activity 生命周期分为两个部分:</p>
<ol>
<li>典型情况:正常使用过程中Activity的生命周期的改变.</li>
<li>异常情况:Activity被系统回收,设备的Configuration发生改变.</li>
</ol>
<h2 id="典型情况的Activity生命周期"><a href="#典型情况的Activity生命周期" class="headerlink" title="典型情况的Activity生命周期"></a>典型情况的Activity生命周期</h2><p>七个生命周期</p>
<ol>
<li><code>onCreate()</code>:布局初始化,数据加载</li>
<li><code>onRestart()</code>:在<code>onStop()</code>–&gt;<code>onStart()</code></li>
<li><code>onStart()</code>:activity还在后台</li>
<li><code>onResume()</code>:activity出现在前台,可以和用户进行交互</li>
<li><code>onPause()</code>:activity在前台, 不宜进行大量的耗时操作</li>
<li><code>onStop()</code>:activity回到后台</li>
<li><code>onDestroy()</code>:activity被销毁</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/07/17/ReadNote/Android开发艺术探索/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/16/ReadNote/设计模式/创建者模式/设计模式之蝉-抽象工厂模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/16/ReadNote/设计模式/创建者模式/设计模式之蝉-抽象工厂模式/" itemprop="url">设计模式之蝉 - 抽象工厂方法模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-16T21:38:14+08:00">
                2016-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><h2 id="产品类"><a href="#产品类" class="headerlink" title="产品类"></a>产品类</h2><p>Human 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Human</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSex</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>人种抽象类：包含对肤色，语言的定义</p>
<p>白色人种：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractWhiteHuman</span> <span class="keyword">implements</span> <span class="title">Human</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"白色人种的肤色是白色的！"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"英语"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>黑色人种，黄色人种类似。</p>
<p>每个人种都有两个实现类，定义性别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FemaleYellowHuman</span> <span class="keyword">extends</span> <span class="title">AbstractYellowHuman</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSex</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Female"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MaleYellowHuman</span></span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/07/16/ReadNote/设计模式/创建者模式/设计模式之蝉-抽象工厂模式/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/12/Android/测试/单元测试-开始/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/12/Android/测试/单元测试-开始/" itemprop="url">单元测试-开始</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-12T13:18:12+08:00">
                2016-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是单元测试"><a href="#什么是单元测试" class="headerlink" title="什么是单元测试"></a>什么是单元测试</h1><p>单元测试是为了测试某一个代码单元而写的测试代码。</p>
<p>单元测试，是为了测试某一个类的某一个方法能否正常工作，而写的测试代码。</p>
<p>测试通常分3步骤：</p>
<ol>
<li>setup: 准备前提条件，比如 创建需要被测试的对象</li>
<li>执行操作：使用被测试对象的测试方法</li>
<li>验证结果：测试对象的测试方法执行结果是不是和我们期望的一样</li>
</ol>
<p>常见的 java 单元测试框架： JUnit，TestNG 等</p>
<h1 id="JUnit单元测试框架的使用"><a href="#JUnit单元测试框架的使用" class="headerlink" title="JUnit单元测试框架的使用"></a>JUnit单元测试框架的使用</h1><p>测试有返回值的方法，对于没有返回值的方法使用 Mockito</p>
<h2 id="方法修饰符"><a href="#方法修饰符" class="headerlink" title="方法修饰符"></a>方法修饰符</h2><ul>
<li><code>@Before</code>: 每个测试方法执行前都会执行一次</li>
<li><p><code>@Test</code></p>
<p>  添加允许的异常，比如：<code>@Test(expected = IllegalArgumentException.class)</code> 表示测试方法抛出 IllegalArgumentException 属于正常现象</p>
</li>
<li><p><code>@After</code></p>
</li>
<li><code>@BeforeClass</code>: 只能修饰静态方法，在测试类测试开始时执行一次</li>
<li><p><code>@AfterClass</code>: 只能修饰静态方法</p>
</li>
<li><p><code>@Ignore(String s)</code>: 表示这个测试方法不进行测试，比如 “not implemented yet”，方法未实现的时候</p>
<h2 id="断言方法验证结果"><a href="#断言方法验证结果" class="headerlink" title="断言方法验证结果"></a>断言方法验证结果</h2></li>
<li><p><code>assertEquals(expected, actual)</code></p>
</li>
<li><code>assertEquals(expexted, actual, tolerance)</code>: 参数3表示两个数的允许偏差值</li>
<li><code>assertTrue(boolean condition)</code></li>
<li><code>assertFalse(boolean condition</code></li>
<li><code>assertNull(Object obj)</code></li>
<li><code>assertNotNull(Object obj)</code></li>
<li><code>assertSame(expected, actual)</code></li>
<li><code>assertNotSame(experted, actual)</code></li>
<li><code>fail()</code>: 让测试方法失败</li>
</ul>
<p><strong><em>注意：</em></strong>上面的所有方法都有一个重载方法，可以在前面加个 String 参数作为错误提示。 比如：<code>assertEquals(&quot;Current user Id should be 1&quot;, 1, currentUser.id());</code></p>
<h1 id="Mockito-使用"><a href="#Mockito-使用" class="headerlink" title="Mockito 使用"></a>Mockito 使用</h1><p>mock：创建一个类的虚假的对象，在测试环境中，用来替换掉真实的对象</p>
<p>Mock 通常作用：</p>
<ol>
<li>验证这个对象的某些方法的调用情况，调用了多少次，参数是什么等等</li>
<li>指定这个对象的某些方法的行为，返回特定的值，或者是执行特定的动作</li>
</ol>
<p>Mockito 是一个 Mock 框架</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>需要测试的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span> || username.length() == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (password == <span class="keyword">null</span> || password.length() &lt; <span class="number">6</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    mUserManager.performLogin(username, password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要验证 <code>performLogin</code> 是否执行了</p>
<p>测试代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogin</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    UserManager mockUserManager = Mockito.mock(UserManager<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    LoginPresenter loginPresenter = <span class="keyword">new</span> LoginPresenter();</span><br><span class="line">    loginPresenter.setUserManager(mockUserManager);  <span class="comment">//&lt;==</span></span><br><span class="line"></span><br><span class="line">    loginPresenter.login(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang password"</span>);</span><br><span class="line"></span><br><span class="line">    Mockito.verify(mockUserManager).performLogin(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang password"</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用 Mockito 验证对象方法调用情况的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.verify(userManager).performLogin(<span class="string">"name"</span>, <span class="string">"password"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="验证方法调用"><a href="#验证方法调用" class="headerlink" title="验证方法调用"></a>验证方法调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.verify(mockUserManager).performLogin(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang password"</span>);</span><br></pre></td></tr></table></figure>
<p>验证方法调用次数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.verify(mockUserManager, Mockito.times(<span class="number">1</span>)).performLogin(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang password"</span>);</span><br></pre></td></tr></table></figure>
<p>验证次数：最多，最少，不执行：<code>atMost(count)</code>, <code>atLeast(count)</code>, <code>nerver()</code></p>
<p>不管参数的验证：<code>any</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.verify(mockUserManager).performLogin(Mockito.anyString(), Mockito.anyString());</span><br></pre></td></tr></table></figure>
<ul>
<li><code>anyString()</code></li>
<li><code>anyInt</code></li>
<li>….</li>
</ul>
<h3 id="指定-mock-对象的某些方法的行为"><a href="#指定-mock-对象的某些方法的行为" class="headerlink" title="指定 mock 对象的某些方法的行为"></a>指定 mock 对象的某些方法的行为</h3><h4 id="执行方法返回值"><a href="#执行方法返回值" class="headerlink" title="执行方法返回值"></a>执行方法返回值</h4><p>例子：测试代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span> || username.length() == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//假设我们对密码强度有一定要求，使用一个专门的validator来验证密码的有效性</span></span><br><span class="line">    <span class="keyword">if</span> (mPasswordValidator.verifyPassword(password)) <span class="keyword">return</span>;  <span class="comment">//&lt;==</span></span><br><span class="line"></span><br><span class="line">    mUserManager.performLogin(<span class="keyword">null</span>, password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码中需要考虑：密码的验证方法可能需要联网，我们通过 mock 让这个方法返回 true／false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.when(mockObject.targetMethod(args)).thenReturn(desiredReturnValue);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先创建一个mock对象</span></span><br><span class="line">PasswordValidator mockValidator = Mockito.mock(PasswordValidator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当调用mockValidator的verifyPassword方法，同时传入"xiaochuang_is_handsome"时，返回true</span></span><br><span class="line">Mockito.when(mockValidator.verifyPassword(<span class="string">"xiaochuang_is_handsome"</span>)).thenReturn(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//当调用mockValidator的verifyPassword方法，同时传入"xiaochuang_is_not_handsome"时，返回false</span></span><br><span class="line">Mockito.when(validator.verifyPassword(<span class="string">"xiaochuang_is_not_handsome"</span>)).thenReturn(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<h4 id="指定方法执行特定动作"><a href="#指定方法执行特定动作" class="headerlink" title="指定方法执行特定动作"></a>指定方法执行特定动作</h4><p>例子：测试代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginCallbackVersion</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span> || username.length() == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//假设我们对密码强度有一定要求，使用一个专门的validator来验证密码的有效性</span></span><br><span class="line">    <span class="keyword">if</span> (mPasswordValidator.verifyPassword(password)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//login的结果将通过callback传递回来。</span></span><br><span class="line">    mUserManager.performLogin(username, password, <span class="keyword">new</span> NetworkCallback() &#123;  <span class="comment">//&lt;==</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//update view with data</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> code, String msg)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//show error msg</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>指定 mock 对象执行特定的动作的写法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mockito.doAnswer(desiredAnswer).when(mockObject).targetMethod(args);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> Mockito.doAnswer(<span class="keyword">new</span> Answer() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//这里可以获得传给performLogin的参数</span></span><br><span class="line">        Object[] arguments = invocation.getArguments();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//callback是第三个参数</span></span><br><span class="line">        NetworkCallback callback = (NetworkCallback) arguments[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        callback.onFailure(<span class="number">500</span>, <span class="string">"Server error"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).when(mockUserManager).performLogin(anyString(), anyString(), any(NetworkCallback<span class="class">.<span class="keyword">class</span>))</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Spy"><a href="#Spy" class="headerlink" title="Spy"></a>Spy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假设目标类的实现是这样的</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PasswordValidator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verifyPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"xiaochuang_is_handsome"</span>.equals(password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//跟创建mock类似，只不过调用的是spy方法，而不是mock方法。spy的用法</span></span><br><span class="line">    PasswordValidator spyValidator = Mockito.spy(PasswordValidator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在默认情况下，spy对象会调用这个类的真实逻辑，并返回相应的返回值，这可以对照上面的真实逻辑</span></span><br><span class="line">    spyValidator.verifyPassword(<span class="string">"xiaochuang_is_handsome"</span>); <span class="comment">//true</span></span><br><span class="line">    spyValidator.verifyPassword(<span class="string">"xiaochuang_is_not_handsome"</span>); <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//spy对象的方法也可以指定特定的行为</span></span><br><span class="line">    Mockito.when(spyValidator.verifyPassword(anyString())).thenReturn(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//同样的，可以验证spy对象的方法调用情况</span></span><br><span class="line">    spyValidator.verifyPassword(<span class="string">"xiaochuang_is_handsome"</span>);</span><br><span class="line">    Mockito.verify(spyValidator).verifyPassword(<span class="string">"xiaochuang_is_handsome"</span>); <span class="comment">//pass</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>spy与mock的唯一区别就是默认行为不一样：spy对象的方法默认调用真实的逻辑，mock对象的方法默认什么都不做，或直接返回默认值。</p>
<h1 id="Robolectric"><a href="#Robolectric" class="headerlink" title="Robolectric"></a>Robolectric</h1><p>测试 Activity</p>
<p>参考:</p>
<ul>
<li><a href="http://www.jianshu.com/p/b2717dc245da" target="_blank" rel="noopener">http://www.jianshu.com/p/b2717dc245da</a></li>
<li><a href="http://www.jianshu.com/p/1d52fde638cf" target="_blank" rel="noopener">http://www.jianshu.com/p/1d52fde638cf</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/12/Android/测试/单元测试-基本教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/12/Android/测试/单元测试-基本教程/" itemprop="url">Mockito 单元测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-12T13:18:12+08:00">
                2016-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.vogella.com/tutorials/Mockito/article.html" target="_blank" rel="noopener">http://www.vogella.com/tutorials/Mockito/article.html</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如果你不了解JUnit查看下面的教程:<a href="http://www.vogella.com/tutorials/JUnit/article.html" target="_blank" rel="noopener">http://www.vogella.com/tutorials/JUnit/article.html</a></p>
<h1 id="使用-mock-对象-进行测试"><a href="#使用-mock-对象-进行测试" class="headerlink" title="使用 mock 对象 进行测试"></a>使用 mock 对象 进行测试</h1><h2 id="测试前提"><a href="#测试前提" class="headerlink" title="测试前提"></a>测试前提</h2><p>解耦</p>
<p>单元测试需要在隔离的情况下测试一个类. 来自其他类或者系统的影响应该消除. 为了消除来自其他类的影响,可以通过接口的方式来实现.</p>
<h2 id="不同测试类的分类"><a href="#不同测试类的分类" class="headerlink" title="不同测试类的分类"></a>不同测试类的分类</h2><p><em>dummy object</em> 会传递但是不会使用, 它的方法不会被调用, 可以用来填充方法的参数列表.</p>
<p><em>Fake objects’</em> 它在运行的时候不会使用实际的数据库,而是使用内存中临时创建的虚拟数据库.</p>
<p><em>stub class</em> 是接口或者类的部分实现,用来测试过程中运行. 响应外部的测试, 记录调用信息.</p>
<p><em>mock object</em> 是接口或者类的虚拟实现,</p>
<p><em>Text doubles</em>可以被传递到其他的测试对象中. 测试可以验证类的反馈是否正常.</p>
<p>Mock 对象的配置需要的代码少.</p>
<h2 id="Mock-对象生成"><a href="#Mock-对象生成" class="headerlink" title="Mock 对象生成"></a>Mock 对象生成</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/11/Android/Android 版本/Android5.0/design包/Behavior-低栏拉出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/11/Android/Android 版本/Android5.0/design包/Behavior-低栏拉出/" itemprop="url">CoordinatorLayout Behavior - 底栏拉出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-11T14:38:14+08:00">
                2016-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><ol>
<li>根布局为<code>CoordinatorLayout</code></li>
<li>正常布局占满整个屏幕</li>
<li><p>(可选) 添加一个底布局全部拉出的时候显示的头布局, 相关属性:</p>
<pre><code>&lt;RelativeLayout
android:id=&quot;@+id/design_bottom_sheet_bar&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;?attr/actionBarSize&quot;
android:background=&quot;@color/colorAccent&quot;
app:layout_anchor=&quot;@+id/design_bottom_sheet&quot;
app:layout_anchorGravity=&quot;top&quot;
android:layout_gravity=&quot;bottom&quot;
android:visibility=&quot;gone&quot;&gt;

&lt;TextView
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;点击收起BottomSheet&quot;
    android:textColor=&quot;#ffffff&quot;
    android:layout_centerInParent=&quot;true&quot;/&gt;

&lt;/RelativeLayout&gt;
</code></pre></li>
<li><p>可拉出的底布布局: 下面的<code>ImageView</code>为占位控件可替换成正常的布局控件,</p>
<pre><code>&lt;RelativeLayout
android:id=&quot;@+id/design_bottom_sheet&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;
android:minHeight=&quot;100dp&quot;
app:behavior_peekHeight=&quot;56dp&quot;
app:behavior_hideable=&quot;false&quot;
app:layout_behavior=&quot;@string/bottom_sheet_behavior&quot;
android:background=&quot;#ffffff&quot;
&gt;
&lt;TextView
    android:id=&quot;@+id/bottom_sheet_tv&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;56dp&quot;
    android:layout_centerHorizontal=&quot;true&quot;
    android:gravity=&quot;center&quot;
    android:text=&quot;这是一个BottomSheet&quot;/&gt;
&lt;ImageView
    android:id=&quot;@+id/bottom_sheet_iv&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;match_parent&quot;
    android:layout_centerInParent=&quot;true&quot;
    android:padding=&quot;10dp&quot;
    android:minHeight=&quot;100dp&quot;
    android:adjustViewBounds=&quot;true&quot;
    android:scaleType=&quot;centerInside&quot;
    android:layout_gravity=&quot;center&quot;/&gt;
&lt;/RelativeLayout&gt;
</code></pre></li>
<li><p>活动代码:</p>
<pre><code>private void initBehavior() {
mBehavior = BottomSheetBehavior.from(mDesignBottomSheet);
mBehavior.setBottomSheetCallback(new BottomSheetBehavior.BottomSheetCallback() {
    @Override
    public void onStateChanged(@NonNull View bottomSheet, int newState) {
        // if(newState!=BottomSheetBehavior.STATE_COLLAPSED&amp;&amp;bottom_sheet_tv.getVisibility()==View.VISIBLE){
        //  bottom_sheet_tv.setVisibility(View.GONE);    
        //bottom_sheet_iv.setVisibility(View.VISIBLE);
        //  }else if(newState==BottomSheetBehavior.STATE_COLLAPSED&amp;&amp;bottom_sheet_tv.getVisibility()==View.GONE){
        // bottom_sheet_tv.setVisibility(View.VISIBLE);
        //bottom_sheet_iv.setVisibility(View.GONE);
        //}

        if (newState == BottomSheetBehavior.STATE_COLLAPSED) {
            mDesignBottomSheetBar.setVisibility(View.GONE);
        } else if (newState == BottomSheetBehavior.STATE_EXPANDED) {
            mDesignBottomSheetBar.setVisibility(View.VISIBLE);
        }
    }

    /**
     * 滑动过程中
     * @param bottomSheet
     * @param slideOffset
     */
    @Override
    public void onSlide(@NonNull View bottomSheet, float slideOffset) {

        if (bottomSheet.getTop() &lt; 2 * mDesignBottomSheetBar.getHeight()) {
            mDesignBottomSheetBar.setVisibility(View.VISIBLE);
            mDesignBottomSheetBar.setAlpha(slideOffset);
            mDesignBottomSheetBar.setTranslationY(bottomSheet.getTop() - 2 * mDesignBottomSheetBar.getHeight());
        } else {
            mDesignBottomSheetBar.setVisibility(View.INVISIBLE);
        }
    }
});
}
</code></pre></li>
<li><p>修改底部拉出布局的高度:</p>
<pre><code>/**
 * 修改底部拉出布局的高度,流出标题栏的位置
 *
 * @param hasFocus
 */
@Override
public void onWindowFocusChanged(boolean hasFocus) {
super.onWindowFocusChanged(hasFocus);
//修改SetBottomSheet的高度 留出顶部工具栏的位置

// 下面的代码可以调整拉出的高度,也可以直接在布局中写死高度
if (!isSetBottomSheetHeight) {
    CoordinatorLayout.LayoutParams linearParams = (CoordinatorLayout.LayoutParams) mDesignBottomSheet.getLayoutParams();
    linearParams.height = mBaiduMapCoordinatorLayout.getHeight() - mDesignBottomSheetBar.getHeight();
    mDesignBottomSheet.setLayoutParams(linearParams);
    isSetBottomSheetHeight = true;//设置标记 只执行一次
}
}
</code></pre></li>
<li><p>点击折叠布局:</p>
<pre><code>@OnClick(R.id.design_bottom_sheet_bar)
public void onClick() {
mBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);
}
</code></pre></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/09/Android/权限管理/Android Permission--Requesting Permission at Run Time/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/09/Android/权限管理/Android Permission--Requesting Permission at Run Time/" itemprop="url">Android Permission--Requesting Permission at Run Time</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-09T13:18:12+08:00">
                2016-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Requesting-Permission-at-Run-Time"><a href="#Requesting-Permission-at-Run-Time" class="headerlink" title="Requesting Permission at Run Time"></a>Requesting Permission at Run Time</h1><p>官方地址:<a href="https://developer.android.com/training/permissions/requesting.html" target="_blank" rel="noopener">https://developer.android.com/training/permissions/requesting.html</a></p>
<p>Android 6.0 (API level 23) 开始</p>
<ol>
<li>app在运行的时候才会去获取权限,而不是在app安装的时候. 这个改进简化了app安装的步骤,因为app不需要在安装的时候去获取权限.</li>
<li>用户可以更多的控制app的功能:因为用户可以在设置中关闭app已经获取到的权限</li>
</ol>
<p>权限分为:普通权限和危险权限</p>
<p>在所有的Android版本中,上面的两种权限都需要在清单文件中声明(如果权限是属于需要声明的权限),但是不同的Android版本在权限声明后的作用是不用的:</p>
<ol>
<li>Android 6.0一下的版本,权限只要在清单文件中声明了,app正常安装就表示权限获取到了</li>
<li>Android 6.0及以上的版本,权限声明后,危险权限还需要在代码中重新进行申请,而且申请后的权限随时会被用户取消,所以在设计app的时候尽量保证没有获取到权限也能正常运行.</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/07/09/Android/权限管理/Android Permission--Requesting Permission at Run Time/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/03/Android/context/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/03/Android/context/" itemprop="url">Context</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-03T13:18:12+08:00">
                2016-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h1><h2 id="Context-使用"><a href="#Context-使用" class="headerlink" title="Context 使用"></a>Context 使用</h2><p><img src="http://i.stack.imgur.com/1o5MI.png" alt></p>
<h2 id="BaseApplication"><a href="#BaseApplication" class="headerlink" title="BaseApplication"></a>BaseApplication</h2><ol>
<li>Toast</li>
<li>数据库</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/02/Android/adb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/02/Android/adb/" itemprop="url">Android Debug Bridge</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-02T13:18:12+08:00">
                2016-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ADB-shell-记录"><a href="#ADB-shell-记录" class="headerlink" title="ADB shell 记录"></a>ADB shell 记录</h1><p>官方文档：<a href="https://developer.android.com/studio/command-line/adb#am" target="_blank" rel="noopener">https://developer.android.com/studio/command-line/adb#am</a></p>
<h2 id="查看设备信息"><a href="#查看设备信息" class="headerlink" title="查看设备信息"></a>查看设备信息</h2><p><code>adb devices -l</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List of devices attached</span><br><span class="line">ZX1G425DJL             device usb:336723968X product:nitrogen_shamu model:Nexus_6 device:shamu transport_id:15</span><br></pre></td></tr></table></figure>
<p>获取设备系统版本号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop ro.build.version.sdk</span><br><span class="line"></span><br><span class="line">27</span><br></pre></td></tr></table></figure>
<h2 id="查看包信息"><a href="#查看包信息" class="headerlink" title="查看包信息"></a>查看包信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys package</span><br><span class="line"></span><br><span class="line"># check version name</span><br><span class="line">adb shell dumpsys package com.yitoudai.wcg | grep versionName</span><br><span class="line"># check version code</span><br><span class="line">adb shell dumpsys package com.yitoudai.wcg | grep versionCode</span><br><span class="line"># checkout version</span><br><span class="line">adb shell dumpsys package com.yitoudai.wcg | grep version</span><br></pre></td></tr></table></figure>
<h2 id="dumpsys-power"><a href="#dumpsys-power" class="headerlink" title="dumpsys power"></a>dumpsys power</h2><p>查看当前电源使用，<br>Wake Locks: size=0：查看当前持有 wake locak的应用</p>
<h2 id="system-framework-中的文件修改权限"><a href="#system-framework-中的文件修改权限" class="headerlink" title="/system/framework/ 中的文件修改权限"></a>/system/framework/ 中的文件修改权限</h2><p>设置为读写</p>
<pre><code># mount -o rw,remount /system
</code></pre><p>设置为读（默认）</p>
<pre><code># mount -o ro,remount /system
</code></pre><h2 id="查看当前-Activity"><a href="#查看当前-Activity" class="headerlink" title="查看当前 Activity"></a>查看当前 Activity</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys window windows | grep -E &apos;mCurrentFocus|mFocusedApp&apos;</span><br></pre></td></tr></table></figure>
<h2 id="通过-adb-测试-Schema"><a href="#通过-adb-测试-Schema" class="headerlink" title="通过 adb 测试 Schema"></a>通过 adb 测试 Schema</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -a [action] -d [uri] [packagename]</span><br><span class="line"></span><br><span class="line">adb shell am start -a android.intent.action.VIEW -d &quot;custom-scheme://custom-host?itemId=17331&quot; com.juanbingteam.heheda</span><br></pre></td></tr></table></figure>
<h1 id="Android-Debug-Bridge-adb"><a href="#Android-Debug-Bridge-adb" class="headerlink" title="Android Debug Bridge (adb)"></a>Android Debug Bridge (adb)</h1><p>官网地址:<a href="https://developer.android.com/studio/command-line/adb.html#forwardports" target="_blank" rel="noopener">https://developer.android.com/studio/command-line/adb.html#forwardports</a></p>
<p><em>adb</em>是一个功能丰富的命令行工具,它让你能够和虚拟机或者Android设备交互.</p>
<p>是一个客户端-服务器类型的程序,包括:</p>
<ol>
<li>客户端:用来发送命令,它运行在电脑中,我们可以通过shell调用客户端.另外的Android工具比如DDMS也可以创建adb客户端.</li>
<li>守护进程:用于在设备中运行命令.它作为一个后台进程运行在虚拟机或者Android设备中</li>
<li>服务器:管理服务器和守护进程之间的交互.它作为后台进程运行在电脑中.</li>
</ol>
<p><em>adb</em>工具地址:<code>&lt;ask&gt;/platform-tools</code>(这个地址一般会配置环境变量)</p>
<h2 id="adb如何工作"><a href="#adb如何工作" class="headerlink" title="adb如何工作"></a>adb如何工作</h2><p>开启<em>adb客户端</em>的时候</p>
<ol>
<li>检查是否有已经运行的<em>adb 服务器</em>. 如果没有就创建服务器.<ul>
<li>服务器创建的时候会绑定一个<em>TCP 端口 5037</em></li>
<li>并且监听客户端发送出来的命令(客户端发送的所有命令都经过<em>5037</em>端口到达<em>adb server</em>)</li>
</ul>
</li>
<li><p>服务器连接所有正在运行的虚拟机/真机.</p>
<ul>
<li>服务器通过搜索端口<em>5555-5585</em>来搜索虚拟机/真机.</li>
<li>如果在端口中搜索到<em>守护进程</em>,就会建立到这个端口连接</li>
<li><p>每一个<em>5555-5585</em>的端口对应一个设备(如果有多个设备连接)</p>
<p>  Emulator 1, console: 5554<br>  Emulator 1, adb: 5555<br>  Emulator 2, console: 5556<br>  Emulator 2, adb: 5557<br>  and so on…</p>
</li>
</ul>
</li>
<li>连接成功后就可以使用adb命令控制设备了</li>
</ol>
<h2 id="启用adb"><a href="#启用adb" class="headerlink" title="启用adb"></a>启用adb</h2><ol>
<li>手机端开机<em>USB 调试</em></li>
<li>(可选)开启<em>应用未知来源</em></li>
<li>(可选)开启存储卡模式</li>
</ol>
<h2 id="adb命令-格式"><a href="#adb命令-格式" class="headerlink" title="adb命令 格式"></a>adb命令 格式</h2><pre><code>adb [-d|-e|-s &lt;serialNumber&gt;] &lt;command&gt;
</code></pre><h3 id="查询当前连接的设备"><a href="#查询当前连接的设备" class="headerlink" title="查询当前连接的设备"></a>查询当前连接的设备</h3><pre><code>adb devices
</code></pre><p>结果:</p>
<pre><code>[serialNumber] [state]
</code></pre><ul>
<li>Serial number:比如emulator-5554,格式<code>&lt;type&gt;-&lt;consolePort&gt;</code></li>
<li>State:offline/device/no device</li>
</ul>
<h3 id="执行命令的时候指定端口"><a href="#执行命令的时候指定端口" class="headerlink" title="执行命令的时候指定端口"></a>执行命令的时候指定端口</h3><pre><code>adb -s &lt;serialNumber&gt; &lt;command&gt;
</code></pre><p>比如:</p>
<pre><code>adb -s emulator-5556 install helloWorld.apk
</code></pre><h3 id="安装应用到设备"><a href="#安装应用到设备" class="headerlink" title="安装应用到设备"></a>安装应用到设备</h3><pre><code>adb install &lt;path_to_apk&gt;
</code></pre><h3 id="和设备文件交互"><a href="#和设备文件交互" class="headerlink" title="和设备文件交互"></a>和设备文件交互</h3><p>从设备中获取文件:</p>
<pre><code>adb pull &lt;remote&gt; &lt;local&gt;
</code></pre><p>发送文件到设备:</p>
<pre><code>adb push &lt;local&gt; &lt;remote&gt;
</code></pre><h3 id="停止adb-Server"><a href="#停止adb-Server" class="headerlink" title="停止adb Server"></a>停止adb Server</h3><pre><code>adb kill-server
</code></pre><h3 id="无线连接设备"><a href="#无线连接设备" class="headerlink" title="无线连接设备"></a>无线连接设备</h3><p><em>(如果通过usb连接设备出现 no serialNumber 的时候可以尝试下面的连接方式)</em></p>
<ol>
<li>手机和电脑在同一个wifi网下</li>
<li>连接usb线</li>
<li><code>$ adb tcpip 5555</code></li>
<li>断开usb</li>
<li>在手机<code>设置--&gt;关于--&gt;手机状态信息--&gt;IP地址</code></li>
<li><code>$ adb connect &lt;device-ip-address&gt;</code></li>
<li><code>$ adb devices</code></li>
</ol>
<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><h2 id="查看当前手机的应用"><a href="#查看当前手机的应用" class="headerlink" title="查看当前手机的应用"></a>查看当前手机的应用</h2><pre><code>adb shell pm list packages
</code></pre><h2 id="卸载应用"><a href="#卸载应用" class="headerlink" title="卸载应用"></a>卸载应用</h2><pre><code>adb uninstall [package name]
</code></pre><h2 id="清理-app-数据"><a href="#清理-app-数据" class="headerlink" title="清理 app 数据"></a>清理 app 数据</h2><pre><code>adb shell pm clear packageName
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/24/Android/数据解析/Gson-Tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/24/Android/数据解析/Gson-Tips/" itemprop="url">Gson Tips</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-06-24T21:18:12+08:00">
                2016-06-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为-POJO-字段提供备选属性名"><a href="#为-POJO-字段提供备选属性名" class="headerlink" title="为 POJO 字段提供备选属性名"></a>为 POJO 字段提供备选属性名</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@SerializedName(value = &quot;emailAddress&quot;, alternate = &#123;&quot;email&quot;, &quot;email_address&quot;&#125;)</span><br><span class="line">public String emailAddress;</span><br></pre></td></tr></table></figure>
<p>同时匹配多个字段</p>
<h1 id="一个字段自定义解析"><a href="#一个字段自定义解析" class="headerlink" title="一个字段自定义解析"></a>一个字段自定义解析</h1><p>由于后台返回数据格式变化：json <code>hot_left</code> 没有数据的时候属于数组，有数据的时候是对象。</p>
<p>下面可以解决这个问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OAJsonDe</span> <span class="keyword">implements</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">ImgEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ImgEntity <span class="title">deserialize</span><span class="params">(JsonElement json, Type typeOfT, JsonDeserializationContext context)</span> <span class="keyword">throws</span> JsonParseException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (json.isJsonArray()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Gson newGson = <span class="keyword">new</span> Gson();</span><br><span class="line">        <span class="keyword">return</span> newGson.fromJson(json, typeOfT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">@JsonAdapter</span>(value = OAJsonDe<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SerializedName</span>(<span class="title">value</span> </span>= <span class="string">"hot_left"</span>)</span><br><span class="line"><span class="keyword">public</span> ImgEntity hotLeft;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/36/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/38/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/head1.jpg" alt="Double">
          <p class="site-author-name" itemprop="name">Double</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">548</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">260</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Double</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
