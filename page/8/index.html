<!doctype html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Double">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="Double">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Double">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/">





  <title>Double</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Double</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/12/Android/优化/05.apk包大小优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/12/Android/优化/05.apk包大小优化/" itemprop="url">Apk 包 大小优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-12T21:03:14+08:00">
                2018-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h1><p>release 包开启混淆。</p>
<h1 id="资源文件优化"><a href="#资源文件优化" class="headerlink" title="资源文件优化"></a>资源文件优化</h1><p>图片使用 <code>https://tinypng.com</code> 压缩后放入工程中。</p>
<p>图片使用 <code>webp</code></p>
<p>gradle 开启 <code>shrinkResources true</code>.</p>
<p>在版本迭代的时候及时清理不用的图片资源。</p>
<h1 id="启用最小化功能（Minification）"><a href="#启用最小化功能（Minification）" class="headerlink" title="启用最小化功能（Minification）"></a>启用最小化功能（Minification）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled true</span><br><span class="line">            shrinkResources true</span><br><span class="line">            proguardFiles getDefaultProguardFile(</span><br><span class="line">              &apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置shrinkResources属性，将会在 APK 中移除任何并非直接引用的资源。这时如果我们使用反射机制间接地访问资源，就会导致问题</li>
<li>minifyEnabled 开启代码混淆</li>
</ul>
<h1 id="打包-签名优化"><a href="#打包-签名优化" class="headerlink" title="打包 签名优化"></a>打包 签名优化</h1><p>zip 对齐, <code>7zip 压缩</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 1. 创建一个未签名的 APK。</span><br><span class="line">./gradlew assembleRelease</span><br><span class="line"></span><br><span class="line"># 2. 解压缩归档文件。</span><br><span class="line">unzip app-release-unsigned.apk -d app</span><br><span class="line"></span><br><span class="line"># 对文件进行编辑。</span><br><span class="line"></span><br><span class="line"># 3. 压缩归档文件</span><br><span class="line">zip -r app app.zip</span><br><span class="line"></span><br><span class="line"># 4. 运行 zipalign。</span><br><span class="line">zipalign -v -p 4 app-release-unsigned.apk app-release-aligned.apk</span><br><span class="line"></span><br><span class="line"># 5. 使用 v2 签名运行 apksigner。</span><br><span class="line">apksigner sign --v1-signing-enabled false --ks $HOME/fake.jks --out signed-release.apk app-release-unsigned.apk</span><br><span class="line"></span><br><span class="line"># 6. 验证签名。</span><br><span class="line">apksigner verify signed-release.apk</span><br></pre></td></tr></table></figure>
<h1 id="去除-dex-包中的-debugItem"><a href="#去除-dex-包中的-debugItem" class="headerlink" title="去除 dex 包中的 debugItem"></a>去除 dex 包中的 debugItem</h1><p>实施难度大</p>
<p>参考：<a href="https://mp.weixin.qq.com/s/_gnT2kjqpfMFs0kqAg4Qig" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/_gnT2kjqpfMFs0kqAg4Qig</a></p>
<p>参考：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA3ODg4MDk0Ng==&amp;mid=2651113806&amp;idx=1&amp;sn=382593ac7607c743a4ea8830150ec21b&amp;chksm=844c6093b33be985f104bdb5fe8693a1cbd0ab1bf4feb9533635669a23036b3fa3d7f6ad0614#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzA3ODg4MDk0Ng==&amp;mid=2651113806&amp;idx=1&amp;sn=382593ac7607c743a4ea8830150ec21b&amp;chksm=844c6093b33be985f104bdb5fe8693a1cbd0ab1bf4feb9533635669a23036b3fa3d7f6ad0614#rd</a></li>
<li><a href="https://mp.weixin.qq.com/s/_gnT2kjqpfMFs0kqAg4Qig" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/_gnT2kjqpfMFs0kqAg4Qig</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/12/Android/features/埋点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/12/Android/features/埋点/" itemprop="url">埋点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-12T09:23:14+08:00">
                2018-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>埋点：对程序进行数据收集的方法。</p>
</blockquote>
<p>埋点通常可以分为下面3种：</p>
<ol>
<li>代码埋点：在需要收集数据的地方，添加收集数据的代码。</li>
<li>全埋点：在程序中全部的行为都进行数据收集。</li>
<li>可视化埋点：在全埋点的基础上，可以动态设置需要收集的行为规则。</li>
</ol>
<h1 id="代码埋点"><a href="#代码埋点" class="headerlink" title="代码埋点"></a>代码埋点</h1><p>代码埋点是最常见的埋点方式，比如我们在使用 umeng 做自定义时间统计的时候:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MobclickAgent.onEvent(mContext, &quot;Select&quot;, &quot;Channel&quot;);</span><br></pre></td></tr></table></figure>
<p>最差的方式: 当然是在所有需要的地方添加上面的代码。</p>
<p>稍微好点: 封装一个工具类</p>
<h1 id="全埋点"><a href="#全埋点" class="headerlink" title="全埋点"></a>全埋点</h1><p>全埋点通常通过 Hook 实现, Android 中常用方法：</p>
<ol>
<li>静态 Hook: AspectJ 实现 AOP, 编译期修改代码</li>
<li>动态 Hook: 运行时替换 View.OnClickListener 等事件</li>
</ol>
<p>通过反射方式将 View 中 OnClickListener 对象替换成自己实现的代理对象 OnClickListenerWrapper.</p>
<p>如何给所有 View 添加 Hook：</p>
<p>方法一：Activity 创建后遍历所有 View</p>
<p>方法二：<code>https://github.com/foolchen/AndroidTracker</code>， 使用这个库必须自己实现数据后台</p>
<h1 id="可视化埋点"><a href="#可视化埋点" class="headerlink" title="可视化埋点"></a>可视化埋点</h1><p>在全埋点的基础上，在后台可视化工具上设置哪些 View 的点击事件需要被收集.</p>
<p>参考：</p>
<ul>
<li><a href="http://unclechen.github.io/2017/12/18/Android%E5%9F%8B%E7%82%B9%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">http://unclechen.github.io/2017/12/18/Android%E5%9F%8B%E7%82%B9%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/</a></li>
<li><a href="http://blog.bugtags.com/2016/03/28/embrace-android-studio-gradle-plugin/" target="_blank" rel="noopener">http://blog.bugtags.com/2016/03/28/embrace-android-studio-gradle-plugin/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/java/orm/Hibernate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/java/orm/Hibernate/" itemprop="url">Hibernate 使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-06T21:18:12+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>介绍：Hibernate 是 dao 层框架，用于操作数据库，以面向对象的方式操作数据库。</p>
<p>orm 思想：对象关系映射，通过映射文件配置对象与数据库中表的关系。</p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><h2 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h2><p>命名固定：<code>hibernate.cfg.xml</code></p>
<p>格式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-configuration</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ..属性.. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 注册 orm mapping --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/passon/hibernate/domain/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>所有配置键值对在 sdk 地址 <code>hibernate-release-5.3.7.Final/project/etc/hibernate.properties</code> 中。</p>
<h3 id="必须配置项目"><a href="#必须配置项目" class="headerlink" title="必须配置项目"></a>必须配置项目</h3><p>数据库配置，以 mysql 为例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Drivr<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库url --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接用户名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接密码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>happy0224<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库方言</span></span><br><span class="line"><span class="comment">    不同的数据库中,sql语法略有区别. 指定方言可以让hibernate框架在生成sql语句时.针对数据库的方言生成.</span></span><br><span class="line"><span class="comment">    sql99标准: DDL 定义语言  库表的增删改查</span></span><br><span class="line"><span class="comment">                DCL 控制语言  事务 权限</span></span><br><span class="line"><span class="comment">                DML 操纵语言  增删改查</span></span><br><span class="line"><span class="comment">            注意: MYSQL在选择方言时,请选择最短的方言.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="可选配置项目"><a href="#可选配置项目" class="headerlink" title="可选配置项目"></a>可选配置项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 将hibernate生成的sql语句打印到控制台 --&gt;</span><br><span class="line">&lt;property name=&quot;hibernate.show_sql&quot;&gt;true&lt;/property&gt;</span><br><span class="line">&lt;!-- 将hibernate生成的sql语句格式化(语法缩进) --&gt;</span><br><span class="line">&lt;property name=&quot;hibernate.format_sql&quot;&gt;true&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- </span><br><span class="line">    ## auto schema export  自动导出表结构. 自动建表</span><br><span class="line">    #hibernate.hbm2ddl.auto create      自动建表.每次框架运行都会创建新的表.以前表将会被覆盖,表数据会丢失.(开发环境中测试使用)</span><br><span class="line">    #hibernate.hbm2ddl.auto create-drop 自动建表.每次框架运行结束都会将所有表删除.(开发环境中测试使用)</span><br><span class="line">    #hibernate.hbm2ddl.auto update(推荐使用)    自动生成表.如果已经存在不会再生成.如果表有变动.自动更新表(不会删除任何数据).</span><br><span class="line">    #hibernate.hbm2ddl.auto validate    校验.不自动生成表.每次启动会校验数据库中表是否正确.校验失败.</span><br><span class="line">--&gt;</span><br><span class="line">&lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h2 id="ORM-元数据配置"><a href="#ORM-元数据配置" class="headerlink" title="ORM 元数据配置"></a>ORM 元数据配置</h2><p>例子: <code>Customer.hbm.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-mapping</span> <span class="meta-keyword">PUBLIC</span> </span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- package属性:填写一个包名.在元素内部凡是需要书写完整类名的属性,可以直接写简答类名了. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.passon.hibernate.domain"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        class元素: 配置实体与表的对应关系的</span></span><br><span class="line"><span class="comment">            name: 完整类名</span></span><br><span class="line"><span class="comment">            table:数据库表名</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- id元素:配置主键映射的属性</span></span><br><span class="line"><span class="comment">                name: 填写主键对应属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写表中的主键列名.默认值:列名会默认使用属性名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span>  &gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- generator:主键生成策略 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property元素:除id之外的普通属性映射</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> <span class="attr">not-null</span>=<span class="string">"true"</span> <span class="attr">length</span>=<span class="string">"32"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  &lt;column name="cust_name" sql-type="varchar" &gt;&lt;/column&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p>简单的保存数据例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line"></span><br><span class="line">SessionFactory sessionFactory = conf.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line">Customer c = <span class="keyword">new</span> Customer();</span><br><span class="line">c.setCust_name(<span class="string">"google公司"</span>);</span><br><span class="line"></span><br><span class="line">session.save(c);<span class="comment">//执行保存</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">sessionFactory.close();</span><br></pre></td></tr></table></figure>
<h2 id="相关类"><a href="#相关类" class="headerlink" title="相关类"></a>相关类</h2><p>配置加载类，用于加载主配置 和 orm 元数据加载。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line"><span class="comment">// 读取 配置文件</span></span><br><span class="line">conf.configure();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选：读取指定 orm 元数据(扩展), 如果主配置中已经引入映射配置，不需要手动加载</span></span><br><span class="line"><span class="comment">//configure.addResource(resourceName);</span></span><br><span class="line"><span class="comment">//configure.addClass(persistentClass);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂对象，用于创建 Session</span></span><br><span class="line"><span class="comment">// 1. SessionFactory 负责保存和使用所有配置信息，对象创建消耗内存大</span></span><br><span class="line"><span class="comment">// 2. SessionFactory 线程安全</span></span><br><span class="line"><span class="comment">// 在使用的时候，尽量保证工程只使用一个 SessionFactory 对象</span></span><br><span class="line">SessionFactory sessionFactory = conf.buildSessionFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Session</span></span><br><span class="line"><span class="comment">// Session 对象：表示 Hibernate 框架 和 数据库之间的连接回话</span></span><br><span class="line"><span class="comment">// Session 是操作数据库的核心对象</span></span><br><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line"><span class="comment">// 获取一个和该线程绑定的 Session 对象</span></span><br><span class="line"><span class="comment">//Session currentSession = sessionFactory.getCurrentSession();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启事务</span></span><br><span class="line">Transaction tx = session.beginTransaction();</span><br></pre></td></tr></table></figure>
<p>操作数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Customer c = session.get(Customer.class, 1);</span><br><span class="line">//session.save(c);</span><br><span class="line">//session.update(c);</span><br><span class="line">session.delete(c);</span><br></pre></td></tr></table></figure>
<p>释放资源:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tx.commit();</span><br><span class="line"><span class="comment">//tx.rollback();</span></span><br><span class="line">session.close();</span><br><span class="line">sessionFactory.close();</span><br></pre></td></tr></table></figure>
<h1 id="HibernateUtils"><a href="#HibernateUtils" class="headerlink" title="HibernateUtils"></a>HibernateUtils</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.passon.hibernate.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory = conf.buildSessionFactory();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sessionFactory.getCurrentSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate-中实体规则"><a href="#Hibernate-中实体规则" class="headerlink" title="Hibernate 中实体规则"></a>Hibernate 中实体规则</h1><h2 id="实体类创建需要注意"><a href="#实体类创建需要注意" class="headerlink" title="实体类创建需要注意"></a>实体类创建需要注意</h2><ol>
<li>实体必须提供无参构造函数</li>
</ol>
<p>Hibernate 查询的时候通过反射创建对象，需要无参构造函数。</p>
<ol start="2">
<li>成员变量私有，提供 <code>getter/setter</code></li>
<li>持久化类中的属性，尽量使用包装类型(Integer, Long, Double, Float)</li>
<li>持久化需要提供 oid,与数据库中的主键列对应</li>
<li>不要使用 final 修饰 class</li>
</ol>
<p>Hibernate 使用 cglib 代理生成对象，代理对象是继承被代理对象的。</p>
<h2 id="主键类型"><a href="#主键类型" class="headerlink" title="主键类型"></a>主键类型</h2><ol>
<li>自然主键</li>
</ol>
<p>表中业务列中，有一个列可以作为主键使用。（比如：身份证号）</p>
<ol start="2">
<li>代理主键(常见主键类型)</li>
</ol>
<p>创建一个没有业务意义的列作为主键，比如：userId, …</p>
<h2 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h2><p>每条记录录入时，主键生成规则</p>
<p>在 orm 元数据配置中设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 主键自增，由数据库自己维护主键，录入时不需要指定主键 --&gt;</span><br><span class="line">&lt;generator class=&quot;identity&quot;&gt;&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- （效率低，有并发问题）主键自增，由hibernate来维护，每次录入的时候会先查询一次获取表中最大值，录入时不需要指定主键 (开发时不使用)--&gt;</span><br><span class="line">&lt;generator class=&quot;increment&quot;&gt;&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">sequence: Oracle中的主键生成策略。</span><br><span class="line"></span><br><span class="line">hilo: 高低位算法，主键自增，由hibernate来维护(开发时不使用)</span><br><span class="line"></span><br><span class="line">native: hilo+sequence+identity, 自动三选一</span><br><span class="line"></span><br><span class="line">uuid：随机字符</span><br><span class="line"></span><br><span class="line">assigned: 自然主键生成策略，用户自己录入</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate-中的对象状态"><a href="#Hibernate-中的对象状态" class="headerlink" title="Hibernate 中的对象状态"></a>Hibernate 中的对象状态</h1><ol>
<li>瞬时状态</li>
</ol>
<p>没有ID，没有与 session 关联</p>
<p><code>session.save</code> 函数将 瞬时状态-&gt;持久化状态</p>
<ol start="2">
<li>持久化状态</li>
</ol>
<p>有id，与 session 有关联</p>
<p>特点：这个状态下，对象的任何变化都会自动同步到数据库中。</p>
<p><code>session.get</code> 函数获取持久化状态对象。<br><code>session.close</code> 后会把 持久化状态-&gt;游离状态<br><code>session.delete</code>: 持久化状态-&gt;瞬时状态<br><code>session.saveOrUpdate</code>: 游离状态, 瞬时状态-&gt;持久化状态</p>
<ol start="3">
<li>游离|托管状态</li>
</ol>
<p>有id，没有与 session 关联</p>
<p>可以使用 <code>session.update</code> 函数，游离状态-&gt;持久化状态。</p>
<h1 id="Hibernate-一级缓存-amp-快照"><a href="#Hibernate-一级缓存-amp-快照" class="headerlink" title="Hibernate 一级缓存&amp;快照"></a>Hibernate 一级缓存&amp;快照</h1><p>目的：提高效率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Customer c = session.get(Customer.class, 1);</span><br><span class="line">Customer c2 = session.get(Customer.class, 1);</span><br><span class="line"></span><br><span class="line">// c == c2 : true</span><br></pre></td></tr></table></figure>
<p>缓存具有快照功能。修改后的对象和快照对比，判断是否需要进行 sql update 语句。<br>减少不必要的sql语句</p>
<h1 id="Hibernate-事务"><a href="#Hibernate-事务" class="headerlink" title="Hibernate 事务"></a>Hibernate 事务</h1><p>事务特性：原子性，一致性，隔离性，持久性</p>
<p>事务并发问题：</p>
<ol>
<li>脏读：读到某个人正在操作但是还没有提交的数据，</li>
<li>不可重复读：两次重复读取，数据不一致</li>
<li>幻读：删除表后，发现有人往表里插入了一条数据</li>
</ol>
<p>事务隔离级别：</p>
<p>读未提交：123<br>读已提交：23<br>可重复读：3 (mysql 默认)<br>串行花：没有问题</p>
<p>在 Hibernate 中执行隔离基本，在基础配置文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#hibernate.connection.isolation 1,2,4,8 ; 0001 0010 0100 1000</span><br></pre></td></tr></table></figure>
<p>如何管理事务：需要保证 dao 层和 service 层的 session 对象是同一个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.getCurrentSession() 保证是当前线程的 session.</span><br></pre></td></tr></table></figure>
<p>在配置中指定 session 与当前线程绑定:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过 getCurrentSession 获取的 session 开启事务后，提交事务会自动关闭 session, 不需要手动关闭 session</p>
</blockquote>
<h1 id="Hibernate-批量查询"><a href="#Hibernate-批量查询" class="headerlink" title="Hibernate 批量查询"></a>Hibernate 批量查询</h1><h2 id="HQL"><a href="#HQL" class="headerlink" title="HQL"></a>HQL</h2><blockquote>
<p>Hibernate 自创</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from com.passon.hibernate.domain.Customer"</span></span><br><span class="line"><span class="comment">// String hql = "from Customer where cust_id=1"</span></span><br><span class="line">Query query = session.cureateQuery(hql);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line">Customer c = (Customer)query.uniqueResult();</span><br><span class="line"></span><br><span class="line"><span class="comment">// String hql = "from Customer where cust_id=?"</span></span><br><span class="line"><span class="comment">// Query query = session.cureateQuery(hql);</span></span><br><span class="line"><span class="comment">// query.setParameter(0, 1l); // 设置参数, 参数一表示 ? 位置</span></span><br><span class="line"><span class="comment">// query.setParameter("cust_id2", 1l); // 设置参数， 对应hql, from Customer where cust_id=:cust_id2</span></span><br><span class="line"><span class="comment">// query.setLong(0, 1l);</span></span><br></pre></td></tr></table></figure>
<p>分页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">query.setFirstResult(); <span class="comment">// 从第几条数据开始</span></span><br><span class="line">query.setMaxResults(); <span class="comment">// 数据数量</span></span><br></pre></td></tr></table></figure>
<p>统计查询：count sum agv max min</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String hql1 = <span class="string">"select count(*) from com.passon.hibernate.domain.Customer"</span></span><br><span class="line">Query query = session.cureateQuery(hql1);</span><br><span class="line">Number num = (Number)query.uniqueResult();</span><br></pre></td></tr></table></figure>
<h2 id="Criteria"><a href="#Criteria" class="headerlink" title="Criteria"></a>Criteria</h2><blockquote>
<p>Hibernate 自创, 无语句查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = session.createCriteria(Customer<span class="class">.<span class="keyword">class</span>)</span>; <span class="comment">// 查询所有</span></span><br><span class="line">List&lt;Customer&gt; list = criteria.list();</span><br><span class="line"><span class="comment">//Customer c = criteria.uniqueResult();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//条件查询</span></span><br><span class="line">criteria.add(Restrictions.....)</span><br><span class="line"></span><br><span class="line"><span class="comment">//分页</span></span><br><span class="line">criteria.setFirstResult(.);</span><br><span class="line">criteria.setMaxResults(.)</span><br></pre></td></tr></table></figure>
<h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select * from cst_customer"</span>;</span><br><span class="line">SQLQuery query = session.createSQLQuery(sql);</span><br><span class="line"><span class="comment">//List&lt;Object[]&gt; list = query.list();</span></span><br><span class="line"><span class="comment">//query.uniqueResult();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//指定结果集封装对象</span></span><br><span class="line">query.addEntity(Customer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//条件查询 sql = "select * from cst_customer where cust_id=?";</span></span><br><span class="line">query.setParameter(<span class="number">0</span>, <span class="number">1l</span>);</span><br><span class="line">Customer c = (Customer)query.uniqueResult();</span><br></pre></td></tr></table></figure>
<h1 id="多表关系"><a href="#多表关系" class="headerlink" title="多表关系"></a>多表关系</h1><h2 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String cid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;LinkMan&gt; linkMens = <span class="keyword">new</span> HashSet&lt;LinkMan&gt;();</span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkMan</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String lid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Customer 特殊配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1对多 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>LinkMan 特殊配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多对1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">column</span>=<span class="string">"lid"</span> <span class="attr">class</span>=<span class="string">"Customer"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Customer c = <span class="keyword">new</span> Customer()</span><br><span class="line">c.setName(<span class="string">"fang"</span>);</span><br><span class="line"></span><br><span class="line">LinkMan lm = <span class="keyword">new</span> LinkMan();</span><br><span class="line">lm.setName(<span class="string">"fang-c01"</span>);</span><br><span class="line">LinkMan lm2 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">lm.setName(<span class="string">"fang-c02"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置关系</span></span><br><span class="line">c.getLinkMans().add(lm);</span><br><span class="line">c.getLinkMans().add(lm2);</span><br><span class="line">lm.setCustomer(c);</span><br><span class="line">lm2.setCustomer(c);</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存</span></span><br><span class="line">session.save(c);</span><br><span class="line">session.save(lm);</span><br><span class="line">session.save(lm2);</span><br></pre></td></tr></table></figure>
<p>简化保存：自动保存关联对象。</p>
<p>设置 级联操作</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    级联操作 cascade:</span></span><br><span class="line"><span class="comment">        save-update</span></span><br><span class="line"><span class="comment">        delete</span></span><br><span class="line"><span class="comment">        all</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//保存的时候</span><br><span class="line">session.save(c);//即可</span><br></pre></td></tr></table></figure>
<p>inverse 优化 sql: 提升性能，优化关系维护</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- true: 将关系维护交给 LinkMan ; false(默认值)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//同时可以省略, 下面两行代码</span><br><span class="line">//c.getLinkMans().add(lm);</span><br><span class="line">//c.getLinkMans().add(lm2);</span><br></pre></td></tr></table></figure>
<h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><p>需要中间表存储两个表之间的关系。中间表至少有两列，都设置外键分别引用两个表。</p>
<p>User - Role</p>
<p><code>user.hbm.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- name: 集合属性名，</span></span><br><span class="line"><span class="comment">    table: 配置中间表名</span></span><br><span class="line"><span class="comment">    key-column: 配置表中的 对应列名</span></span><br><span class="line"><span class="comment">    class：另一方的类，column: 中间表中另一个外键列名</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="操作-1"><a href="#操作-1" class="headerlink" title="操作"></a>操作</h3><ol>
<li><code>inverse</code></li>
</ol>
<p>true: 表示放弃维护外键关系。</p>
<p>在开发中一定要选择一方放弃维护关系。（根据业务选择一方放弃维护外键关系）</p>
<ol start="2">
<li><code>cascade</code></li>
</ol>
<h1 id="离线查询对象"><a href="#离线查询对象" class="headerlink" title="离线查询对象"></a>离线查询对象</h1><p>离线的 Criteria. 脱离 session。</p>
<p>在 Web 层创建离线查询对象，传递给 dao 层，配合 session 实现查询。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// web</span></span><br><span class="line">DetachedCriteria dc = DetachedCriteria.forClass(Customer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dao:</span></span><br><span class="line">Criteria c =  dc.getExecutableCriteria(session);</span><br></pre></td></tr></table></figure>
<h1 id="加载策略"><a href="#加载策略" class="headerlink" title="加载策略"></a>加载策略</h1><h2 id="类级别加载策略"><a href="#类级别加载策略" class="headerlink" title="类级别加载策略"></a>类级别加载策略</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Customer c = session.get(Customer<span class="class">.<span class="keyword">class</span>, 2<span class="title">l</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// load 方法 类加载策略，</span></span><br><span class="line"><span class="comment">// 加载策略在 类的配置文件里面：lazy 属性控制</span></span><br><span class="line"><span class="comment">//  默认 true 延迟加载</span></span><br><span class="line"><span class="comment">//       false: 不延迟加载 与 get 一样</span></span><br><span class="line"><span class="comment">// 在执行的时候，不执行任何 sql 语句，使用 c 对象的时候才执行查询</span></span><br><span class="line">Customer c = session.load(Customer<span class="class">.<span class="keyword">class</span>, 2<span class="title">l</span>)</span>;</span><br><span class="line"><span class="comment">//lazy 模式返回的对象，实际上是 代理对象</span></span><br></pre></td></tr></table></figure>
<h2 id="关联级别加载策略"><a href="#关联级别加载策略" class="headerlink" title="关联级别加载策略"></a>关联级别加载策略</h2><p>策略配置，在类配置中：(正常开发过程中使用默认值即可)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> lazy: true: 延迟加载， false: 立即加载，extra: 及其懒惰</span></span><br><span class="line"><span class="comment"> fetch: 决定加载策略，使用什么类型的 sql 语句加载集合数据</span></span><br><span class="line"><span class="comment">    select(默认值): 单表查询加载</span></span><br><span class="line"><span class="comment">    join: 使用多表查询加载集合</span></span><br><span class="line"><span class="comment">    subselect: 使用子查询加载集合</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">lazy</span>=<span class="string">"true"</span> <span class="attr">fetch</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Customer c = session.get(Customer<span class="class">.<span class="keyword">class</span>, 2<span class="title">l</span>)</span>;</span><br><span class="line">Set&lt;LinkMan&gt; linkMans = c.getLinkMens(); <span class="comment">// 集合关联</span></span><br></pre></td></tr></table></figure>
<h1 id="批量抓取"><a href="#批量抓取" class="headerlink" title="批量抓取"></a>批量抓取</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">Query query = session.cureateQuery(hql);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Customer c: list)&#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for 循环每执行一次，都会执行一个 sql 语句，表示 list 中的数据并不是一次查询出来的。</span></span><br></pre></td></tr></table></figure>
<p>实现 list 数据是真实数据：<code>batch-size</code> 表示实际从数据库中读取的数量。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- batch-size 表示一次抓取集合的数量 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">batch-size</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/14/Android/优化/gradle编译优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/14/Android/优化/gradle编译优化/" itemprop="url">gradle编译优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-14T21:03:14+08:00">
                2018-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="gradle-编译报告生成"><a href="#gradle-编译报告生成" class="headerlink" title="gradle 编译报告生成"></a>gradle 编译报告生成</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew assembleDebug --scan</span><br></pre></td></tr></table></figure>
<h2 id="关键的点"><a href="#关键的点" class="headerlink" title="关键的点"></a>关键的点</h2><ul>
<li><code>Performance</code>: 查看各个编译环节花费的时间</li>
<li><code>Performance -&gt; Settings and suggestions</code>: 优化建议</li>
</ul>
<h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><h2 id="更新-gradle"><a href="#更新-gradle" class="headerlink" title="更新 gradle"></a>更新 gradle</h2><h2 id="优化-gralde-配置"><a href="#优化-gralde-配置" class="headerlink" title="优化 gralde 配置"></a>优化 gralde 配置</h2><p>gradld 配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</span><br><span class="line"></span><br><span class="line"># 开启并行编译</span><br><span class="line">org.gradle.parallel=true</span><br><span class="line"># 开启孵化模式</span><br><span class="line">org.gradle.configureondemand=true</span><br><span class="line"></span><br><span class="line"># 开启守护进程</span><br><span class="line">org.gradle.daemon=true</span><br><span class="line"></span><br><span class="line"># 开启缓存</span><br><span class="line">android.enableBuildCache=true</span><br></pre></td></tr></table></figure>
<p>不检查png的合法性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    aaptOptions &#123;</span><br><span class="line">        cruncherEnabled false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://medium.freecodecamp.org/how-to-improve-the-build-speed-of-your-android-projects-bd49029d8602" target="_blank" rel="noopener">How to improve the build speed of your Android projects</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/12/Android/view/ConstraintLayout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/12/Android/view/ConstraintLayout/" itemprop="url">ConstraintLayout</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-12T21:38:14+08:00">
                2018-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ConstraintLayout-Deep-Dive-Android-Dev-Summit-‘18"><a href="#ConstraintLayout-Deep-Dive-Android-Dev-Summit-‘18" class="headerlink" title="ConstraintLayout Deep Dive(Android Dev Summit ‘18)"></a>ConstraintLayout Deep Dive(Android Dev Summit ‘18)</h1><blockquote>
<p>androidx.constraintlayout:constraintlayout:2.0.0-alpha2</p>
</blockquote>
<ul>
<li>layout_width|layout_height 属性 <code>match_constraint</code> 表示填充剩余符合约束的剩余空间，在 xml 布局中使用 <code>0dp</code> 表示</li>
<li>设置控件宽高比 <code>app:layout_constraintDimensionRatio=&quot;1:1&quot;</code></li>
</ul>
<p>当宽高比和以下约束冲突的时候，以下约束有更高的优先级。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class="line">app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class="line">app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class="line">app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br></pre></td></tr></table></figure>
<p>一个控件对于另一个控件居中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app:layout_constraintBottom_toBottomOf=&quot;@id/other_view&quot;</span><br><span class="line">app:layout_constraintTop_toTopOf=&quot;@id/other_view&quot;</span><br></pre></td></tr></table></figure>
<h2 id="文本类控件布局"><a href="#文本类控件布局" class="headerlink" title="文本类控件布局"></a>文本类控件布局</h2><p>Baseline 对齐</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_constraintBaseline_toBaselineOf=&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><a href="https://www.youtube.com/watch?v=P9Zstbk0lPw&amp;list=PLWz5rJ2EKKc8WFYCR9esqGGY0vOZm2l6e&amp;index=24" target="_blank" rel="noopener">ConstraintLayout Deep Dive</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/12/Android/架构/官方架构组件/LiveData/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/12/Android/架构/官方架构组件/LiveData/" itemprop="url">LiveData</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-12T12:18:12+08:00">
                2018-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="2018-11-15-LiveData-源码阅读"><a href="#2018-11-15-LiveData-源码阅读" class="headerlink" title="2018-11-15 LiveData 源码阅读"></a>2018-11-15 LiveData 源码阅读</h1><h1 id="不能白看源码，面试如何回答"><a href="#不能白看源码，面试如何回答" class="headerlink" title="不能白看源码，面试如何回答"></a>不能白看源码，面试如何回答</h1><blockquote>
<p>简单的说下 LiveData 原理？</p>
</blockquote>
<p>本质上是一个观察者模式，Activity 或 Fragment 中实现观察者，LiveData 是被观察者，LiveData 中存储的数据变更的时候触发事件。</p>
<blockquote>
<p>说下 LiveData 的优缺点？</p>
</blockquote>
<p>优点：</p>
<ol>
<li>响应式编程</li>
</ol>
<p>由于观察者模式的特性，实现了响应式编程，LiveData 数据变化后自动触发 UI 更新，</p>
<ol start="2">
<li>解耦, 对 MVP 模式的补充</li>
</ol>
<p>没有对比就没有伤害：传统的 MVP 模式在使用的时候，Presenter 中需要传入一个 接口 作为与 View 交互的桥梁，而 LiveData 刚好可以替代了这个 接口。这样 Presenter 中就不需要持有 View(通常是View实现接口传到Presenter中直接使用) 对象，解耦更加彻底</p>
<blockquote>
<p>应该还不算是 MVVM, 个人理解使用了 DataBinding 才算 MVVM</p>
</blockquote>
<ol start="3">
<li>实现了生命周期的监听， 避免内存泄露</li>
</ol>
<p>缺点：</p>
<p>暂时没想到</p>
<blockquote>
<p>LiveData 如何实现生命周期的监听？</p>
</blockquote>
<p>这个有点复杂了，很难几句话说清楚。</p>
<p>白话版本：Activity, Fragment 中有一个成员变量，这个对象在 Activity 和 Fragment 的生命周期函数中会执行一个类似 <code>lifecycleChange(event)</code> 的函数并把当前生命周期事件作为参数传入。然后把生命周期 Event 传递给 LiveData。 最后 LiveData 根据生命周期事件判断是否要取消观察者模式的订阅。</p>
<p>专业版本：Activity, Fragment 中有一个成员变量 <code>mLifecycleRegistry</code>，这个对象在 Activity 和 Fragment 的生命周期函数中会执行 <code>mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.XXXX);</code> ，然后把生命周期 Event 传递给 LifecycleObserver。 最后 LifecycleObserver 根据生命周期事件判断是否要取消观察者模式的订阅。</p>
<blockquote>
<p>Activity 或者 Fragment 哪些生命周期状态下可以接收事件消息？</p>
</blockquote>
<p><code>onStart, onResume, onPause</code></p>
<blockquote>
<p>不能接收数据的生命周期时(onStop)，LiveData 中数据变化会不会生效?</p>
</blockquote>
<p>可以生效，在 Activity 回到 <code>onResume</code> 的时候会显示 LiveData 中最新的数据。</p>
<blockquote>
<p>知道setValue 和 postValue 的区别吗？</p>
</blockquote>
<p><code>setValue</code> 必须在主线程中执行, <code>postValue</code> 可以在子线程中执行。</p>
<blockquote>
<p>如何实现线程切换的？</p>
</blockquote>
<p>在内部创建了 <code>MainHandler</code> ，构建一个 <code>Runnable</code> 给 <code>MainHandler</code> 执行，实现线程切换。</p>
<h1 id="LiveData-源码解析"><a href="#LiveData-源码解析" class="headerlink" title="LiveData 源码解析"></a>LiveData 源码解析</h1><blockquote>
<p>LiveData是一个数据持有者，其本身实现了观察者模式，支持数据监控（被观察），并且可以感知组件的生命周期。</p>
</blockquote>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><code>LiveData</code> 是一个抽象类，通常在使用 <code>LiveData</code> 的时候我们是使用其子类 <code>MutableLiveData</code>。</p>
<p><code>XXViewModel.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 创建 LiveData</span><br><span class="line">private MutableLiveData&lt;Object&gt; mDataMutableLiveData = new MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line">// LiveData 改变数据, 触发观察者</span><br><span class="line">mDataMutableLiveData.postValue(object);</span><br><span class="line">// setValue 在主线程中执行</span><br><span class="line">// postValue 可以在子线程中执行</span><br></pre></td></tr></table></figure>
<p><code>XXActivity</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//获取 ViewModel 对象</span><br><span class="line">mViewModel = ViewModelProviders.of(this).get(XXViewModel.class);</span><br><span class="line"></span><br><span class="line">//设置观察者</span><br><span class="line">mViewModel.getDataMutableLiveData().observe(this, this::dataChange);</span><br><span class="line"></span><br><span class="line">// LiveData 中数据改变的时候处罚</span><br><span class="line">private void dataChange(Object s) &#123;</span><br><span class="line">    // data change</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>LiveData 使用了观察者模式。</p>
<ol>
<li>被观察者：<code>LiveData</code></li>
<li>观察者，需要实现：<code>LifecycleOwner</code> 接口，<code>Activity, Fragment</code> 都实现了 <code>LifecycleOwner</code> 接口，所以在使用的时候我们通常使用 <code>Activity, Fragment</code> 作为观察者。</li>
</ol>
<p>观察者唯一的作用是提供：<code>Lifecycle</code> 对象。<code>Lifecycle</code> 是抽象类，实际返回的是 <code>LifecycleRegistry</code> 对象。</p>
<p><code>LifecycleOwner.class</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface LifecycleOwner &#123;</span><br><span class="line">    @NonNull</span><br><span class="line">    Lifecycle getLifecycle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Activity 和 Fragment 中都有成员变量 <code>mLifecycleRegistry</code>，并在 <code>getLifecycle</code> 函数中返回该对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(this);</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Lifecycle getLifecycle() &#123;</span><br><span class="line">    return mLifecycleRegistry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="被观察者添加观察者过程"><a href="#被观察者添加观察者过程" class="headerlink" title="被观察者添加观察者过程"></a>被观察者添加观察者过程</h2><p>调用 LiveData#observer 函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void observe(@NonNull LifecycleOwner owner, @NonNull Observer&lt;T&gt; observer)</span><br></pre></td></tr></table></figure>
<p><code>android.arch.lifecycle.Observer</code> 是一个接口，里面只有一个函数 <code>onChanged</code> 作为被观察者数据改变后触发的回调函数。</p>
<p>添加观察者过程实际上是把 <code>Observer</code> 传递给 <code>LiveData</code> 对象 和 <code>LifecycleRegistry</code> 对象。</p>
<p>LiveData 中存储 observer：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private SafeIterableMap&lt;Observer&lt;T&gt;, ObserverWrapper&gt; mObservers = new SafeIterableMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">Map: observer: new LifecycleBoundObserver(owner, observer)</span><br></pre></td></tr></table></figure>
<p>LifecycleRegistry 中存储 observer:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private FastSafeIterableMap&lt;LifecycleObserver, ObserverWithState&gt; mObserverMap = new FastSafeIterableMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">Map: LifecycleBoundObserver(owner, observer): ObserverWithState(observer, initialState)</span><br></pre></td></tr></table></figure>
<p><code>LifecycleBoundObserver</code> 对象作为生命周期状态变化后调用函数存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class LifecycleBoundObserver extends ObserverWrapper implements GenericLifecycleObserver</span><br><span class="line"></span><br><span class="line">生命周期变化后触发：</span><br><span class="line">public void onStateChanged(LifecycleOwner source, Lifecycle.Event event)</span><br></pre></td></tr></table></figure>
<p>到此关键对象：</p>
<ol>
<li>LiveData: 作为数据入口，维护观察者和被观察者的关系</li>
<li>Observer：数据改变后最终触发的函数，回调接口，调用端实现</li>
<li>LifecycleOwner: Activity, Fragment 提供 Lifecycle</li>
<li>Lifecycle, LifecycleRegistry</li>
<li>LifecycleObserver，GenericLifecycleObserver, LifecycleBoundObserver: 封装了 Observer, LifecycleOwner 对象</li>
</ol>
<h2 id="Activity-和-Fragment-的生命周期是如何和-LiveData-产生关联的？"><a href="#Activity-和-Fragment-的生命周期是如何和-LiveData-产生关联的？" class="headerlink" title="Activity 和 Fragment 的生命周期是如何和 LiveData 产生关联的？"></a>Activity 和 Fragment 的生命周期是如何和 LiveData 产生关联的？</h2><p>LiveData 和 生命周期的关系基本操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生命周期正常的时候， addObserver 注册观察者；生命周期结束的时候 removeObserver 取消观察者</span><br></pre></td></tr></table></figure>
<p>上面添加订阅和取消订阅都是内部自动执行的，不需要用户去手动触发。</p>
<p>上面提到 Activity，Fragment 都实现了 <code>LifecycleOwner</code> 接口，成员变量中有 <code>mLifecycleRegistry</code> 对象。</p>
<p>在 Activty, Fragment 生命周期函数中调用下面函数将生命周期事件传递出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.XXXX);</span><br></pre></td></tr></table></figure>
<p><code>mLifecycleRegistry</code> 触发生命周期改变函数后，调用下面函数(中间省略了部分步骤)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mLifecycleObserver.onStateChanged(owner, event);</span><br><span class="line"></span><br><span class="line">LifecycleBoundObserver 就是这里的 mLifecycleObserver</span><br><span class="line">//根据事件判断是否要解除订阅</span><br></pre></td></tr></table></figure>
<h2 id="setValue-与-postValue"><a href="#setValue-与-postValue" class="headerlink" title="setValue 与 postValue"></a>setValue 与 postValue</h2><p><code>setValue</code> 必须在主线程中执行,<code>postValue</code> 可以在子线程中执行，</p>
<p><strong>如何实现的线程切换？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ArchTaskExecutor 使用了代理模式, 实际函数执行类是 DefaultTaskExecutor</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TaskExecutor 接口</span><br><span class="line">    |- ArchTaskExecutor 实现</span><br><span class="line">    |- DefaultTaskExecutor 实现</span><br></pre></td></tr></table></figure>
<p>Runnable 最终执行位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void postToMainThread(Runnable runnable) &#123;</span><br><span class="line">    if (mMainHandler == null) &#123;</span><br><span class="line">        synchronized (mLock) &#123;</span><br><span class="line">            if (mMainHandler == null) &#123;</span><br><span class="line">                mMainHandler = new Handler(Looper.getMainLooper());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //noinspection ConstantConditions</span><br><span class="line">    mMainHandler.post(runnable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>线程切换通过 Handler 实现</p>
</blockquote>
<p>MainHandler 创建方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainHandler = new Handler(Looper.getMainLooper());</span><br></pre></td></tr></table></figure>
<p>判断是否是 MainThread:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Looper.getMainLooper().getThread() == Thread.currentThread();</span><br></pre></td></tr></table></figure>
<h1 id="Fun-with-LiveData-Android-Dev-Summit-‘18"><a href="#Fun-with-LiveData-Android-Dev-Summit-‘18" class="headerlink" title="Fun with LiveData (Android Dev Summit ‘18)"></a>Fun with LiveData (Android Dev Summit ‘18)</h1><ul>
<li>LiveData 作为 ViewModel 与 Activity 之间沟通的桥梁。</li>
<li>LiveData 是一个 Observable, Activity 中创建对应的 Observer。</li>
<li>LiveData is Lifecycle-Aware。</li>
</ul>
<p>也就是说 Lifecycle(Activity, Fragment) <code>onStop, onDestory</code>之后，LiveData 会自动和 Lifecycle 解除绑定，</p>
<ul>
<li>LiveData 是一个 Value Holder</li>
</ul>
<p>给 LiveData 设置一个值，这个值回传递给 Lifecycle(Activity, Fragment).<br>在监听之外时间设置的 Value 会在监听开始的时候直接获取到。</p>
<h2 id="LiveData-beyond-the-ViewModel"><a href="#LiveData-beyond-the-ViewModel" class="headerlink" title="LiveData beyond the ViewModel"></a>LiveData beyond the ViewModel</h2><p>当我们有 Repository 的时候，Repository 向外暴露 LiveData, 如何将这个 LiveData 和 Lifecycle 绑定？</p>
<blockquote>
<p>if you need a lifecycle in your ViewModel, you probably need Transformation. - Yigit</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LiveData&lt;UserEntity&gt; map = Transformations.map(userIdLiveData, new Function&lt;String, UserEntity&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public UserEntity apply(String input) &#123;</span><br><span class="line">        return respository,getUser(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">LiveData&lt;UserEntity&gt; yLiveData = Transformations.switchMap(userIdLiveData, new Function&lt;String, LiveData&lt;UserEntity&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public LiveData&lt;UserEntity&gt; apply(String input) &#123;</span><br><span class="line">        return respository.getDataForUser(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="MediatorLiveData-使用"><a href="#MediatorLiveData-使用" class="headerlink" title="MediatorLiveData 使用"></a>MediatorLiveData 使用</h2><p>MediatorLiveData 可以监听多个 LiveData。</p>
<p>计算两个 LiveData 中存储的 String 总长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">final MediatorLiveData&lt;Integer&gt; integerMediatorLiveData = new MediatorLiveData&lt;Integer&gt;;</span><br><span class="line">Observer&lt;String&gt; onChanged = new Observer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onChanged(String s) &#123;</span><br><span class="line">        String value = userIdLiveData.getValue();</span><br><span class="line">        String value1 = userIdLiveData2.getValue();</span><br><span class="line">        integerMediatorLiveData.setValue(value.length() + value1.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">integerMediatorLiveData.addSource(userIdLiveData, onChanged);</span><br><span class="line">integerMediatorLiveData.addSource(userIdLiveData2, onChanged);</span><br></pre></td></tr></table></figure>
<p><a href="https://www.youtube.com/watch?v=2rO4r-JOQtA&amp;list=PLWz5rJ2EKKc8WFYCR9esqGGY0vOZm2l6e&amp;index=3" target="_blank" rel="noopener">Fun with LiveData (Android Dev Summit ‘18)</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/Android/Android安全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/Android/Android安全/" itemprop="url">Android App 安全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-06T08:00:35+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="四大组件安全"><a href="#四大组件安全" class="headerlink" title="四大组件安全"></a>四大组件安全</h1><blockquote>
<p>这里提到的组件访问权限主要是指跨应用的进程间通信（IPC，Inter-Process Communication）</p>
</blockquote>
<p>组件安全主要是为了防止外部应用恶意访问。</p>
<p>设置权限开放属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:exported=[&quot;true&quot; | &quot;false&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="Application-相关设置"><a href="#Application-相关设置" class="headerlink" title="Application 相关设置"></a>Application 相关设置</h2><ol>
<li>debugable 属性设置成 false, 默认就是 false</li>
<li>allowBackup: 设置成 false, </li>
</ol>
<h2 id="使用-LocalBroadcastManager"><a href="#使用-LocalBroadcastManager" class="headerlink" title="使用 LocalBroadcastManager"></a>使用 LocalBroadcastManager</h2><p>使用本地广播</p>
<h1 id="WebView-安全"><a href="#WebView-安全" class="headerlink" title="WebView 安全"></a>WebView 安全</h1><ol>
<li>Android4.2 以下有 JS 任意代码执行的漏洞</li>
<li>使用 Https</li>
<li>file 协议安全漏洞，如果 app 不需要支持 file 协议可以禁止</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//若不需支持，则直接禁止 file 协议</span><br><span class="line">setAllowFileAccess(false);</span><br><span class="line">setAllowFileAccessFromFileURLs(false);</span><br><span class="line">setAllowUniversalAccessFromFileURLs(false);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>密码明文保存漏洞</li>
</ol>
<p>WebView 默认是开启密码保存功能的，密码会明文保存在 <code>/data/data/com.package.name/databases/webview.db</code> 中，应该禁止密码保存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebSettings.setSavePassword(false)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>开启安全游览模式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest&gt;</span><br><span class="line">    &lt;meta-data android:name=&quot;android.webkit.WebView.EnableSafeBrowsing&quot; </span><br><span class="line">               android:value=&quot;true&quot; /&gt; </span><br><span class="line">    &lt;application&gt; </span><br><span class="line">     ... </span><br><span class="line">    &lt;/application&gt; </span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>启用安全浏览模式后，WebView 将参考安全浏览的恶意软件和钓鱼网站数据库检查访问的 URL ，在用户打开之前给予危险提示，体验类似以于Chrome浏览器。</p>
<h1 id="数据存储安全"><a href="#数据存储安全" class="headerlink" title="数据存储安全"></a>数据存储安全</h1><ol>
<li>密钥类信息不要硬编码，可以写在 JNI 中</li>
<li>SharePreferences 不能存放敏感信息，并且在使用的时候设置权限为 MODE_PRIVATE</li>
<li>签名配置信息不要加入到版本管理里面</li>
</ol>
<h1 id="数据传输安全"><a href="#数据传输安全" class="headerlink" title="数据传输安全"></a>数据传输安全</h1><ol>
<li>HTTPS 协议</li>
<li>Android 网络安全性配置</li>
</ol>
<p>可以设置应用只信任某个 CA 证书。<a href="https://developer.android.com/training/articles/security-config?hl=zh-cn#CertificatePinning" target="_blank" rel="noopener">网络安全配置</a></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ol>
<li>日志输出</li>
</ol>
<p>正式版本要关闭日志</p>
<ol start="2">
<li>代码混淆和加固</li>
<li>漏洞检查工具</li>
</ol>
<p>参考：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/35100057" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35100057</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/25/java/JDBC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/25/java/JDBC/" itemprop="url">JDBC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-25T13:18:12+08:00">
                2018-10-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JDBC: java database connectivity 数据库连接，用于执行 sql 语句的 java api。可以为多种关系数据库提供统一的访问。</p>
<p>JDBC 需要连接驱动，驱动是两个设备之间通讯的桥梁。驱动需要满足一定的格式，格式由设备提供商规定。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><blockquote>
<p>JDBC 一套由 Sun 公司定义的接口，其实现类由数据库厂商编写。</p>
</blockquote>
<h1 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h1><p>使用的 jar 包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-connnector-java-5.1.47-bin.jar</span><br></pre></td></tr></table></figure>
<ol>
<li>注册驱动</li>
<li>获取链接</li>
<li>获取语句执行平台</li>
<li>执行 sql 语句</li>
<li>处理结果</li>
<li>释放资源</li>
</ol>
<blockquote>
<p>异常处理：Establishing SSL connection without server’s identity verification is not recommended.<br>解决方案：Put the useSSL=false at the end of the name database:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    public static void main(String[] args) throws ClassNotFoundException, SQLException &#123;</span><br><span class="line"></span><br><span class="line">//        1。 注册驱动，Driver 中源码可知已经注册了</span><br><span class="line">//        DriverManager.registerDriver(new Driver());</span><br><span class="line">        // 使用反射方式注册驱动</span><br><span class="line">        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        // 2. 获取数据库连接</span><br><span class="line">        // url:  数据库地址 jdbc:mysql://ip:port//数据库名字</span><br><span class="line">        String url = &quot;jdbc:mysql://localhost:3306/jdbc_ex?useSSL=false&quot;;</span><br><span class="line">        String userName = &quot;root&quot;;</span><br><span class="line">        String pwd = &quot;happy0224&quot;;</span><br><span class="line">        Connection connection = DriverManager.getConnection(url, userName, pwd);</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        // 3。 获取语句执行平台</span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line"></span><br><span class="line">        // 4. 执行 sql</span><br><span class="line">        // statement.executeUpdate() 执行 insert delete update</span><br><span class="line">        // 返回 int 表示影响的记录数</span><br><span class="line">        int row = statement.executeUpdate(&quot;INSERT INTO sort values(null,&apos;汽车用品2&apos;, 5000, &apos;haha&apos; )&quot;);</span><br><span class="line">        System.out.println(row);</span><br><span class="line"></span><br><span class="line">        // 6. 释放资源</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>结果处理：查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        ResultSet resultSet = statement.executeQuery(&quot;select * from sort&quot;);</span><br><span class="line">        while (resultSet.next()) &#123;</span><br><span class="line">            // 获取每列数据 getXXX 参数建议使用 列名String</span><br><span class="line">//            resultSet.getInt(&quot;sid&quot;)</span><br><span class="line">            System.out.println(resultSet.getInt(&quot;sid&quot;));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>SQL 注入攻击：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&apos;a&apos; and pwd=&apos;2&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">“select * from users where username=&apos;+ userName +&apos; and pwd=&quot; + pwd + &quot;;”</span><br><span class="line"></span><br><span class="line">userName = 1;</span><br><span class="line">pwd = 1&apos; or 1=1</span><br></pre></td></tr></table></figure>
<p>防止注入攻击：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 使用子接口 PreparedStatement (SQl 预编译存储，多次高效执行SQL)</span><br><span class="line">String sql = &quot;select * from users where username=? and password=?&quot;;</span><br><span class="line">PreparedStatement preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">//  参数替换占位符</span><br><span class="line">preparedStatement.setString(1, &quot;username&quot;);</span><br><span class="line">preparedStatement.setString(2, &quot;pwd&quot;);</span><br><span class="line">//</span><br></pre></td></tr></table></figure>
<p>更新：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = &quot;update sort set sname=?, sprice? where sid=?&quot;;</span><br><span class="line">PreparedStatement preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">preparedStatement.setString(1, &quot;asdas&quot;);</span><br><span class="line">int row = preparedStatement.executeUpdate();</span><br></pre></td></tr></table></figure>
<p>查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = &quot;select * from sort where sid=?&quot;;</span><br><span class="line">PreparedStatement preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">preparedStatement.setString(1, &quot;&quot;);</span><br><span class="line">ResultSet resultSet = preparedStatement.executeQuery();</span><br></pre></td></tr></table></figure>
<h1 id="JDBC-工具类"><a href="#JDBC-工具类" class="headerlink" title="JDBC 工具类"></a>JDBC 工具类</h1><p>使用的 jar 包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commons-dbutils-1.7.jar</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package jdbc;</span><br><span class="line"></span><br><span class="line">import java.sql.*;</span><br><span class="line"></span><br><span class="line">public class JDBCUtils &#123;</span><br><span class="line"></span><br><span class="line">    private JDBCUtils() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Connection connection;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">            String url = &quot;jdbc:mysql://localhost:3306/jdbc_ex?useSSL=false&quot;;</span><br><span class="line">            String userName = &quot;root&quot;;</span><br><span class="line">            String pwd = &quot;123&quot;;</span><br><span class="line">            connection = DriverManager.getConnection(url, userName, pwd);</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new RuntimeException(&quot;database connect fail&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Connection getConnection() &#123;</span><br><span class="line">        return connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void close(Connection con, Statement statement, ResultSet resultSet) &#123;</span><br><span class="line">        if (resultSet != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (statement != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (connection != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                con.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="properties-配置文件"><a href="#properties-配置文件" class="headerlink" title="properties 配置文件"></a>properties 配置文件</h1><p>src 目录下：</p>
<p><code>config.properties</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driverClass=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3306/jdbc_ex?useSSL=false</span><br></pre></td></tr></table></figure>
<h1 id="DBUtils"><a href="#DBUtils" class="headerlink" title="DBUtils"></a>DBUtils</h1><p><a href="https://commons.apache.org/proper/commons-dbutils/" target="_blank" rel="noopener">https://commons.apache.org/proper/commons-dbutils/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QueryRunner: Executes SQL queries with pluggable strategies for handling ResultSets. This class is thread safe.</span><br><span class="line">ResultSetHandler: Interface</span><br><span class="line">DbUtils: A collection of JDBC helper methods. This class is thread safe.</span><br></pre></td></tr></table></figure>
<p>增删改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static void delete() throws SQLException &#123;</span><br><span class="line">    QueryRunner queryRunner = new QueryRunner();</span><br><span class="line">    String sql = &quot;delete from sort where sid=?&quot;;</span><br><span class="line">    int update = queryRunner.update(connection, sql, 9);</span><br><span class="line">    System.out.println(&quot;delete row:&quot; + update);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void update() throws SQLException &#123;</span><br><span class="line">    QueryRunner queryRunner = new QueryRunner();</span><br><span class="line">    String sql = &quot;update sort set sname=?, sprice=?, sdesc=? where sid=9&quot;;</span><br><span class="line">    Object[] params = new Object[]&#123;&quot;null&quot;, 0, &quot;null--&quot;&#125;;</span><br><span class="line">    int update = queryRunner.update(connection, sql, params);</span><br><span class="line">    System.out.println(&quot;update row:&quot; + update);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void insert() throws SQLException &#123;</span><br><span class="line">    QueryRunner qR = new QueryRunner();</span><br><span class="line">    String sql = &quot;insert into sort values(?, ?, ?, ?)&quot;;</span><br><span class="line">    Object[] params = new Object[]&#123;9, &quot;体育用品&quot;, 299, &quot;购买&quot;&#125;;</span><br><span class="line">    int update = qR.update(connection, sql, params);</span><br><span class="line">    System.out.println(&quot;insert row:&quot; + update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ArrayHandler: 只得到 sql 结果的第一条记录，返回值：Object[]</span><br><span class="line">ArrayListHandler: 得到 sql 结果的全部数据， 返回值：List&lt;Object[]&gt;</span><br><span class="line">BeanHandler: Convert the first row of the ResultSet into a bean with the Class given in the constructor.</span><br><span class="line">BeanListHandler: </span><br><span class="line">ColumnHandler：Object</span><br><span class="line">ColumnListHandler: 取一列 返回 List&lt;Object&gt;</span><br><span class="line">ScalarHanlder:  查询后只有一个结果的时候使用。</span><br><span class="line">MapHandler: 列名：列值</span><br><span class="line">MapListHandler: List&lt;Map&lt;String, Object&gt;&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Bean 必须由 空构造函数， setter/getter</p>
</blockquote>
<h1 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h1><p>以 JDBC 为例子，用池子管理 Connection</p>
<p>连接池规范接口：<code>javas.sql.DataSource</code></p>
<p>常见连接池：DBCP,C3PO</p>
<h1 id="DBCP"><a href="#DBCP" class="headerlink" title="DBCP"></a>DBCP</h1><blockquote>
<p>Tomcat JavaWeb 服务器</p>
</blockquote>
<p>需要使用的 jar 包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commons-dbcp2-2.5.0.jar</span><br><span class="line">commons-pool2-2.5.0.jar</span><br></pre></td></tr></table></figure>
<p>基本使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BasicDataSource basicDataSource = new BasicDataSource();</span><br><span class="line">basicDataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">basicDataSource.setUrl(&quot;jdbc:mysql://localhost:3306/jdbc_ex?usee&quot;);</span><br><span class="line">basicDataSource.setUsername(&quot;root&quot;);</span><br><span class="line">basicDataSource.setPassword(</span><br><span class="line">try &#123;</span><br><span class="line">    Connection connection = basicDataSource.getConnection();</span><br><span class="line">&#125; catch (SQLException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    throw new RuntimeException(&quot;database connect fail&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="常见配置项目"><a href="#常见配置项目" class="headerlink" title="常见配置项目"></a>常见配置项目</h2><p>必须项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driverClassName</span><br><span class="line">url</span><br><span class="line">username</span><br><span class="line">password</span><br></pre></td></tr></table></figure>
<p>基本项（扩展）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">maxActive</span><br><span class="line">minidle</span><br><span class="line">maxidle</span><br><span class="line">initialSize</span><br></pre></td></tr></table></figure>
<h2 id="DBCPUtils"><a href="#DBCPUtils" class="headerlink" title="DBCPUtils"></a>DBCPUtils</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class JDBCUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static BasicDataSource dataSource = new BasicDataSource();</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        // 基本配置</span><br><span class="line">        dataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        dataSource.setUrl(&quot;jdbc:mysql://localhost:3306/jdbc_ex?useSSL=false&quot;);</span><br><span class="line">        dataSource.setUsername(&quot;root&quot;);</span><br><span class="line">        dataSource.setPassword(&quot;---&quot;);</span><br><span class="line"></span><br><span class="line">        // 其他配置</span><br><span class="line">        dataSource.setInitialSize(10); // 初始化连接数</span><br><span class="line">        dataSource.setMinIdle(2); // 最小空闲</span><br><span class="line">        dataSource.setMaxIdle(5); //最大空闲</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static DataSource getDataSource() &#123;</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>连接池使用–QueryRunner 创建简化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QueryRunner queryRunner = new QueryRunner(DBCPUtils.getDataSource());</span><br></pre></td></tr></table></figure>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><blockquote>
<p>Transaction</p>
</blockquote>
<h2 id="命令行模拟事务"><a href="#命令行模拟事务" class="headerlink" title="命令行模拟事务"></a>命令行模拟事务</h2><p>先关闭 autocommit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line">//sql</span><br><span class="line"></span><br><span class="line">commit; // rollback;</span><br></pre></td></tr></table></figure>
<h2 id="Connect-实现事务"><a href="#Connect-实现事务" class="headerlink" title="Connect 实现事务"></a>Connect 实现事务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Connection connection = JDBCUtils.getConnection();</span><br><span class="line">//关闭自动提交</span><br><span class="line">connection.setAutoCommit(false);</span><br><span class="line"></span><br><span class="line">//。。。sql</span><br><span class="line"></span><br><span class="line">connection.commit();</span><br><span class="line">//or</span><br><span class="line">connection.rollback();</span><br></pre></td></tr></table></figure>
<h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><ol>
<li>A 原子性，事务中包含的逻辑不可分割</li>
<li>C 一致性，数据的完整性</li>
<li>I 隔离性，事务在执行期间不能收到其他事务的影响</li>
<li>D 持久性，事务执行成功后数据持久保存</li>
</ol>
<h2 id="事务安全隐含"><a href="#事务安全隐含" class="headerlink" title="事务安全隐含"></a>事务安全隐含</h2><h3 id="读："><a href="#读：" class="headerlink" title="读："></a>读：</h3><ul>
<li>脏读：一个事务读到另一个事务未提交的数据</li>
<li>不可重读：一个事务读到另一个事务已提交的数据，导致两次查询结果不一致</li>
<li>幻读：一个事务读到另一个事务已提交的插入的数据，导致多次查询结果不一致</li>
</ul>
<h3 id="写："><a href="#写：" class="headerlink" title="写："></a>写：</h3><ul>
<li>丢失更新</li>
</ul>
<p>处理丢失更新问题：</p>
<ol>
<li>悲观锁：认为一定为出现数据丢失</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// for update 数据库的锁机制，排他锁</span><br><span class="line">select * from account for update</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在查询的时候加入 for update</p>
</blockquote>
<ol start="2">
<li>乐观锁</li>
</ol>
<blockquote>
<p>要求程序员自己控制</p>
</blockquote>
<p>数据库中额外加个字段(version).</p>
<p>事务在提交的时候，比较数据中的 version 和自己基于修改的 version 版本是否一致。</p>
<h3 id="隔离级别："><a href="#隔离级别：" class="headerlink" title="隔离级别："></a>隔离级别：</h3><ul>
<li>Read Uncommited, 读未提交，引发脏读</li>
<li>Read Committed，读已提交；引发 不可重读</li>
<li>Repeatable Read，可重复读；mysql 默认隔离级别，引发 幻读</li>
<li>Serializable，可串行化；安全，但是性能不好，需要等另一个事务结束才能继续事务</li>
</ul>
<p>效率:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">读未提交 &gt; 读已提交 &gt; 可重复读 &gt; 可串行化</span><br></pre></td></tr></table></figure>
<p>拦截程度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">读未提交 &lt; 读已提交 &lt; 可重复读 &lt; 可串行化</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/24/database/sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/24/database/sql/" itemprop="url">sql 学习记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-24T13:18:12+08:00">
                2018-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Database/" itemprop="url" rel="index">
                    <span itemprop="name">Database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="实用记录"><a href="#实用记录" class="headerlink" title="实用记录"></a>实用记录</h1><h2 id="insert-中内嵌-select"><a href="#insert-中内嵌-select" class="headerlink" title="insert 中内嵌 select"></a>insert 中内嵌 select</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_roles_permissions(role_id, permission_id) <span class="keyword">values</span>(<span class="number">1</span>, (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> sys_permissions <span class="keyword">where</span> permission <span class="keyword">like</span> <span class="string">'all'</span>));</span><br></pre></td></tr></table></figure>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>sql: Structure Query Language 结构化查询语言</p>
<p>ddl: 数据定义语言，create drop alter</p>
<p>dml：数据操纵语言， insert update delete</p>
<p>dcl: 数据控制语言, 定义访问权限，安全设置，取消访问权限，grant</p>
<p>DQL: 数据查询语言，select from whete</p>
<h1 id="数据库-CRUD"><a href="#数据库-CRUD" class="headerlink" title="数据库 CRUD"></a>数据库 CRUD</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 查看 mysql 中所有数据库</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">information_schema:</span><br><span class="line">mysql:</span><br><span class="line">perfomance_schema:</span><br><span class="line"></span><br><span class="line"># 创建数据库 数据库名称，字符集，校对规则</span><br><span class="line">create database db_example;</span><br><span class="line">create database db_example character set utf8;</span><br><span class="line">create database db_example character set utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"># 切换当前数据库</span><br><span class="line">use db_example;</span><br><span class="line"></span><br><span class="line"># 查看当前正在使用的数据库</span><br><span class="line">select database();</span><br><span class="line"></span><br><span class="line"># 查看数据库创建的语句</span><br><span class="line">show create database db_example;</span><br><span class="line"></span><br><span class="line"># 修改数据库</span><br><span class="line">alter database 数据库的名字 character set 字符集;</span><br></pre></td></tr></table></figure>
<p>删除数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名字;</span><br></pre></td></tr></table></figure>
<h1 id="表的-CRUD-操作"><a href="#表的-CRUD-操作" class="headerlink" title="表的 CRUD 操作"></a>表的 CRUD 操作</h1><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">    列名 列类型(长度) 约束,</span><br><span class="line">    列名2 列类型(长度) 约束,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">列类型：int char(固定长度) varchar(可变长度) double float boolean date(YYYY-MM-DD) time(hh:mm:ss) datetime(YYYY-MM-DD hh:mm:ss)默认是null timestamp(YYYY-MM-DD hh:mm:ss)默认使用当前时间 text(存放文本) blob(存放二进制)</span><br><span class="line">长度：mysql高版本中，代表字符个数，和是否是汉子无关</span><br><span class="line"></span><br><span class="line">列的约束:</span><br><span class="line">    主键约束: primary key</span><br><span class="line">    唯一约束: unique</span><br><span class="line">    非空约束: not null</span><br></pre></td></tr></table></figure>
<h2 id="查看表"><a href="#查看表" class="headerlink" title="查看表"></a>查看表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">查看表定义：查看表创建时使用的 sql 语句</span><br><span class="line">show create table 表名称;</span><br><span class="line"></span><br><span class="line">查看表结构：</span><br><span class="line">desc 表名;</span><br></pre></td></tr></table></figure>
<h2 id="修改表："><a href="#修改表：" class="headerlink" title="修改表："></a>修改表：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">添加列：add</span><br><span class="line">alter table 表名 add 列名 列类型 列约束;</span><br><span class="line"></span><br><span class="line">修改列：modify</span><br><span class="line">alter table 表名 modify 列名 列类型 列约束;</span><br><span class="line">alter table student modify sex varchar(2);</span><br><span class="line"></span><br><span class="line">修改列名：change</span><br><span class="line">alter table 表名称 change 旧列名 新列名 列类型(列长度) 列约束;</span><br><span class="line"></span><br><span class="line">删除列：drop</span><br><span class="line">alter table 表名 drop 列名;</span><br><span class="line"></span><br><span class="line">修改表名称：to</span><br><span class="line">remane table 表名 to 表名;</span><br><span class="line"></span><br><span class="line">修改表字符集：</span><br><span class="line">alter table 表名 character set 字符集;</span><br></pre></td></tr></table></figure>
<h2 id="删除表："><a href="#删除表：" class="headerlink" title="删除表："></a>删除表：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table 表名;</span><br></pre></td></tr></table></figure>
<h1 id="表中记录的-CRUD"><a href="#表中记录的-CRUD" class="headerlink" title="表中记录的 CRUD"></a>表中记录的 CRUD</h1><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 插入全数据</span><br><span class="line">insert into 表名(列名1， 列名2, 列名3) values(值1, 值2, 值3);</span><br><span class="line">insert into 表名 values(值1, 值2, 值3);</span><br><span class="line"></span><br><span class="line"># 批量插入</span><br><span class="line">insert into student values(值1, 值2, 值3),(值1, 值2, 值3),(值1, 值2, 值3);</span><br></pre></td></tr></table></figure>
<p>批量插入的效率比单条插入高，需要处理的语句少。<br>批量插入数据事务操作。</p>
<h2 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delete from 表名 [where 条件];</span><br><span class="line"></span><br><span class="line">没有指定条件就会删除全部数据。</span><br><span class="line"></span><br><span class="line">delete: DML 一条一条删除表中数据</span><br><span class="line">truncate: DDL 先删除表，再重建表 </span><br><span class="line">哪个效率高？：数据量少的时候 delete 高效，数据量多的时候 truncate 高效。</span><br><span class="line"></span><br><span class="line">删除表中所有数据：</span><br><span class="line">delete from table_name;</span><br><span class="line">truncate table table_name</span><br></pre></td></tr></table></figure>
<h2 id="更新表记录"><a href="#更新表记录" class="headerlink" title="更新表记录"></a>更新表记录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update 表名 set 列名=列值, 列名2=列值2 [where 条件];</span><br><span class="line"></span><br><span class="line">参数如果是字符串，日期 需要加单眼号。</span><br></pre></td></tr></table></figure>
<h2 id="查询记录"><a href="#查询记录" class="headerlink" title="查询记录"></a>查询记录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">select [distinct] [*] [列名，列名2] from 表名 [where 条件] [group by having] [order by];</span><br><span class="line"></span><br><span class="line">distinct: 去除重复的数据</span><br><span class="line"></span><br><span class="line">查询所有数据:</span><br><span class="line">select * from 表名;</span><br><span class="line"></span><br><span class="line">查询所有商品，显示指定列：</span><br><span class="line">select [列名, 列名] from 表名；</span><br><span class="line"></span><br><span class="line">别名查询： as 可以省略</span><br><span class="line">    表别名</span><br><span class="line">    select p.pname, p.price from product as p;</span><br><span class="line">    列别名</span><br><span class="line">    select pname as 商品名称, price as 商品价格  from product;</span><br><span class="line"></span><br><span class="line">去重复：</span><br><span class="line">select distinct price from product;</span><br><span class="line"></span><br><span class="line">select 运算查询：(在查询结果上做了运算):</span><br><span class="line">select *, price*1.5 as 加价格 from product;</span><br><span class="line">select pname, price, price*1.5 as 加价格 from product;</span><br><span class="line"></span><br><span class="line">条件查询 where: 指定条件，确定要操作的记录</span><br><span class="line">select * from product where price &gt; 60;</span><br><span class="line"></span><br><span class="line">    where 后的条件写法</span><br><span class="line">        -- 关系运算 &gt; &gt;= &lt; &lt;= = != &lt;&gt; (不等于)</span><br><span class="line">        -- 逻辑运算 and or not</span><br><span class="line">        -- 模糊查询 like, _代表一个字符，% 代表多个字符</span><br><span class="line">            select * from product where pname like &apos;_熊%&apos;;</span><br><span class="line">        -- 在某个范围值内 in</span><br><span class="line">            select * from product where cno in (1,4,5);</span><br><span class="line">        -- 排序查询 order by 关键字 asc: ascend 升序(默认), desc descend 降序</span><br><span class="line">            select * from product order by price;</span><br><span class="line">            select * from product order by price desc;</span><br><span class="line">            select * from product where pname like &apos;%小%&apos; order by price desc;</span><br><span class="line"></span><br><span class="line">聚合函数</span><br><span class="line">    sum()</span><br><span class="line">        select sum(price) from product;</span><br><span class="line">    avg(),</span><br><span class="line">        select avg(price) from product;</span><br><span class="line">    count(),</span><br><span class="line">        select count(price) from product;</span><br><span class="line">    max(),</span><br><span class="line">        select max(price) from product;</span><br><span class="line">    min(),</span><br><span class="line">        select min(price) from product;</span><br><span class="line"></span><br><span class="line">    where 后面不能使用聚合函数！</span><br><span class="line">        (错误)select * from product where price &gt; avg(price); </span><br><span class="line">        (正确)select * from product where price &gt; (select avg(price) from product);</span><br><span class="line"></span><br><span class="line">分组：group by</span><br><span class="line"></span><br><span class="line">    根据字段分组, 分组后统计个数：</span><br><span class="line">        select cno, count(*) from product group by cno;</span><br><span class="line">    根据字段分组,</span><br><span class="line">        select cno, avg(price) </span><br><span class="line">        from product group by cno</span><br><span class="line">        having avg(price) &gt; 60;</span><br><span class="line">    having 关键字，可以接聚合函数，出现在分组之后，</span><br><span class="line">    where 关键字，不能接聚合函数，出现在分组之前</span><br><span class="line"></span><br><span class="line">编写顺序：</span><br><span class="line"></span><br><span class="line">    select .. from .. where .. group by .. having .. order by</span><br><span class="line"></span><br><span class="line">执行顺序</span><br><span class="line">    </span><br><span class="line">    from .. where .. group by .. having .. select .. order by</span><br></pre></td></tr></table></figure>
<h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>建立数据库原则：</p>
<ol>
<li>一个项目一个数据库</li>
</ol>
<p>多表之间的关系如何维护：</p>
<ol>
<li>外键约束<br> alter table product add foreign key(cno) references category(cid);</li>
<li>多表之间的建表原则<br> 一对多：多的一边加外键<br> 多对多：通过中间表维护关系，中间表至少有两个外键分别指向两个表。<br> 一对一：一张表维护；两张表使用同一个 id 作为主键；使用外键<pre><code>拆表操作：将常用信息和不常用信息拆开，减少臃肿
</code></pre></li>
</ol>
<p>商城例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">    uid int primary key auto_increment,</span><br><span class="line">    username varchar(31),</span><br><span class="line">    password varchar(31),</span><br><span class="line">    phone varchar(11)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into user values(null, &apos;章三&apos;, &apos;111111&apos;, &apos;15669262390&apos;);</span><br><span class="line"></span><br><span class="line">订单表：</span><br><span class="line">create table orders (</span><br><span class="line">    oid int primary key auto_increment,</span><br><span class="line">    sum int not null,</span><br><span class="line">    otime timestamp,</span><br><span class="line">    address varchar(100),</span><br><span class="line">    uno int,</span><br><span class="line">    foreign key(uno) references user(uid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into orders values(null, 200, null, &apos;北京海淀&apos;, 1);</span><br><span class="line">insert into orders values(null, 234, null, &apos;北京朝阳&apos;, 1);</span><br><span class="line"></span><br><span class="line">商品分类表：</span><br><span class="line">create table category(</span><br><span class="line">    cid int primary key auto_increment,</span><br><span class="line">    cname varchar(15),</span><br><span class="line">    cdesc varchar(100)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into category values(null, &apos;手机数码&apos;, &apos;电子产品&apos;);</span><br><span class="line">insert into category values(null, &apos;鞋靴箱包&apos;, &apos;江南皮革厂&apos;);</span><br><span class="line">insert into category values(null, &apos;香烟水酒&apos;, &apos;茅台，二锅头&apos;);</span><br><span class="line">insert into category values(null, &apos;酸奶饼干&apos;, &apos;哇哈哈，蒙牛伊利&apos;);</span><br><span class="line">insert into category values(null, &apos;馋嘴零食&apos;, &apos;瓜子花生，八宝粥&apos;);</span><br><span class="line"></span><br><span class="line">商品表:</span><br><span class="line">create table product(</span><br><span class="line">    pid int primary key auto_increment,</span><br><span class="line">    pname varchar(10),</span><br><span class="line">    price double,</span><br><span class="line">    cno int,</span><br><span class="line">    foreign key(cno) references category(cid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into product values(null, &apos;小米mix2&apos;, 998, 1);</span><br><span class="line">insert into product values(null, &apos;锤子&apos;, 2998, 1);</span><br><span class="line">insert into product values(null, &apos;adidas&apos;, 299, 2);</span><br><span class="line">insert into product values(null, &apos;老村长&apos;, 89, 3);</span><br><span class="line">insert into product values(null, &apos;劲酒&apos;, 35, 3);</span><br><span class="line">insert into product values(null, &apos;小熊饼干&apos;, 1, 4);</span><br><span class="line">insert into product values(null, &apos;卫龙辣条&apos;, 1, 5);</span><br><span class="line">insert into product values(null, &apos;旺旺血饼&apos;, 1, 5);</span><br><span class="line"></span><br><span class="line">订单项目：中间表(订单-商品)</span><br><span class="line">create table orderitem(</span><br><span class="line">    ono int,</span><br><span class="line">    pno int,</span><br><span class="line">    foreign key(ono) references orders(oid),</span><br><span class="line">    foreign key(pno) references product(pid),</span><br><span class="line">    ocount int,</span><br><span class="line">    subsum double</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into orderitem value(1, 7, 100, 100);</span><br><span class="line">insert into orderitem value(1, 8, 101, 101);</span><br><span class="line"></span><br><span class="line">insert into orderitem value(2, 5, 1, 35);</span><br><span class="line">insert into orderitem value(2, 1, 3, 998);</span><br></pre></td></tr></table></figure>
<h2 id="多表查询-1"><a href="#多表查询-1" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="交叉连接查询，笛卡尔积："><a href="#交叉连接查询，笛卡尔积：" class="headerlink" title="交叉连接查询，笛卡尔积："></a>交叉连接查询，笛卡尔积：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from product;</span><br><span class="line">select * from category;</span><br><span class="line"></span><br><span class="line">(无意义)select * from product, category;</span><br><span class="line">(过滤有意义的数据) select * from product as p, category as c where p.cno=c.cid;</span><br><span class="line">(过滤有意义的数据) select * from product p, category c where p.cno=c.cid;</span><br></pre></td></tr></table></figure>
<p>内连接查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 隐式内连接</span><br><span class="line">select * from product p, category c where p.cno=c.cid;</span><br><span class="line"></span><br><span class="line">--显示内连接</span><br><span class="line">select * from product p INNER JOIN category c ON p.cno=c.cid;</span><br><span class="line"></span><br><span class="line">区别：</span><br><span class="line">隐式连接：在查询的结果上做条件过滤</span><br><span class="line">显示连接：带着条件去查询结果，效率高</span><br><span class="line"></span><br><span class="line">左外连接：保证左表全，右边没有对应的数据使用 NULL 填充</span><br><span class="line">SELECT * FROM product p LEFT OUTER JOIN category c ON p.cno=c.cid;</span><br><span class="line">右外连接：保证右表全</span><br><span class="line">SELECT * FROM product p RIGHT OUTER JOIN category c ON p.cno=c.cid;</span><br><span class="line"></span><br><span class="line">INSERT INTO product values(null, &apos;NIKE&apos;, 800, NULL);</span><br></pre></td></tr></table></figure>
<p>内连接:交集；<br>左外连接：左边表全部；<br>右外连接：右边表全部；</p>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">limit 索引 个数</span><br><span class="line"></span><br><span class="line">select * from product limit 0, 2;</span><br><span class="line">select * from product limit 1, 2;</span><br><span class="line"></span><br><span class="line">startIndex = (index-1)*2</span><br></pre></td></tr></table></figure>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询分类为手机数码的所有商品：</span><br><span class="line">select cid from category c where cname=&apos;手机数码&apos;;</span><br><span class="line">select * from product p where p.cid=1;</span><br><span class="line"></span><br><span class="line">查询商品名称和商品分类的信息:</span><br><span class="line">左连接：</span><br><span class="line">select p.pname,c.cname from product p LEFT OUTER JOIN category c on p.cno=cid;</span><br><span class="line">子查询</span><br><span class="line">select p.pname, (select cname from category c where p.cno=c.cid) 商品名称 FROM product p;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/17/flutter/项目模块拆分/日志/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/17/flutter/项目模块拆分/日志/" itemprop="url">日志</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-17T13:18:12+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://pub.dartlang.org/packages/logging#-readme-tab-" target="_blank" rel="noopener">https://pub.dartlang.org/packages/logging</a></p>
<p><code>log.dart</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import &apos;package:logging/logging.dart&apos;;</span><br><span class="line"></span><br><span class="line">class Log &#123;</span><br><span class="line">  static final Logger log = new Logger(&apos;Log&apos;);</span><br><span class="line"></span><br><span class="line">  static bool needInit = true;</span><br><span class="line"></span><br><span class="line">  static const String TAG = &apos;App&apos;;</span><br><span class="line"></span><br><span class="line">  static d(&#123;String tag = TAG, String message&#125;) &#123;</span><br><span class="line">    init();</span><br><span class="line">    log.fine(&apos;$tag ====&gt; $message&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static void init() &#123;</span><br><span class="line">    if (needInit) &#123;</span><br><span class="line">      needInit = false;</span><br><span class="line">      Logger.root.level = Level.ALL;</span><br><span class="line">      Logger.root.onRecord.listen((LogRecord rec) &#123;</span><br><span class="line">        print(&apos;$&#123;rec.level.name&#125;: $&#123;rec.time&#125;: $&#123;rec.message&#125;&apos;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static w(&#123;String tag = TAG, String message&#125;) &#123;</span><br><span class="line">    init();</span><br><span class="line">    log.warning(&apos;$tag ====&gt; $message&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static e(&#123;String tag = TAG, String message&#125;) &#123;</span><br><span class="line">    init();</span><br><span class="line">    log.severe(&apos;$tag ====&gt; $message&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/head1.jpg" alt="Double">
          <p class="site-author-name" itemprop="name">Double</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">548</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">260</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Double</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
