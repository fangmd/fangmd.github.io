<!doctype html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Double">
<meta property="og:url" content="http://yoursite.com/page/29/index.html">
<meta property="og:site_name" content="Double">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Double">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/29/">





  <title>Double</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Double</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/14/Python/django/offical-doc/Django-Forms-Built-in widgets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/14/Python/django/offical-doc/Django-Forms-Built-in widgets/" itemprop="url">Django Forms - Built-in Widgets</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-14T13:18:12+08:00">
                2016-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>A widget is Django’s representation of an HTML input element. The widget handles the rendering of the HTML, and the extraction of data from a GET/POST dictionary that corresponds to the widget.</p>
<h1 id="Specifying-widgets"><a href="#Specifying-widgets" class="headerlink" title="Specifying widgets"></a>Specifying widgets</h1><p>当我们定义一个 field 在 form 中时，Django 会使用默认的 widget 作为这个 field 在 html 中的显示控件。</p>
<p>如果要使用非默认的 widget：</p>
<pre><code>from django import forms

class CommentForm(forms.Form):
    name = forms.CharField()
    url = forms.URLField()
    comment = forms.CharField(widget=forms.Textarea)
</code></pre><h1 id="Setting-arguments-for-widgets"><a href="#Setting-arguments-for-widgets" class="headerlink" title="Setting arguments for widgets"></a>Setting arguments for widgets</h1><p>很多 widget 都会有一些额外的参数可以设置，可以设置 widget 的时候设置参数：</p>
<pre><code>from django import forms

BIRTH_YEAR_CHOICES = (&apos;1980&apos;, &apos;1981&apos;, &apos;1982&apos;)
FAVORITE_COLORS_CHOICES = (
    (&apos;blue&apos;, &apos;Blue&apos;),
    (&apos;green&apos;, &apos;Green&apos;),
    (&apos;black&apos;, &apos;Black&apos;),
)

class SimpleForm(forms.Form):
    birth_year = forms.DateField(widget=forms.SelectDateWidget(years=BIRTH_YEAR_CHOICES))
    favorite_colors = forms.MultipleChoiceField(
        required=False,
        widget=forms.CheckboxSelectMultiple,
        choices=FAVORITE_COLORS_CHOICES,
    )
</code></pre><h1 id="Widgets-inheriting-from-the-Select-widget"><a href="#Widgets-inheriting-from-the-Select-widget" class="headerlink" title="Widgets inheriting from the Select widget"></a>Widgets inheriting from the Select widget</h1><h1 id="Customizing-widget-instances"><a href="#Customizing-widget-instances" class="headerlink" title="Customizing widget instances"></a>Customizing widget instances</h1><h1 id="Base-widget-classes"><a href="#Base-widget-classes" class="headerlink" title="Base widget classes"></a>Base widget classes</h1><h1 id="Built-in-widgets"><a href="#Built-in-widgets" class="headerlink" title="Built-in widgets"></a>Built-in widgets</h1><h2 id="Widgets-handling-input-of-text"><a href="#Widgets-handling-input-of-text" class="headerlink" title="Widgets handling input of text"></a>Widgets handling input of text</h2><h3 id="TextInput"><a href="#TextInput" class="headerlink" title="TextInput"></a>TextInput</h3><pre><code>&lt;input type=&quot;text&quot; ...&gt;
</code></pre><h3 id="NumberInput"><a href="#NumberInput" class="headerlink" title="NumberInput"></a>NumberInput</h3><pre><code>&lt;input type=&quot;number&quot; ...&gt;
</code></pre><h3 id="EmailInput"><a href="#EmailInput" class="headerlink" title="EmailInput"></a>EmailInput</h3><pre><code>&lt;input type=&quot;email&quot; ...&gt;
</code></pre><h3 id="URLInput"><a href="#URLInput" class="headerlink" title="URLInput"></a>URLInput</h3><pre><code>&lt;input type=&quot;url&quot; ...&gt;
</code></pre><h3 id="PasswordInput"><a href="#PasswordInput" class="headerlink" title="PasswordInput"></a>PasswordInput</h3><pre><code>&lt;input type=&apos;password&apos; ...&gt;
</code></pre><h3 id="HiddenInput"><a href="#HiddenInput" class="headerlink" title="HiddenInput"></a>HiddenInput</h3><pre><code>&lt;input type=&apos;hidden&apos; ...&gt;
</code></pre><h3 id="DateInput"><a href="#DateInput" class="headerlink" title="DateInput"></a>DateInput</h3><pre><code>&lt;input type=&apos;text&apos; ...&gt;
</code></pre><p><code>format</code> <code>DATE_INPUT_FORMATS</code></p>
<h3 id="DateTimeInput"><a href="#DateTimeInput" class="headerlink" title="DateTimeInput"></a>DateTimeInput</h3><pre><code>&lt;input type=&apos;text&apos; ...&gt;
</code></pre><p><code>format</code> <code>DATETIME_INPUT_FORMATS</code></p>
<h3 id="TimeInput"><a href="#TimeInput" class="headerlink" title="TimeInput"></a>TimeInput</h3><pre><code>&lt;input type=&apos;text&apos; ...&gt;
</code></pre><p><code>format</code> <code>TIME_INPUT_FORMATS</code></p>
<h3 id="Textarea"><a href="#Textarea" class="headerlink" title="Textarea"></a>Textarea</h3><pre><code>&lt;textarea&gt;...&lt;/textarea&gt;
</code></pre><h2 id="Selector-and-checkbox-widgets"><a href="#Selector-and-checkbox-widgets" class="headerlink" title="Selector and checkbox widgets"></a>Selector and checkbox widgets</h2><h3 id="CheckboxInput"><a href="#CheckboxInput" class="headerlink" title="CheckboxInput"></a>CheckboxInput</h3><pre><code>&lt;input type=&apos;checkbox&apos; ...&gt;
</code></pre><h3 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h3><pre><code>&lt;select&gt;&lt;option ...&gt;...&lt;/select&gt;
</code></pre><h3 id="NullBooleanSelect"><a href="#NullBooleanSelect" class="headerlink" title="NullBooleanSelect"></a>NullBooleanSelect</h3><h3 id="SelectMultiple"><a href="#SelectMultiple" class="headerlink" title="SelectMultiple"></a>SelectMultiple</h3><pre><code>&lt;select multiple=&apos;multiple&apos;&gt;...&lt;/select&gt;
</code></pre><h3 id="RadioSelect"><a href="#RadioSelect" class="headerlink" title="RadioSelect"></a>RadioSelect</h3><pre><code>&lt;ul&gt;
  &lt;li&gt;&lt;input type=&apos;radio&apos; name=&apos;...&apos;&gt;&lt;/li&gt;
  ...
&lt;/ul&gt;
</code></pre><h3 id="CheckboxSelectMultiple"><a href="#CheckboxSelectMultiple" class="headerlink" title="CheckboxSelectMultiple"></a>CheckboxSelectMultiple</h3><pre><code>&lt;ul&gt;
  &lt;li&gt;&lt;input type=&apos;checkbox&apos; name=&apos;...&apos; &gt;&lt;/li&gt;
  ...
&lt;/ul&gt;
</code></pre><h2 id="File-upload-widgets"><a href="#File-upload-widgets" class="headerlink" title="File upload widgets"></a>File upload widgets</h2><h3 id="FileInput"><a href="#FileInput" class="headerlink" title="FileInput"></a>FileInput</h3><h3 id="ClearableFileInput"><a href="#ClearableFileInput" class="headerlink" title="ClearableFileInput"></a>ClearableFileInput</h3><h2 id="Composite-widgets"><a href="#Composite-widgets" class="headerlink" title="Composite widgets"></a>Composite widgets</h2><h3 id="MultipleHiddenInput"><a href="#MultipleHiddenInput" class="headerlink" title="MultipleHiddenInput"></a>MultipleHiddenInput</h3><h3 id="SplitDateTimeWidget"><a href="#SplitDateTimeWidget" class="headerlink" title="SplitDateTimeWidget"></a>SplitDateTimeWidget</h3><h3 id="SplitHiddenDateTimeWidget"><a href="#SplitHiddenDateTimeWidget" class="headerlink" title="SplitHiddenDateTimeWidget"></a>SplitHiddenDateTimeWidget</h3><h3 id="SelectDateWidget"><a href="#SelectDateWidget" class="headerlink" title="SelectDateWidget"></a>SelectDateWidget</h3><p>###</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/Android/Android 版本/Android7.0-N/FileProvider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/Android/Android 版本/Android7.0-N/FileProvider/" itemprop="url">FileProvider</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-13T22:38:14+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="FileProvider"><a href="#FileProvider" class="headerlink" title="FileProvider"></a>FileProvider</h1><p>FileProvider 继承自 ContentProvider ,它会创建一个格式为 <code>content://</code> 的 Uri 而不是 <code>file:///</code>。</p>
<p>内容的 URI 允许我们读写它所指向的文件。当我们要将一个包含 URI 的 Intent 传递到另一个 APP 的时候，可以通过设置 Intent.setFlags() 来添加权限，这个权限的有效期是接收方 Activity 或者 Service 的生命周期。</p>
<h2 id="Defining-a-FileProvider"><a href="#Defining-a-FileProvider" class="headerlink" title="Defining a FileProvider"></a>Defining a FileProvider</h2><p>不需要继承 FileProvider 直接在 AndroidManifest 中注册就可以：</p>
<pre><code>&lt;manifest&gt;
    ...
    &lt;application&gt;
        ...
        &lt;provider
            android:name=&quot;android.support.v4.content.FileProvider&quot;
            android:authorities=&quot;com.mydomain.fileprovider&quot;
            android:exported=&quot;false&quot;
            android:grantUriPermissions=&quot;true&quot;&gt;
            ...
        &lt;/provider&gt;
        ...
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre><p>如果要做从写里面的方法，也可以继承他，然后注册。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/12/13/Android/Android 版本/Android7.0-N/FileProvider/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/Python/django/offical-doc/Django-Forms-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/Python/django/offical-doc/Django-Forms-API/" itemprop="url">Django Forms - API</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-13T13:18:12+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Bound-and-unbound-forms"><a href="#Bound-and-unbound-forms" class="headerlink" title="Bound and unbound forms"></a>Bound and unbound forms</h1><p>Form 实例可以 bound 数据也不可 unbound</p>
<ul>
<li>如果 bound 数据，form 可以验证数据的正确性，并且渲染结合数据成 HTML。</li>
<li>如果 unbound，form 不能验证数据的正确性（因为没有数据），但是同样可以渲染成 html</li>
</ul>
<h3 id="class-Form"><a href="#class-Form" class="headerlink" title="class Form"></a>class Form</h3><p>create Form instance:</p>
<pre><code>f = ContactForm()
</code></pre><p>bind data to form 通过 dictionary 作为第一个参数:</p>
<pre><code>data = {&apos;subject&apos;: &apos;hello&apos;, &apos;message&apos;: &apos;hi there&apos;, &apos;sender&apos;: &apos;foo@example.com&apos;, &apos;cc_myself&apos;: True}

f = ContactForm(data)
</code></pre><p>dictionary: key 就是 field names,</p>
<h3 id="is-bound"><a href="#is-bound" class="headerlink" title="is_bound"></a>is_bound</h3><p>判断 Form 是否已经绑定数据：</p>
<pre><code>f = ContactForm()
f.is_bound # False

f = ContactForm({&apos;subject&apos;: &apos;hello&apos;})
f.is_bound # True

f = ContactForm({})
f.is_bound # True
</code></pre><p>一个 Form 实例初始化后就不能改变它所绑定的数据了，如果要改变只能重新创建新的 Form 对象使用</p>
<h1 id="Using-forms-to-validate-data"><a href="#Using-forms-to-validate-data" class="headerlink" title="Using forms to validate data"></a>Using forms to validate data</h1><h3 id="Form-clean"><a href="#Form-clean" class="headerlink" title="Form.clean()"></a>Form.clean()</h3><h3 id="Form-is-valid"><a href="#Form-is-valid" class="headerlink" title="Form.is_valid()"></a>Form.is_valid()</h3><p>validate data</p>
<h3 id="Form-errors"><a href="#Form-errors" class="headerlink" title="Form.errors"></a>Form.errors</h3><pre><code>&gt;&gt;&gt; data = {&apos;subject&apos;: &apos;&apos;,
...         &apos;message&apos;: &apos;Hi there&apos;,
...         &apos;sender&apos;: &apos;invalid email address&apos;,
...         &apos;cc_myself&apos;: True}
&gt;&gt;&gt; f = ContactForm(data)
&gt;&gt;&gt; f.is_valid()

&gt;&gt;&gt; f.errors
{&apos;sender&apos;: [&apos;Enter a valid email address.&apos;], &apos;subject&apos;: [&apos;This field is required.&apos;]}
</code></pre><h3 id="Form-errors-as-data"><a href="#Form-errors-as-data" class="headerlink" title="Form.errors.as_data()"></a>Form.errors.as_data()</h3><pre><code>&gt;&gt;&gt; f.errors.as_data()
{&apos;sender&apos;: [ValidationError([&apos;Enter a valid email address.&apos;])],
&apos;subject&apos;: [ValidationError([&apos;This field is required.&apos;])]}
</code></pre><h3 id="Form-errors-as-json-escape-html-False"><a href="#Form-errors-as-json-escape-html-False" class="headerlink" title="Form.errors.as_json(escape_html=False)"></a>Form.errors.as_json(escape_html=False)</h3><pre><code>&gt;&gt;&gt; f.errors.as_json()
{&quot;sender&quot;: [{&quot;message&quot;: &quot;Enter a valid email address.&quot;, &quot;code&quot;: &quot;invalid&quot;}],
&quot;subject&quot;: [{&quot;message&quot;: &quot;This field is required.&quot;, &quot;code&quot;: &quot;required&quot;}]}
</code></pre><h3 id="Form-add-error-field-error"><a href="#Form-add-error-field-error" class="headerlink" title="Form.add_error(field, error)"></a>Form.add_error(field, error)</h3><h3 id="Form-non-field-errors"><a href="#Form-non-field-errors" class="headerlink" title="Form.non_field_errors()"></a>Form.non_field_errors()</h3><h2 id="Behavior-of-unbound-forms"><a href="#Behavior-of-unbound-forms" class="headerlink" title="Behavior of unbound forms"></a>Behavior of unbound forms</h2><pre><code>&gt;&gt;&gt; f = ContactForm()
&gt;&gt;&gt; f.is_valid()
False
&gt;&gt;&gt; f.errors
{}
</code></pre><h1 id="Dynamic-initial-values"><a href="#Dynamic-initial-values" class="headerlink" title="Dynamic initial values"></a>Dynamic initial values</h1><h3 id="Form-initial"><a href="#Form-initial" class="headerlink" title="Form.initial"></a>Form.initial</h3><pre><code>&gt;&gt;&gt; f = ContactForm(initial={&apos;subject&apos;: &apos;Hi there!&apos;})
</code></pre><h1 id="Checking-which-form-data-has-changed"><a href="#Checking-which-form-data-has-changed" class="headerlink" title="Checking which form data has changed"></a>Checking which form data has changed</h1><h3 id="Form-has-changed"><a href="#Form-has-changed" class="headerlink" title="Form.has_changed()"></a>Form.has_changed()</h3><p>判断是否有数据改变了</p>
<pre><code>&gt;&gt;&gt; data = {&apos;subject&apos;: &apos;hello&apos;,
...         &apos;message&apos;: &apos;Hi there&apos;,
...         &apos;sender&apos;: &apos;foo@example.com&apos;,
...         &apos;cc_myself&apos;: True}
&gt;&gt;&gt; f = ContactForm(data, initial=data)
&gt;&gt;&gt; f.has_changed()
False
</code></pre><p>当 form 提交的时候，我们创建一个新的 form 实例，并且验证数据比较和原始数据的差别。</p>
<pre><code>&gt;&gt;&gt; f = ContactForm(request.POST, initial=data)
&gt;&gt;&gt; f.has_changed()
</code></pre><h3 id="Form-changed-data"><a href="#Form-changed-data" class="headerlink" title="Form.changed_data"></a>Form.changed_data</h3><h1 id="Accessing-the-fields-from-the-form"><a href="#Accessing-the-fields-from-the-form" class="headerlink" title="Accessing the fields from the form"></a>Accessing the fields from the form</h1><h3 id="Form-fields"><a href="#Form-fields" class="headerlink" title="Form.fields"></a>Form.fields</h3><pre><code>&gt;&gt;&gt; for row in f.fields.values(): print(row)
...
&lt;django.forms.fields.CharField object at 0x7ffaac632510&gt;
&lt;django.forms.fields.URLField object at 0x7ffaac632f90&gt;
&lt;django.forms.fields.CharField object at 0x7ffaac3aa050&gt;
&gt;&gt;&gt; f.fields[&apos;name&apos;]
&lt;django.forms.fields.CharField object at 0x7ffaac6324d0&gt;
</code></pre><p>可以改变 Form 实例的 field：</p>
<pre><code>&gt;&gt;&gt; f.as_table().split(&apos;\n&apos;)[0]
&apos;&lt;tr&gt;&lt;th&gt;Name:&lt;/th&gt;&lt;td&gt;&lt;input name=&quot;name&quot; type=&quot;text&quot; value=&quot;instance&quot; required /&gt;&lt;/td&gt;&lt;/tr&gt;&apos;
&gt;&gt;&gt; f.fields[&apos;name&apos;].label = &quot;Username&quot;
&gt;&gt;&gt; f.as_table().split(&apos;\n&apos;)[0]
&apos;&lt;tr&gt;&lt;th&gt;Username:&lt;/th&gt;&lt;td&gt;&lt;input name=&quot;name&quot; type=&quot;text&quot; value=&quot;instance&quot; required /&gt;&lt;/td&gt;&lt;/tr&gt;&apos;
</code></pre><h1 id="Accessing-“clean”-data"><a href="#Accessing-“clean”-data" class="headerlink" title="Accessing “clean” data"></a>Accessing “clean” data</h1><h3 id="Form-cleaned-data"><a href="#Form-cleaned-data" class="headerlink" title="Form.cleaned_data"></a>Form.cleaned_data</h3><pre><code>&gt;&gt;&gt; data = {&apos;subject&apos;: &apos;hello&apos;,
...         &apos;message&apos;: &apos;Hi there&apos;,
...         &apos;sender&apos;: &apos;foo@example.com&apos;,
...         &apos;cc_myself&apos;: True}
&gt;&gt;&gt; f = ContactForm(data)
&gt;&gt;&gt; f.is_valid()
True
&gt;&gt;&gt; f.cleaned_data
{&apos;cc_myself&apos;: True, &apos;message&apos;: &apos;Hi there&apos;, &apos;sender&apos;: &apos;foo@example.com&apos;, &apos;subject&apos;: &apos;hello&apos;}
</code></pre><h1 id="Outputting-forms-as-HTML"><a href="#Outputting-forms-as-HTML" class="headerlink" title="Outputting forms as HTML"></a>Outputting forms as HTML</h1><pre><code>&gt;&gt;&gt; f = ContactForm()
&gt;&gt;&gt; print(f)
</code></pre><h2 id="as-p"><a href="#as-p" class="headerlink" title="as_p()"></a>as_p()</h2><h2 id="as-ul"><a href="#as-ul" class="headerlink" title="as_ul()"></a>as_ul()</h2><h2 id="as-table"><a href="#as-table" class="headerlink" title="as_table()"></a>as_table()</h2><h2 id="Styling-required-or-erroneous-form-rows"><a href="#Styling-required-or-erroneous-form-rows" class="headerlink" title="Styling required or erroneous form rows"></a>Styling required or erroneous form rows</h2><h2 id="Configuring-form-elements’HTML-id-attributes-and-tags"><a href="#Configuring-form-elements’HTML-id-attributes-and-tags" class="headerlink" title="Configuring form elements’HTML id attributes and  tags"></a>Configuring form elements’HTML id attributes and <label> tags</label></h2><h2 id="Notes-on-field-ordering"><a href="#Notes-on-field-ordering" class="headerlink" title="Notes on field ordering"></a>Notes on field ordering</h2><h2 id="How-errors-are-displayed"><a href="#How-errors-are-displayed" class="headerlink" title="How errors are displayed"></a>How errors are displayed</h2><h2 id="Customizing-the-error-list-format"><a href="#Customizing-the-error-list-format" class="headerlink" title="Customizing the error list format"></a>Customizing the error list format</h2><h1 id="More-granular-output"><a href="#More-granular-output" class="headerlink" title="More granular output"></a>More granular output</h1><p>The <code>as_p()</code>, <code>as_ul()</code>, and <code>as_table()</code> methods are simply shortcuts – they’re not the only way a form object can be displayed.</p>
<h3 id="class-BoundField"><a href="#class-BoundField" class="headerlink" title="class BoundField"></a>class BoundField</h3><h2 id="Attributes-of-BoundField"><a href="#Attributes-of-BoundField" class="headerlink" title="Attributes of BoundField"></a>Attributes of BoundField</h2><h2 id="Methods-of-BoundField"><a href="#Methods-of-BoundField" class="headerlink" title="Methods of BoundField"></a>Methods of BoundField</h2><h3 id="BoundField-as-hidden-attrs-None-kwargs"><a href="#BoundField-as-hidden-attrs-None-kwargs" class="headerlink" title="BoundField.as_hidden(attrs=None, **kwargs)"></a>BoundField.as_hidden(attrs=None, **kwargs)</h3><h3 id="BoundField-as-widget-widget-None-attrs-None-only-initial-False"><a href="#BoundField-as-widget-widget-None-attrs-None-only-initial-False" class="headerlink" title="BoundField.as_widget(widget=None, attrs=None, only_initial=False)"></a>BoundField.as_widget(widget=None, attrs=None, only_initial=False)</h3><h3 id="BoundField-css-classes"><a href="#BoundField-css-classes" class="headerlink" title="BoundField.css_classes()"></a>BoundField.css_classes()</h3><h3 id="BoundField-label-tag-contents-None-attrs-None-label-suffix-None"><a href="#BoundField-label-tag-contents-None-attrs-None-label-suffix-None" class="headerlink" title="BoundField.label_tag(contents=None, attrs=None, label_suffix=None)"></a>BoundField.label_tag(contents=None, attrs=None, label_suffix=None)</h3><h3 id="BoundField-value"><a href="#BoundField-value" class="headerlink" title="BoundField.value()"></a>BoundField.value()</h3><h1 id="Customizing-BoundField"><a href="#Customizing-BoundField" class="headerlink" title="Customizing BoundField"></a>Customizing BoundField</h1><h1 id="Binding-uploaded-files-to-a-form"><a href="#Binding-uploaded-files-to-a-form" class="headerlink" title="Binding uploaded files to a form"></a>Binding uploaded files to a form</h1><p>first，为了能够上传文件，需要在 <code>&lt;form&gt;</code> 元素中定义 <code>enctype=&quot;multipart/form-data&quot;</code>:</p>
<pre><code>&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; action=&quot;/foo/&quot;&gt;
</code></pre><p>secondly，当我们使用 form 的时候，需要绑定文件数据，文件数据的处理和普通的表单数据处理是分开的：</p>
<pre><code># Bound form with an image field
&gt;&gt;&gt; from django.core.files.uploadedfile import SimpleUploadedFile
&gt;&gt;&gt; data = {&apos;subject&apos;: &apos;hello&apos;,
...         &apos;message&apos;: &apos;Hi there&apos;,
...         &apos;sender&apos;: &apos;foo@example.com&apos;,
...         &apos;cc_myself&apos;: True}
&gt;&gt;&gt; file_data = {&apos;mugshot&apos;: SimpleUploadedFile(&apos;face.jpg&apos;, &lt;file data&gt;)}
&gt;&gt;&gt; f = ContactFormWithMugshot(data, file_data)
</code></pre><p>从一个请求中绑定数据：</p>
<pre><code># Bound form with an image field, data from the request
&gt;&gt;&gt; f = ContactFormWithMugshot(request.POST, request.FILES)
</code></pre><p>unbound：</p>
<pre><code># Unbound form with an image field
&gt;&gt;&gt; f = ContactFormWithMugshot()
</code></pre><h2 id="Testing-for-multipart-forms"><a href="#Testing-for-multipart-forms" class="headerlink" title="Testing for multipart forms"></a>Testing for multipart forms</h2><h3 id="Form-is-multipart"><a href="#Form-is-multipart" class="headerlink" title="Form.is_multipart()"></a>Form.is_multipart()</h3><p>判断表单是否是包含文件上传：</p>
<pre><code>&gt;&gt;&gt; f = ContactFormWithMugshot()
&gt;&gt;&gt; f.is_multipart()
True
</code></pre><p>template example：</p>
<pre><code>{% if form.is_multipart %}
        <form enctype="multipart/form-data" method="post" action="/foo/">
    {% else %}
        <form method="post" action="/foo/">
    {% endif %}
{{ form }}
&lt;/form&gt;
</form></form></code></pre><h1 id="Subclassing-forms"><a href="#Subclassing-forms" class="headerlink" title="Subclassing forms"></a>Subclassing forms</h1><h1 id="Prefixes-for-forms"><a href="#Prefixes-for-forms" class="headerlink" title="Prefixes for forms"></a>Prefixes for forms</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/Python/django/offical-doc/Django-Forms-Overview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/Python/django/offical-doc/Django-Forms-Overview/" itemprop="url">Django Forms - Overview</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-13T13:18:12+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Overview</p>
<h1 id="HTML-Forms"><a href="#HTML-Forms" class="headerlink" title="HTML Forms"></a>HTML Forms</h1><p>在 HTML 中表单由<code>&lt;form&gt;...&lt;/form&gt;</code>标签生成。</p>
<p><code>&lt;input&gt;</code>元素，需要定义：</p>
<ol>
<li>where:用户的输入该返回什么 URL</li>
<li>how:数据应该使用哪种 HTTP method 返回</li>
</ol>
<h2 id="GET-and-POST"><a href="#GET-and-POST" class="headerlink" title="GET and POST"></a>GET and POST</h2><p>GET and POST are the only HTTP methods to use when dealing with forms.</p>
<h1 id="Django’s-role-in-forms"><a href="#Django’s-role-in-forms" class="headerlink" title="Django’s role in forms"></a>Django’s role in forms</h1><ul>
<li>preparing and restructuring data to make it ready for rendering</li>
<li>creating HTML forms for the data</li>
<li>receiving and processing submitted forms and data from the client</li>
</ul>
<h1 id="Forms-in-Django"><a href="#Forms-in-Django" class="headerlink" title="Forms in Django"></a>Forms in Django</h1><p>We’ve described HTML forms briefly, but an HTML <form> is just one part of the machinery required.</form></p>
<h2 id="The-Django-Form-class"><a href="#The-Django-Form-class" class="headerlink" title="The Django Form class"></a>The Django Form class</h2><h2 id="Instantiating-processing-and-rendering-forms"><a href="#Instantiating-processing-and-rendering-forms" class="headerlink" title="Instantiating, processing, and rendering forms"></a>Instantiating, processing, and rendering forms</h2><ol>
<li>get hold of it in the view (fetch it from the database, for example)</li>
<li>pass it to the template context</li>
<li>expand it to HTML markup using template variables</li>
</ol>
<h1 id="Building-a-form"><a href="#Building-a-form" class="headerlink" title="Building a form"></a>Building a form</h1><h2 id="The-work-that-needs-to-be-done"><a href="#The-work-that-needs-to-be-done" class="headerlink" title="The work that needs to be done"></a>The work that needs to be done</h2><p>比如需要创建一个下面的 html：</p>
<pre><code>&lt;form action=&quot;/your-name/&quot; method=&quot;post&quot;&gt;
    &lt;label for=&quot;your_name&quot;&gt;Your name: &lt;/label&gt;
    &lt;input id=&quot;your_name&quot; type=&quot;text&quot; name=&quot;your_name&quot; value=&quot;{{ current_name }}&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;OK&quot;&gt;
&lt;/form&gt;
</code></pre><h2 id="Building-a-form-in-Django"><a href="#Building-a-form-in-Django" class="headerlink" title="Building a form in Django"></a>Building a form in Django</h2><h3 id="The-Form-class"><a href="#The-Form-class" class="headerlink" title="The Form class"></a>The Form class</h3><p>forms.py:</p>
<pre><code>from django import forms

class NameForm(forms.Form):
    your_name = forms.CharField(label=&apos;Your name&apos;, max_length=100)
</code></pre><p>forms class 有一个 is_valid() 方法，用于验证数据的有效性</p>
<p>这个 forms 被渲染后的 html：</p>
<pre><code>&lt;label for=&quot;your_name&quot;&gt;Your name: &lt;/label&gt;
&lt;input id=&quot;your_name&quot; type=&quot;text&quot; name=&quot;your_name&quot; maxlength=&quot;100&quot; required /&gt;
</code></pre><p>没有包含 <code>&lt;form&gt;</code> 标签，和 submit button</p>
<h3 id="The-view"><a href="#The-view" class="headerlink" title="The view"></a>The view</h3><p>views.py：</p>
<pre><code>from django.shortcuts import render
from django.http import HttpResponseRedirect

from .forms import NameForm

def get_name(request):
    # if this is a POST request we need to process the form data
    if request.method == &apos;POST&apos;:
        # create a form instance and populate it with data from the request:
        form = NameForm(request.POST)
        # check whether it&apos;s valid:
        if form.is_valid():
            # process the data in form.cleaned_data as required
            # ...
            # redirect to a new URL:
            return HttpResponseRedirect(&apos;/thanks/&apos;)

    # if a GET (or any other method) we&apos;ll create a blank form
    else:
        form = NameForm()

    return render(request, &apos;name.html&apos;, {&apos;form&apos;: form})
</code></pre><h1 id="Form-classes"><a href="#Form-classes" class="headerlink" title="Form classes"></a>Form classes</h1><p>所有的 Form class 都继承自 <code>django.forms.Form</code>, 包括 Django 的 admin 中使用的 <code>ModelForm</code></p>
<blockquote>
<p>Form 用于直接添加和编辑 Django model。</p>
</blockquote>
<h2 id="Bound-and-unbound-form-instances"><a href="#Bound-and-unbound-form-instances" class="headerlink" title="Bound and unbound form instances"></a>Bound and unbound form instances</h2><p>Bound 和 unbound 的区别：</p>
<ol>
<li>一个 unbound 的 form 没有和它连接的数据，当它被渲染显示给用户的时候，它是空的或者包含默认的值。</li>
<li>一个 bound form，渲染后是包含数据的。</li>
</ol>
<p>form 的 <code>is_bound</code> 属性表示了是否绑定数据。</p>
<h2 id="More-on-fields"><a href="#More-on-fields" class="headerlink" title="More on fields"></a>More on fields</h2><p>下面创建一个更有意义的 form：</p>
<p>forms.py:</p>
<pre><code>from django import forms

class ContactForm(forms.Form):
    subject = forms.CharField(max_length=100)
    message = forms.CharField(widget=forms.Textarea)
    sender = forms.EmailField()
    cc_myself = forms.BooleanField(required=False)
</code></pre><h3 id="Widgets"><a href="#Widgets" class="headerlink" title="Widgets"></a>Widgets</h3><p>每个 form field 都有一个对应的 Widget class,用于设置其 input 的 type，默认 type=”text”</p>
<h4 id="Field-data"><a href="#Field-data" class="headerlink" title="Field data"></a>Field data</h4><p>通过调用 <code>forms.is_valid()</code> 来验证用户数据,验证后的数据会被保存的到 <code>form.cleaned_data</code> dictionary,这里的数据可以很好的转化成 Python 数据</p>
<p>views.py:</p>
<pre><code>from django.core.mail import send_mail

if form.is_valid():
    subject = form.cleaned_data[&apos;subject&apos;]
    message = form.cleaned_data[&apos;message&apos;]
    sender = form.cleaned_data[&apos;sender&apos;]
    cc_myself = form.cleaned_data[&apos;cc_myself&apos;]

    recipients = [&apos;info@example.com&apos;]
    if cc_myself:
        recipients.append(sender)

    send_mail(subject, message, sender, recipients)
    return HttpResponseRedirect(&apos;/thanks/&apos;)
</code></pre><p>一些 field 类型需要一些额外的处理，比如 使用 form 上传文件</p>
<h1 id="Working-with-form-templates"><a href="#Working-with-form-templates" class="headerlink" title="Working with form templates"></a>Working with form templates</h1><p>把 form 对象放到 template 的 conext 中就可以把 form 添加到 template 中，比如表单的变量名是 form，<code></code> 加入到 template 中就可以了。</p>
<h2 id="Form-rendering-options"><a href="#Form-rendering-options" class="headerlink" title="Form rendering options"></a>Form rendering options</h2><p>一些定制：</p>
<ul>
<li><code></code>: 生成的 html 会被 <code>&lt;tr&gt;</code> 标签包裹</li>
<li><code></code>: 被 <code>&lt;p&gt;</code> 包裹</li>
<li><code></code>: 被 <code>&lt;li&gt;</code> 包裹</li>
</ul>
<p>在 template 中需要自己写 <code>&lt;table&gt;</code>,<code>&lt;ul&gt;</code> 标签</p>
<p><code></code> ContactForm 的输出：</p>
<pre><code>&lt;p&gt;&lt;label for=&quot;id_subject&quot;&gt;Subject:&lt;/label&gt;
    &lt;input id=&quot;id_subject&quot; type=&quot;text&quot; name=&quot;subject&quot; maxlength=&quot;100&quot; required /&gt;&lt;/p&gt;
&lt;p&gt;&lt;label for=&quot;id_message&quot;&gt;Message:&lt;/label&gt;
    &lt;textarea name=&quot;message&quot; id=&quot;id_message&quot; required&gt;&lt;/textarea&gt;&lt;/p&gt;
&lt;p&gt;&lt;label for=&quot;id_sender&quot;&gt;Sender:&lt;/label&gt;
    &lt;input type=&quot;email&quot; name=&quot;sender&quot; id=&quot;id_sender&quot; required /&gt;&lt;/p&gt;
&lt;p&gt;&lt;label for=&quot;id_cc_myself&quot;&gt;Cc myself:&lt;/label&gt;
    &lt;input type=&quot;checkbox&quot; name=&quot;cc_myself&quot; id=&quot;id_cc_myself&quot; /&gt;&lt;/p&gt;
</code></pre><p>每个 field 都有一个 ID <code>id_&lt;field-name&gt;</code></p>
<h2 id="Rendering-fields-manually"><a href="#Rendering-fields-manually" class="headerlink" title="Rendering fields manually"></a>Rendering fields manually</h2><p>手动渲染 fields，每个 field 都可以通过属性 <code></code> 获取</p>
<p>ex：</p>
<pre><code>{{ form.non_field_errors }}
&lt;div class=&quot;fieldWrapper&quot;&gt;
    {{ form.subject.errors }}
    &lt;label for=&quot;{{ form.subject.id_for_label }}&quot;&gt;Email subject:&lt;/label&gt;
    {{ form.subject }}
&lt;/div&gt;
&lt;div class=&quot;fieldWrapper&quot;&gt;
    {{ form.message.errors }}
    &lt;label for=&quot;{{ form.message.id_for_label }}&quot;&gt;Your message:&lt;/label&gt;
    {{ form.message }}
&lt;/div&gt;
&lt;div class=&quot;fieldWrapper&quot;&gt;
    {{ form.sender.errors }}
    &lt;label for=&quot;{{ form.sender.id_for_label }}&quot;&gt;Your email address:&lt;/label&gt;
    {{ form.sender }}
&lt;/div&gt;
&lt;div class=&quot;fieldWrapper&quot;&gt;
    {{ form.cc_myself.errors }}
    &lt;label for=&quot;{{ form.cc_myself.id_for_label }}&quot;&gt;CC yourself?&lt;/label&gt;
    {{ form.cc_myself }}
&lt;/div&gt;
</code></pre><p><code>&lt;label&gt;</code> 可以通过 <code>label_tag()</code> 方法生成，ex：</p>
<pre><code>&lt;div class=&quot;fieldWrapper&quot;&gt;
    {{ form.subject.errors }}
    {{ form.subject.label_tag }}
    {{ form.subject }}
&lt;/div&gt;
</code></pre><h3 id="Rendering-form-error-messages"><a href="#Rendering-form-error-messages" class="headerlink" title="Rendering form error messages"></a>Rendering form error messages</h3><p>。。。</p>
<h2 id="Looping-over-the-form’s-fields"><a href="#Looping-over-the-form’s-fields" class="headerlink" title="Looping over the form’s fields"></a>Looping over the form’s fields</h2><p>使用遍历 field 的方式生成 forms：</p>
<pre><code>{% for field in form %}
        <div class="fieldWrapper">
            {{ field.errors }}
            {{ field.label_tag }} {{ field }}
            {% if field.help_text %}
            <p class="help">{{ field.help_text|safe }}</p>
            {% endif %}
        </div>
    {% endfor %}
</code></pre><p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<p><code></code></p>
<h3 id="Looping-over-hidden-and-visible-fields"><a href="#Looping-over-hidden-and-visible-fields" class="headerlink" title="Looping over hidden and visible fields"></a>Looping over hidden and visible fields</h3><pre><code>{% for hidden in form.hidden_fields %}
    {{ hidden }}
    {% endfor %}

{% for field in form.visible_fields %}
        <div class="fieldWrapper">
            {{ field.errors }}
            {{ field.label_tag }} {{ field }}
        </div>
    {% endfor %}
</code></pre><h2 id="Reusable-form-templates"><a href="#Reusable-form-templates" class="headerlink" title="Reusable form templates"></a>Reusable form templates</h2><p>把 form 的 html 写到一个 html 文件文件中，通过 <code>include</code> 达到复用的效果</p>
<pre><code># In your form template:
{% include "form_snippet.html" %}

# In form_snippet.html:
{% for field in form %}
        <div class="fieldWrapper">
            {{ field.errors }}
            {{ field.label_tag }} {{ field }}
        </div>
    {% endfor %}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/12/Android/进程保活/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/12/Android/进程保活/" itemprop="url">进程保活</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T21:38:14+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>原文地址：<a href="http://dev.qq.com/topic/57ac4a0ea374c75371c08ce8" target="_blank" rel="noopener">http://dev.qq.com/topic/57ac4a0ea374c75371c08ce8</a></p>
<p>进程保活包括两个层面：</p>
<ol>
<li>提高进程的优先级，降低其被杀死的概率</li>
<li>在进程被杀死后，进行拉活</li>
</ol>
<h1 id="进程的优先级"><a href="#进程的优先级" class="headerlink" title="进程的优先级"></a>进程的优先级</h1><p>进程重要性分 5 级：</p>
<ol>
<li>前台进程(Foreground process)</li>
<li>可见进程(Visible process)</li>
<li>服务进程(Service process)</li>
<li>后台进程(Background process)</li>
<li>空进程(Empty process)</li>
</ol>
<h2 id="Foreground-process"><a href="#Foreground-process" class="headerlink" title="Foreground process"></a>Foreground process</h2><p>只有在内存不足的时候才会被回收</p>
<p>实现前台进程的情况：</p>
<ul>
<li>拥有用户正在交互的 Activity（已调用 onResume()）</li>
<li>拥有某个 Service，后者绑定到用户正在交互的 Activity</li>
<li>拥有正在“前台”运行的 Service（服务已调用 startForeground()）</li>
<li>拥有正执行一个生命周期回调的 Service（onCreate()、onStart() 或 onDestroy()）</li>
<li>拥有正执行其 onReceive() 方法的 BroadcastReceiver</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/12/12/Android/进程保活/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/12/Android/后台任务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/12/Android/后台任务/" itemprop="url">后台任务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T13:18:12+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Keeping-the-Device-Awake-保持设备唤醒"><a href="#Keeping-the-Device-Awake-保持设备唤醒" class="headerlink" title="Keeping the Device Awake 保持设备唤醒"></a>Keeping the Device Awake 保持设备唤醒</h1><h2 id="方式一：让屏幕一直点亮-Keep-the-Screen-On"><a href="#方式一：让屏幕一直点亮-Keep-the-Screen-On" class="headerlink" title="方式一：让屏幕一直点亮 Keep the Screen On"></a>方式一：让屏幕一直点亮 Keep the Screen On</h2><h3 id="在-Activity-中"><a href="#在-Activity-中" class="headerlink" title="在 Activity 中"></a>在 Activity 中</h3><pre><code>public class MainActivity extends Activity {
  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);
  }
</code></pre><h3 id="Manifest-中"><a href="#Manifest-中" class="headerlink" title="Manifest 中"></a>Manifest 中</h3><pre><code>&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:keepScreenOn=&quot;true&quot;&gt;
    ...
&lt;/RelativeLayout&gt;
</code></pre><h2 id="Keep-the-CPU-On"><a href="#Keep-the-CPU-On" class="headerlink" title="Keep the CPU On"></a>Keep the CPU On</h2><h3 id="Use-PowerManager"><a href="#Use-PowerManager" class="headerlink" title="Use PowerManager"></a>Use PowerManager</h3><p>添加权限：</p>
<pre><code>&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;
</code></pre><p>获取锁：</p>
<pre><code>PowerManager powerManager = (PowerManager) getSystemService(POWER_SERVICE);
WakeLock wakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,
        &quot;MyWakelockTag&quot;);
wakeLock.acquire();
</code></pre><p>在必要的时候释放锁：</p>
<pre><code>wakelock.release()
</code></pre><h3 id="Using-WakefulBroadcastReceiver"><a href="#Using-WakefulBroadcastReceiver" class="headerlink" title="Using WakefulBroadcastReceiver"></a>Using WakefulBroadcastReceiver</h3><blockquote>
<p>A WakefulBroadcastReceiver is a special type of broadcast receiver that takes care of creating and managing a PARTIAL_WAKE_LOCK for your app.</p>
</blockquote>
<p>创建 BroadcastReceiver：</p>
<pre><code>public class MyWakefulReceiver extends WakefulBroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {

        // Start the service, keeping the device awake while the service is
        // launching. This is the Intent to deliver to the service.
        Intent service = new Intent(context, MyIntentService.class);
        startWakefulService(context, service);
    }
}
</code></pre><p>注册：</p>
<pre><code>&lt;receiver android:name=&quot;.MyWakefulReceiver&quot;&gt;&lt;/receiver&gt;
</code></pre><p>Service：</p>
<pre><code>public class MyIntentService extends IntentService {
    public static final int NOTIFICATION_ID = 1;
    private NotificationManager mNotificationManager;
    NotificationCompat.Builder builder;
    public MyIntentService() {
        super(&quot;MyIntentService&quot;);
    }
    @Override
    protected void onHandleIntent(Intent intent) {
        Bundle extras = intent.getExtras();
        // Do the work that requires your app to keep the CPU running.
        // ...
        // Release the wake lock provided by the WakefulBroadcastReceiver.
        MyWakefulReceiver.completeWakefulIntent(intent);
    }
}
</code></pre><h1 id="Scheduling-Repeating-Alarms-使用-Alarms"><a href="#Scheduling-Repeating-Alarms-使用-Alarms" class="headerlink" title="Scheduling Repeating Alarms 使用 Alarms"></a>Scheduling Repeating Alarms 使用 Alarms</h1><p>Alarms 可以让你脱离应用的生命周期来执行某段代码。</p>
<p>它有下面的特点／作用：</p>
<ul>
<li>它需要你在设置 Alarms 的时候输入时间（事件执行的时间）</li>
<li>可以用它和广播配合开启 Service 或者执行其他的操作</li>
<li>它是脱离应用操作的，所以在应用没有运行或者设备休眠的时候它也能执行</li>
<li>它可以减少应用对设备资源的占用，因为你不用为了在未来执行某个事件而创建一个需要一直运行的 Service</li>
</ul>
<p><strong>注意：</strong>如果使用应用内需要进行一些定时操作，不建议使用这个。</p>
<h2 id="Understand-the-Trade-offs-了解权衡"><a href="#Understand-the-Trade-offs-了解权衡" class="headerlink" title="Understand the Trade-offs 了解权衡"></a>Understand the Trade-offs 了解权衡</h2><p>循环的 Alarm 内部的机制很简单但是不够灵活，在大多数情况下它并不是最好的解决方案，比如应用要铺货手机网络改变如果定义一个 Alarm 来检测就会消耗过多的资源而且达不到很好的效果。</p>
<p>如果要在应用的生命周期外做和服务器的数据同步操作，最好的方式不是 Alarm 而是 Google Cloud Message （GCM）配合 sync Adapter 做数据同步。</p>
<h3 id="Best-practices"><a href="#Best-practices" class="headerlink" title="Best practices"></a>Best practices</h3><ul>
<li>考虑循环 Alarm 的不准确性，Alarm触发的时间可能会不准确<ul>
<li>做任何的本地操作在每次 Alarm 触发的时候</li>
<li>调度包含网络请求的警报在某些随机时间段。</li>
</ul>
</li>
<li>尽量减少 Alarm 的触发频率</li>
<li>不要在不需要的时候唤醒设备（是否会唤醒设备由 alarm 的类型决定）</li>
<li><p>Don’t make your alarm’s trigger time any more precise than it has to be.</p>
<p>  使用 <code>setInexactRepeating()</code> 代替 <code>setRepeating()</code>, 当使用 <code>setInexactRepeating()</code> 的时候 Android 系统会同步其他的应用的 Alarm 在同一时刻执行。<br>  在 Android 4.4 (API Level 19) 之后所有的 repeat Alarm 都是不准确的。</p>
</li>
<li><p>Avoid basing your alarm on clock time if possible.</p>
</li>
</ul>
<h2 id="Set-a-Repeating-Alarm-设置循环-Alarm"><a href="#Set-a-Repeating-Alarm-设置循环-Alarm" class="headerlink" title="Set a Repeating Alarm 设置循环 Alarm"></a>Set a Repeating Alarm 设置循环 Alarm</h2><p>Repeate Alarm 有以下特性：</p>
<ol>
<li>A alarm type. 类型</li>
<li>A trigger time. 触发时间</li>
<li>The alarm’s interval. 间隔</li>
<li>A pending intent that fires when the alarm is triggered. 一个会被执行的 pending intent</li>
</ol>
<h3 id="Choose-an-alarm-type"><a href="#Choose-an-alarm-type" class="headerlink" title="Choose an alarm type"></a>Choose an alarm type</h3><p>Alarm 类型分两大类：</p>
<ol>
<li><p>elapsed real time</p>
<p> 使用 the “time since system boot” 作为参考，不受时区／区域的设置</p>
<p> 如果要 Alarm 每隔一段时间触发一次建议使用</p>
</li>
<li><p>real time clock（RTC）</p>
<p> 使用 UTC (wall clock) time 作为参考</p>
<p> 如果要 Alarm 在每天的某个时间触发建议使用。</p>
</li>
</ol>
<p>两种类型都有个 WAKEUP 版本（如果屏幕是熄灭的它会唤醒 CPU）：</p>
<ol>
<li>ELAPSED_REALTIME</li>
<li>ELAPSED_REALTIME_WAKEUP</li>
<li>RTC</li>
<li>RTC_WAKEUP</li>
</ol>
<h4 id="ELAPSED-REALTIME-WAKEUP-examples"><a href="#ELAPSED-REALTIME-WAKEUP-examples" class="headerlink" title="ELAPSED_REALTIME_WAKEUP examples"></a>ELAPSED_REALTIME_WAKEUP examples</h4><p>Wake up the device to fire the alarm in 30 minutes, and every 30 minutes after that:</p>
<pre><code>// Hopefully your alarm will have a lower frequency than this!
alarmMgr.setInexactRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP,
        SystemClock.elapsedRealtime() + AlarmManager.INTERVAL_HALF_HOUR,
        AlarmManager.INTERVAL_HALF_HOUR, alarmIntent);
</code></pre><p>Wake up the device to fire a one-time (non-repeating) alarm in one minute:</p>
<pre><code>private AlarmManager alarmMgr;
private PendingIntent alarmIntent;
...
alarmMgr = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE);
Intent intent = new Intent(context, AlarmReceiver.class);
alarmIntent = PendingIntent.getBroadcast(context, 0, intent, 0);

alarmMgr.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,
        SystemClock.elapsedRealtime() +
        60 * 1000, alarmIntent);
</code></pre><h4 id="RTC-examples"><a href="#RTC-examples" class="headerlink" title="RTC examples"></a>RTC examples</h4><p>Wake up the device to fire the alarm at approximately 2:00 p.m., and repeat once a day at the same time:</p>
<pre><code>// Set the alarm to start at approximately 2:00 p.m.
Calendar calendar = Calendar.getInstance();
calendar.setTimeInMillis(System.currentTimeMillis());
calendar.set(Calendar.HOUR_OF_DAY, 14);

// With setInexactRepeating(), you have to use one of the AlarmManager interval
// constants--in this case, AlarmManager.INTERVAL_DAY.
alarmMgr.setInexactRepeating(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(),
        AlarmManager.INTERVAL_DAY, alarmIntent);
</code></pre><p>Wake up the device to fire the alarm at precisely 8:30 a.m., and every 20 minutes thereafter:</p>
<pre><code>private AlarmManager alarmMgr;
private PendingIntent alarmIntent;
...
alarmMgr = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE);
Intent intent = new Intent(context, AlarmReceiver.class);
alarmIntent = PendingIntent.getBroadcast(context, 0, intent, 0);

// Set the alarm to start at 8:30 a.m.
Calendar calendar = Calendar.getInstance();
calendar.setTimeInMillis(System.currentTimeMillis());
calendar.set(Calendar.HOUR_OF_DAY, 8);
calendar.set(Calendar.MINUTE, 30);

// setRepeating() lets you specify a precise custom interval--in this case,
// 20 minutes.
alarmMgr.setRepeating(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(),
        1000 * 60 * 20, alarmIntent);
</code></pre><h3 id="Decide-how-precise-your-alarm-needs-to-be-确定-alarm-的精准度"><a href="#Decide-how-precise-your-alarm-needs-to-be-确定-alarm-的精准度" class="headerlink" title="Decide how precise your alarm needs to be 确定 alarm 的精准度"></a>Decide how precise your alarm needs to be 确定 alarm 的精准度</h3><h2 id="Cancel-an-Alarm-取消-Alarm"><a href="#Cancel-an-Alarm-取消-Alarm" class="headerlink" title="Cancel an Alarm 取消 Alarm"></a>Cancel an Alarm 取消 Alarm</h2><pre><code>// If the alarm has been set, cancel it.
if (alarmMgr!= null) {
    alarmMgr.cancel(alarmIntent);
}
</code></pre><h2 id="Start-an-Alarm-When-the-Device-Boots"><a href="#Start-an-Alarm-When-the-Device-Boots" class="headerlink" title="Start an Alarm When the Device Boots"></a>Start an Alarm When the Device Boots</h2><h3 id="创建开机广播"><a href="#创建开机广播" class="headerlink" title="创建开机广播"></a>创建开机广播</h3><p>。。。</p>
<p>注册：</p>
<pre><code>&lt;receiver android:name=&quot;.SampleBootReceiver&quot;
        android:enabled=&quot;false&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;&gt;&lt;/action&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><p>这里 <code>android:enabled=&quot;false&quot;</code> ，意味着需要在应用内启动它，否则它不会接收广播。</p>
<p>启动这个广播：（开启后就是永久生效，即使是手机重启）</p>
<pre><code>ComponentName receiver = new ComponentName(context, SampleBootReceiver.class);
PackageManager pm = context.getPackageManager();

pm.setComponentEnabledSetting(receiver,
        PackageManager.COMPONENT_ENABLED_STATE_ENABLED,
        PackageManager.DONT_KILL_APP);
</code></pre><p>关闭这个广播：</p>
<pre><code>ComponentName receiver = new ComponentName(context, SampleBootReceiver.class);
PackageManager pm = context.getPackageManager();

pm.setComponentEnabledSetting(receiver,
        PackageManager.COMPONENT_ENABLED_STATE_DISABLED,
        PackageManager.DONT_KILL_APP);
</code></pre><h1 id="Android5-0"><a href="#Android5-0" class="headerlink" title="Android5.0"></a>Android5.0</h1><h2 id="JobScheduler，JobService"><a href="#JobScheduler，JobService" class="headerlink" title="JobScheduler，JobService"></a>JobScheduler，JobService</h2><h3 id="创建-JobService"><a href="#创建-JobService" class="headerlink" title="创建 JobService"></a>创建 JobService</h3><pre><code>@RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)
public class Job extends JobService {

    @Override
    public boolean onStartJob(JobParameters params) {
        // 需要执行的任务，执行线程在 Main Thread
        // ....

        // 返回 True：表示这个 Job 还在继续（开启了子线程处理事件），后续需要自己调用 jobFinished 来结束 Job
        //      False：表示没有异步操作， Job 结束
        return false;
    }

    @Override
    public boolean onStopJob(JobParameters params) {
        // * 如果 onStartJob 返回 True，这个方法不会被调用
        return false;
    }

}
</code></pre><h3 id="注册："><a href="#注册：" class="headerlink" title="注册："></a>注册：</h3><pre><code>&lt;service android:name=&quot;.Job&quot;
    android:permission=&quot;android.permission.BIND_JOB_SERVICE&quot; /&gt;
</code></pre><h3 id="应用如何和-JobService-交互"><a href="#应用如何和-JobService-交互" class="headerlink" title="应用如何和 JobService 交互"></a>应用如何和 JobService 交互</h3><h4 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h4><p>JobScheduler 对象创建：</p>
<pre><code>mJobScheduler = (JobScheduler)
    getSystemService( Context.JOB_SCHEDULER_SERVICE );
</code></pre><p>创建定时任务：（JobInfo）</p>
<pre><code>JobInfo.Builder builder = new JobInfo.Builder( 1,
        new ComponentName( getPackageName(),
            JobSchedulerService.class.getName() ) );
</code></pre><p>设置时间间隔：</p>
<pre><code>builder.setPeriodic( 3000 );
</code></pre><p>JobInfo 其他设置：</p>
<ul>
<li>setMinimumLatency(long minLatencyMillis): 这个函数能让你设置任务的延迟执行时间(单位是毫秒),这个函数与setPeriodic(long time)方法不兼容，如果这两个方法同时调用了就会引起异常；</li>
<li>setOverrideDeadline(long maxExecutionDelayMillis)：这个方法让你可以设置任务最晚的延迟时间。如果到了规定的时间时其他条件还未满足，你的任务也会被启动。与setMinimumLatency(long time)一样，这个方法也会与setPeriodic(long time)，同时调用这两个方法会引发异常。</li>
<li>setPersisted(boolean isPersisted): 这个方法告诉系统当你的设备重启之后你的任务是否还要继续执行。</li>
<li>setRequiredNetworkType(int networkType): 这个方法让你这个任务只有在满足指定的网络条件时才会被执行。默认条件是JobInfo.NETWORK_TYPE_NONE，这意味着不管是否有网络这个任务都会被执行。另外两个可选类型，一种是JobInfo.NETWORK_TYPE_ANY，它表明需要任意一种网络才使得任务可以执行。另一种是JobInfo.NETWORK_TYPE_UNMETERED，它表示设备不是蜂窝网络( 比如在WIFI连接时 )时任务才会被执行。</li>
<li>setRequiresCharging(boolean requiresCharging): 这个方法告诉你的应用，只有当设备在充电时这个任务才会被执行。</li>
<li>setRequiresDeviceIdle(boolean requiresDeviceIdle): 这个方法告诉你的任务只有当用户没有在使用该设备且有一段时间没有使用时才会启动该任务。</li>
</ul>
<p>一旦你预置的条件被设置，你就可以构建一个JobInfo对象，然后通过如下所示的代码将它发送到你的JobScheduler中：</p>
<pre><code>if( mJobScheduler.schedule( builder.build() ) &lt;= 0 ) {
    //If something goes wrong
}
</code></pre><p>停止某个任务：</p>
<pre><code>mJobScheduler.cancel(int jobId)
mJobScheduler.cancelAll();
</code></pre><h4 id="JobInfo"><a href="#JobInfo" class="headerlink" title="JobInfo"></a>JobInfo</h4><h5 id="JobInfo-Builder"><a href="#JobInfo-Builder" class="headerlink" title="JobInfo.Builder"></a>JobInfo.Builder</h5><pre><code>JobInfo.Builder(int jobId, ComponentName jobService)
</code></pre><ul>
<li>jobId: 要求 uid</li>
</ul>
<h1 id="Android-7-0-电池-内存变化"><a href="#Android-7-0-电池-内存变化" class="headerlink" title="Android 7.0 电池 内存变化"></a>Android 7.0 电池 内存变化</h1><h2 id="Doze"><a href="#Doze" class="headerlink" title="Doze"></a>Doze</h2><blockquote>
<p>Introduced in Android 6.0 (API level 23), Doze improves battery life by deferring CPU and network activities when a user leaves a device unplugged, stationary, and with the screen turned off.</p>
</blockquote>
<p>Android6.0 中当手机没有在充电，静止，屏幕关闭的时候会进入 Doze 模式限制 CPU， 网络任务来减少电池的消耗。</p>
<p>Doze 限制规则</p>
<ul>
<li>当手机在充电，屏幕关闭一段时间，设备会进入 Doze 模式并开启第一阶段的限制：关闭 app 的网络请求，推出作业和同步。</li>
<li>当手机处于静止状态一段时间后，Doze 模式开启下一阶段的限制：PowerManager.WakeLock, AlarmManager alarms, GPS, and Wi-Fi scans。</li>
</ul>
<p>但是无论是处在哪种阶段的限制，系统都会提供一个时间点允许应用获取网络和执行 jobs／syncs。</p>
<p><img src="https://developer.android.google.cn/images/android-7.0/doze-diagram-2.png" alt="Doze 模式"></p>
<p>当手机连接其他设备或者屏幕开启的时候，Doze 模式自动关闭，限制解除。</p>
<h2 id="Background-Optimizations-后台优化"><a href="#Background-Optimizations-后台优化" class="headerlink" title="Background Optimizations 后台优化"></a>Background Optimizations 后台优化</h2><p>Android 7.0 移除了 3 个隐式的广播为了帮助优化内存和电量的消耗，因为隐式的广播会频繁启动已经注册它的 app。</p>
<p>手机通常会不断的产生连接改变，比如 wifi和数据网络 的改变，如果注册了隐私的 CONNECTIVITY_ACTION 广播。还有 ACTION_NEW_PICTURE， ACTION_NEW_VIDEO。</p>
<p>为了避免这个问题，Android7.0 做了以下优化：</p>
<ul>
<li>如果 app target 设置的是 Android7.0 ,通过 Manifest 注册的 CONNECTIVITY_ACTION 广播不会触发。不过在 main thread 中动态注册还是有效的。</li>
<li>应用不能就收 ACTION_NEW_PICTURE 和 ACTION_NEW_VIDEO 的广播，这个优化影响所有的应用即使它的 target 不是 Android7.0 。</li>
</ul>
<p>建议使用 JobScheduler 来检测 Net 变化和手机中 文件的变化。</p>
<p>参考：</p>
<ul>
<li><a href="https://developer.android.google.cn/training/scheduling/index.html" target="_blank" rel="noopener">官方文档</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/05/Android/四大组件/broadcast/Android 各种广播/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/05/Android/四大组件/broadcast/Android 各种广播/" itemprop="url">Android 各种广播</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-05T14:38:14+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="手机电池监控"><a href="#手机电池监控" class="headerlink" title="手机电池监控"></a>手机电池监控</h1><h2 id="创建广播-BroadcastReceiver"><a href="#创建广播-BroadcastReceiver" class="headerlink" title="创建广播 BroadcastReceiver"></a>创建广播 BroadcastReceiver</h2><p>public class BatteryReceiver extends BroadcastReceiver {</p>
<pre><code>@Override
public void onReceive(Context context, Intent intent) {

    // Are we charging / charged?
    int status = intent.getIntExtra(BatteryManager.EXTRA_STATUS, -1);
    boolean isCharging = status == BatteryManager.BATTERY_STATUS_CHARGING ||
            status == BatteryManager.BATTERY_STATUS_FULL;

    // How are we charging?
    int chargePlug = intent.getIntExtra(BatteryManager.EXTRA_PLUGGED, -1);
    boolean usbCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_USB;
    boolean acCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_AC;

    //电池电量，数字
    int level = intent.getIntExtra(BatteryManager.EXTRA_LEVEL, -1);
    //电池最大容量
    int scale = intent.getIntExtra(BatteryManager.EXTRA_SCALE, -1);
    //电池伏数
    int voltage = intent.getIntExtra(BatteryManager.EXTRA_VOLTAGE, -1);
    //电池温度
    int template = intent.getIntExtra(BatteryManager.EXTRA_TEMPERATURE, -1);

    float batteryPct = level / (float) scale;

    String bat = level + &quot;%&quot;;

    LoggerUtils.d(&quot;status:&quot; + status + &quot; isCharging:&quot; + isCharging +
            &quot;How are we charging: usbCharge:&quot; + usbCharge + &quot; arCharge:&quot; + acCharge +
            &quot; level=&quot; + level + &quot; scale=&quot; + scale + &quot; batteryPct=&quot; + batteryPct + &quot; bat:&quot; + bat);
}
</code></pre><p>}</p>
<h2 id="注册广播"><a href="#注册广播" class="headerlink" title="注册广播"></a>注册广播</h2><p>在 AndroidManifest 中注册</p>
<pre><code>&lt;receiver android:name=&quot;.br.BatteryReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.BATTERY_CHANGED&quot;/&gt;
        &lt;action android:name=&quot;android.intent.action.ACTION_POWER_CONNECTED&quot;/&gt;
        &lt;action android:name=&quot;android.intent.action.ACTION_POWER_DISCONNECTED&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><p><strong>注意：</strong> Android 中部分广播静态注册是无效的，需要在程序中动态注册。比如 这里的电量调节通过静态注册会发现虽然广播能够触发，但是 log 中获取不到电量的信息。还有耳机插拔的广播也需要动态注册。</p>
<p>动态注册：（对于需要一直监听的广播建议在 BaseApplication 中注册）</p>
<pre><code>// 这个方法在 BaseApplication 中的 onCreate 中调用
private void startBatterMonitor() {
    IntentFilter intentFilter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
    intentFilter.addAction(Intent.ACTION_POWER_CONNECTED);
    intentFilter.addAction(Intent.ACTION_POWER_DISCONNECTED);
    registerReceiver(new BatteryReceiver(), intentFilter);
}
</code></pre><h1 id="开／关-机监控"><a href="#开／关-机监控" class="headerlink" title="开／关 机监控"></a>开／关 机监控</h1><h2 id="创建广播-BootReceiver"><a href="#创建广播-BootReceiver" class="headerlink" title="创建广播 BootReceiver"></a>创建广播 BootReceiver</h2><pre><code>public class BootReceiver extends BroadcastReceiver implements OnDownListener {

    @Override
    public void onReceive(Context context, Intent intent) {

        switch (intent.getAction()) {
            case Intent.ACTION_BOOT_COMPLETED:
                // 开机

                break;
            case Intent.ACTION_SHUTDOWN:
                // 关机

                break;
        }
    }
}
</code></pre><h2 id="注册广播-1"><a href="#注册广播-1" class="headerlink" title="注册广播"></a>注册广播</h2><p>在 AndroidManifest 中：</p>
<pre><code>&lt;receiver android:name=&quot;.br.BootReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;
        &lt;action android:name=&quot;android.intent.action.ACTION_SHUTDOWN&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="短信接收监控"><a href="#短信接收监控" class="headerlink" title="短信接收监控"></a>短信接收监控</h1><h2 id="创建广播-SMSReceiver"><a href="#创建广播-SMSReceiver" class="headerlink" title="创建广播 SMSReceiver"></a>创建广播 SMSReceiver</h2><pre><code>public class SmsBR extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        // Get the data (SMS data) bound to intent
        Bundle bundle = intent.getExtras();
        SmsMessage[] msgs;

        String from = &quot;&quot;;
        String body = &quot;&quot;;

        if (bundle != null) {
            // Retrieve the SMS Messages received
            Object[] pdus = (Object[]) bundle.get(&quot;pdus&quot;);
            msgs = new SmsMessage[pdus.length];

            // For every SMS message received
            for (int i = 0; i &lt; msgs.length; i++) {
                // Convert Object array
                msgs[i] = SmsMessage.createFromPdu((byte[]) pdus[i]);
                // Sender&apos;s phone number
//                from += &quot;SMS from &quot; + msgs[i].getOriginatingAddress() + &quot; : &quot;;
                from = msgs[i].getOriginatingAddress();
                // Fetch the text message
                body += msgs[i].getMessageBody().toString();

            }
            Logger.d(&quot;检测到短信:&quot; + from + &quot;:&quot; + body);
        }
    }

}
</code></pre><h2 id="注册广播-2"><a href="#注册广播-2" class="headerlink" title="注册广播"></a>注册广播</h2><p>在 AndroidManifest 中：</p>
<pre><code>&lt;receiver
    android:name=&quot;.br.SmsBR&quot;
    android:priority=&quot;999&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.provider.Telephony.SMS_RECEIVED&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="Gps-开关检测"><a href="#Gps-开关检测" class="headerlink" title="Gps 开关检测"></a>Gps 开关检测</h1><h2 id="创建广播-GpsReceiver"><a href="#创建广播-GpsReceiver" class="headerlink" title="创建广播 GpsReceiver"></a>创建广播 GpsReceiver</h2><pre><code>public class GpsReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {

        if (intent.getAction().matches(LocationManager.PROVIDERS_CHANGED_ACTION)) {
            Boolean gpsOpen = isGpsOpen();
            LoggerUtils.d(&quot;gpsOpen= &quot; + gpsOpen);
        }
    }

    public  Boolean isGpsOpen() {
        LocationManager locationManager
                = (LocationManager) BaseApplication.getInstance().getSystemService(Context.LOCATION_SERVICE);
        Boolean IsOpen = false;
        if (locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER)) {
            IsOpen = true;
        } else {
            IsOpen = false;
        }
        return IsOpen;
    }
}
</code></pre><h2 id="注册广播-3"><a href="#注册广播-3" class="headerlink" title="注册广播"></a>注册广播</h2><p>在 AndroidManifest 中:</p>
<pre><code>&lt;receiver android:name=&quot;.br.GpsReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.location.PROVIDERS_CHANGED&quot;/&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="手机应用安装广播"><a href="#手机应用安装广播" class="headerlink" title="手机应用安装广播"></a>手机应用安装广播</h1><h2 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h2><pre><code>public class AppReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {

        //接收安装广播
        if (intent.getAction().equals(&quot;android.intent.action.PACKAGE_ADDED&quot;)) {
            String packageName = intent.getDataString();
            System.out.println(&quot;安装了:&quot; +packageName + &quot;包名的程序&quot;);
        }

        //接收卸载广播
        if (intent.getAction().equals(&quot;android.intent.action.PACKAGE_REMOVED&quot;)) {
            String packageName = intent.getDataString();
            System.out.println(&quot;卸载了:&quot;  + packageName + &quot;包名的程序&quot;);
        }

    }
}
</code></pre><h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><pre><code>&lt;receiver android:name=&quot;.br.AppReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.PACKAGE_ADDED&quot;/&gt;
        &lt;action android:name=&quot;android.intent.action.PACKAGE_REMOVED&quot;/&gt;

        &lt;data android:scheme=&quot;package&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="蓝牙广播"><a href="#蓝牙广播" class="headerlink" title="蓝牙广播"></a>蓝牙广播</h1><h2 id="Receiver-1"><a href="#Receiver-1" class="headerlink" title="Receiver"></a>Receiver</h2><pre><code>public class BluetoothReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        String action = intent.getAction();
        int state = intent.getIntExtra(BluetoothAdapter.EXTRA_STATE, -1);

        String ret = &quot;&quot;;
        BluetoothStatus bluetoothStatus = new BluetoothStatus();
        switch (state) {
            case BluetoothAdapter.STATE_OFF:
                ret = &quot;Bluetooth off&quot;;
                break;
            case BluetoothAdapter.STATE_ON:
                ret = &quot;Bluetooth on&quot;;
                break;
            case BluetoothAdapter.ERROR:
                ret = &quot;Bluetooth error&quot;;
                break;
            case BluetoothAdapter.STATE_TURNING_OFF:
                ret = &quot;Bluetooth STATE_TURNING_OFF&quot;;
                break;
            case BluetoothAdapter.STATE_TURNING_ON:
                ret = &quot;Bluetooth STATE_TURNING_ON&quot;;
                break;
            case BluetoothAdapter.STATE_CONNECTED:
                ret = &quot;Bluetooth STATE_CONNECTED&quot;;

                BluetoothManager bluetoothManager = (BluetoothManager) BaseApplication.getInstance().getSystemService(Context.BLUETOOTH_SERVICE);
                BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();

                if (bluetoothAdapter != null) {
                    Set&lt;BluetoothDevice&gt; bondedDevices = bluetoothAdapter.getBondedDevices();
                    for (BluetoothDevice bondedDevice : bondedDevices) {
                        // Add the name and address to an array adapter to show in a ListView
                        Method method = null;
                        try {
                            method = bondedDevice.getClass().getMethod(&quot;isConnected&quot;);
                            Boolean connected = (Boolean) method.invoke(bondedDevice);
                            if (connected) {
                                bluetoothStatus.id = bondedDevice.getName();
                                bluetoothStatus.mac = bondedDevice.getAddress();
                                bluetoothStatus.bluetoothStatus = 1;
                                LoggerUtils.d(&quot;connect to  bluetooth:  id=&quot; + bluetoothStatus.id + &quot;  mac=&quot; + bluetoothStatus.mac);
                            }

                        } catch (NoSuchMethodException e) {
                            e.printStackTrace();
                        } catch (InvocationTargetException e) {
                            e.printStackTrace();
                        } catch (IllegalAccessException e) {
                            e.printStackTrace();
                        }

                    }
                } else {
                    LoggerUtils.e(&quot;bluetooth disable&quot;);
                }

                break;
            case BluetoothAdapter.STATE_CONNECTING:
                ret = &quot;Bluetooth STATE_CONNECTING&quot;;
                break;
            default:
                break;
        }


    }
}
</code></pre><h2 id="注册-1"><a href="#注册-1" class="headerlink" title="注册"></a>注册</h2><pre><code>&lt;receiver android:name=&quot;.br.BluetoothReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.bluetooth.adapter.action.STATE_CHANGED&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="网络状态广播"><a href="#网络状态广播" class="headerlink" title="网络状态广播"></a>网络状态广播</h1><h1 id="USB-状态广播"><a href="#USB-状态广播" class="headerlink" title="USB 状态广播"></a>USB 状态广播</h1><h2 id="Receiver-2"><a href="#Receiver-2" class="headerlink" title="Receiver"></a>Receiver</h2><pre><code>public class USBReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {

        String action = intent.getAction();
        switch (action) {
            case UsbManager.ACTION_USB_ACCESSORY_ATTACHED:

                break;
            case UsbManager.ACTION_USB_ACCESSORY_DETACHED:

                break;
            case UsbManager.ACTION_USB_DEVICE_ATTACHED:
                LoggerUtils.d(&quot;usb attached&quot;);
                break;
            case UsbManager.ACTION_USB_DEVICE_DETACHED:
                LoggerUtils.d(&quot;usb detached&quot;);
                break;
            case UsbManager.EXTRA_ACCESSORY:

                break;
            case &quot;android.hardware.usb.action.USB_STATE&quot;: // 0未使用 1充电 2媒体设备 3相机 4挂载SD卡 5挂载驱动
                    String functions = &quot;&quot;;
                    boolean midi = intent.getBooleanExtra(&quot;midi&quot;, false);
                    if (midi) {
                        functions = &quot;midi&quot;;
                    }
                    boolean mtp = intent.getBooleanExtra(&quot;mtp&quot;, false);
                    if (mtp) {
                        functions = &quot;mtp&quot;;
                    }
                    boolean ptp = intent.getBooleanExtra(&quot;ptp&quot;, false);
                    if (ptp) {
                        functions = &quot;ptp&quot;;
                    }
                    boolean adb = intent.getBooleanExtra(&quot;adb&quot;, false);
                    if (adb) {
                        functions = &quot;adb&quot;;
                    }
                    boolean mass_storage = intent.getBooleanExtra(&quot;mass_storage&quot;, false);
                    if (mass_storage) {
                        functions = &quot;mass_storage&quot;;
                    }
                    boolean charging = intent.getBooleanExtra(&quot;charging&quot;, false);
                    if (charging) {
                        functions = &quot;charging&quot;;
                    }
                    LoggerUtils.d(&quot;usb status &quot; + functions);
                break;
        }

    }
}
</code></pre><h2 id="注册-2"><a href="#注册-2" class="headerlink" title="注册"></a>注册</h2><pre><code>&lt;receiver android:name=&quot;.br.USBReceiver&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.hardware.usb.action.USB_DEVICE_ATTACHED&quot;/&gt;
        &lt;action android:name=&quot;android.hardware.usb.action.USB_DEVICE_DETACHED&quot;/&gt;
        &lt;action android:name=&quot;android.hardware.usb.action.USB_STATE&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><h1 id="SIM-卡广播"><a href="#SIM-卡广播" class="headerlink" title="SIM 卡广播"></a>SIM 卡广播</h1><pre><code>public class SimStateReceive extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {

        TelephonyManager tm = (TelephonyManager) context.getSystemService(Service.TELEPHONY_SERVICE);
        int state = tm.getSimState();

        String ret = &quot;&quot;;
        int simCard = 0;
        switch (state) {
            case TelephonyManager.SIM_STATE_READY:
                ret = &quot;SIM Card input&quot;;
                break;
            case TelephonyManager.SIM_STATE_UNKNOWN:
                ret = &quot;SIM_STATE_UNKNOWN&quot;;
                break;
            case TelephonyManager.SIM_STATE_ABSENT:
                ret = &quot;No SIM Card&quot;;
                break;
            case TelephonyManager.SIM_STATE_PIN_REQUIRED:
                ret = &quot;SIM_STATE_PIN_REQUIRED&quot;;
                break;
            case TelephonyManager.SIM_STATE_PUK_REQUIRED:
                ret = &quot;SIM_STATE_PUK_REQUIRED&quot;;
                break;
            case TelephonyManager.SIM_STATE_NETWORK_LOCKED:
                ret = &quot;SIM_STATE_NETWORK_LOCKED&quot;;
                break;
            default:
                break;
        }

        LoggerUtils.d(ret);

    }

}
</code></pre><h1 id="注册-3"><a href="#注册-3" class="headerlink" title="注册"></a>注册</h1><pre><code>&lt;receiver android:name=&quot;.br.SimStateReceive&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.SIM_STATE_CHANGED&quot;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre><p>#</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/04/Android/第三方/dagger2/Dagger2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/04/Android/第三方/dagger2/Dagger2/" itemprop="url">Dagger</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T12:18:12+08:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h1><p><a href="https://github.com/google/dagger" target="_blank" rel="noopener">Github 地址</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Add Dagger dependencies</span><br><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.google.dagger:dagger:2.x&apos;</span><br><span class="line">  annotationProcessor &apos;com.google.dagger:dagger-compiler:2.x&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果在使用 gradle 2.2 以下的 gradle，还需要集成 <a href="https://bitbucket.org/hvisser/android-apt" target="_blank" rel="noopener">https://bitbucket.org/hvisser/android-apt.</a></p>
<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><ul>
<li>@Module: 把这个类表识为 dagger 的 module，是提供依赖注入时所需对象实例的类</li>
<li>@Inject: 用来标注目标类的依赖和依赖的构造函数</li>
<li>@Component: Components 从根本上来说就是一个注入器，也可以说是 @Inject 和 @Module 的桥梁，它的主要作用就是连接这两个部分。 Components 可以提供所有定义了的类型的实例，比如：我们必须用 @Component 注解一个接口然后列出所有的@Modules组成该组件，如 果缺失了任何一块都会在编译的时候报错。所有的组件都可以通过它的 modules 知道依赖的范围。</li>
<li>@Provides：标识函数作为注入提供者，函数名并不重要，它只依赖于所提供的类类型</li>
<li>@Singleton：如果标识为Singleton，那这个函数会一直返回相同的对象实例，这比常规的单例好很多。否则，每次注入类型都会得到一个新的实例。在这个例子中，由于我们没有创建新实例，而是返回已经存在的实例，因此即使不把函数标识为 Singleton ，每次调用还是会返回相同的实例的，但这样能够更好地说明提供者到底做了什么。 Application 实例是唯一的。</li>
<li>@Scope: Scopes可是非常的有用，Dagger2 可以通过自定义注解限定注解作用域。后面会演示一个例子，这是一个非常强大的特点，因为就如前面说的一样，没 必要让每个对象都去了解如何管理他们的实例。在scope的例子中，我们用自定义的 @PerActivity注解一个类，所以这个对象存活时间就和 activity的一样。简单来说就是我们可以定义所有范围的粒度(@PerFragment, @PerUser, 等等)。</li>
<li>Qualifier: 当类的类型不足以鉴别一个依赖的时候，我们就可以使用这个注解标示。例如：在Android中，我们会需要不同类型的context，所以我们就可以定义 qualifier注解“@ForApplication”和“@ForActivity”，这样当注入一个context的时候，我们就可以告诉 Dagger我们想要哪种类型的context。</li>
</ul>
<h2 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h2><p>修饰接口类，内部方法：</p>
<ul>
<li>如果是 void 方法就必须有注入环境</li>
<li>入股参数为 空，就必须有返回类。 返回类必须有 @Inject 提供构造方法类，或者引用的 @Module 有 @Provide提供的。</li>
</ul>
<h1 id="dagger2-最简单的使用例子"><a href="#dagger2-最简单的使用例子" class="headerlink" title="dagger2 最简单的使用例子"></a>dagger2 最简单的使用例子</h1><h2 id="一个需要被注入到-activity-的对象"><a href="#一个需要被注入到-activity-的对象" class="headerlink" title="一个需要被注入到 activity 的对象"></a>一个需要被注入到 activity 的对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Poetry</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String mPoetry;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Poetry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mPoetry = <span class="string">"live is short"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="activity-component"><a href="#activity-component" class="headerlink" title="activity component"></a>activity component</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseUseComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要用到这个连接器的对象，就是这个对象里面有需要注入的属性（被标记为<span class="doctag">@Inject</span>的属性）</span></span><br><span class="line"><span class="comment">     * 这里inject表示注入的意思，这个方法名可以随意更改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(BaseUseActivity baseUseActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建完 Component 后需要编译一遍工程，dagger2 会自动生成一个 DaggerBaseUseComponent 类。</p>
<p>Component 中每个方法的参数对象，表示这些对象里面需要注入一些其他对象。</p>
<h2 id="activity"><a href="#activity" class="headerlink" title="activity"></a>activity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加@Inject注解，表示这个mPoetry是需要注入的</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Poetry mPoetry;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView mTV;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_base_use);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 Dagger2 生成的类 生成组件进行构造，并注入</span></span><br><span class="line">        BaseUseComponent baseUseComponent = DaggerBaseUseComponent.builder()</span><br><span class="line">                .build();</span><br><span class="line">        baseUseComponent.inject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mTV = (TextView) findViewById(R.id.tv_base_use);</span><br><span class="line">        mTV.setText(mPoetry.mPoetry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种不通过 <code>@Module</code> 的注解方式有很多的局限性：</p>
<ol>
<li><code>@Inject</code> 只能注解一个构造方法，对于有多个构造方法的对象不适用</li>
<li>对于第三方库中的对象，没法添加 <code>@Inject</code></li>
</ol>
<h2 id="使用-Module-注入一个-Gson-对象"><a href="#使用-Module-注入一个-Gson-对象" class="headerlink" title="使用 Module 注入一个 Gson 对象"></a>使用 Module 注入一个 Gson 对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUseModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Gson <span class="title">provideGson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Gson();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Module 类，提供被注解的对象</p>
<p>将 Module 和 Component 关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = BaseUseModule<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">BaseUseComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要用到这个连接器的对象，就是这个对象里面有需要注入的属性（被标记为<span class="doctag">@Inject</span>的属性）</span></span><br><span class="line"><span class="comment">     * 这里inject表示注入的意思，这个方法名可以随意更改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(BaseUseActivity baseUseActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Compoent-依赖多个-Module-对象"><a href="#Compoent-依赖多个-Module-对象" class="headerlink" title="Compoent 依赖多个 Module 对象"></a>Compoent 依赖多个 Module 对象</h2><p>如果 Poetry 类有多个构造方法的话，就需要创建额外的 Module：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PoetryModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Poetry <span class="title">providePoetry</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Poetry();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Poetry <span class="title">providePoetry</span><span class="params">(String poetry)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Poetry(poetry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h2><p>标记当前生成对象的使用范围，标识一个类型的注射器只实例化一次，在同一个作用域内，只会生成一个实例，然后在此作用域内共用一个实例。这样看起来很像单例模式，我们可以查看 @Singleton 其实就是@ Scope 的一个默认实现而已。当然，你得是同一个 Component 对象来生成，这点我们应该可以理解的吧。<br>我们可以通过自定义 Scope 来组织 Component 的作用域，使得每个 Component 的作用域清晰明了，各施其职。</p>
<h2 id="组织-Component"><a href="#组织-Component" class="headerlink" title="组织 Component"></a>组织 Component</h2><p>如果其他 Component 需要 ApplicationComponent 中的全局属性的时候，就需要建立两者之间的 依赖方式。</p>
<ol>
<li>要有一个全局的Component(可以叫ApplicationComponent),负责管理整个app的全局类实例</li>
<li>每个页面对应一个 Component，比如一个 Activity 页面定义一个 Component，一个 Fragment 定义一个 Component。当然这不是必须的，有些页面之间的依赖的类是一样的，可以公用一个 Component。</li>
</ol>
<h3 id="依赖方式"><a href="#依赖方式" class="headerlink" title="依赖方式"></a>依赖方式</h3><p>一个Component可以依赖一个或多个Component，并拿到被依赖Component暴露出来的实例，Component的dependencies属性就是确定依赖关系的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(dependencies = ApplicationComponent<span class="class">.<span class="keyword">class</span>, <span class="title">modules</span> </span>= &#123;BaseUseModule<span class="class">.<span class="keyword">class</span>, <span class="title">PoetryModule</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">BaseUseComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<h3 id="包含方式"><a href="#包含方式" class="headerlink" title="包含方式"></a>包含方式</h3><p>SubComponent</p>
<h3 id="继承方式"><a href="#继承方式" class="headerlink" title="继承方式"></a>继承方式</h3><h2 id="Qualifier"><a href="#Qualifier" class="headerlink" title="Qualifier"></a>Qualifier</h2><p>（限定符）就是解决依赖注入迷失问题</p>
<h1 id="Application-dagger2-化"><a href="#Application-dagger2-化" class="headerlink" title="Application dagger2 化"></a>Application dagger2 化</h1><h2 id="创建-Application-的鉴别注解"><a href="#创建-Application-的鉴别注解" class="headerlink" title="创建 Application 的鉴别注解"></a>创建 Application 的鉴别注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier</span> <span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ForApplication &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建-Module"><a href="#创建-Module" class="headerlink" title="创建 Module"></a>创建 Module</h2><p>创建一个 BaseApplication 的依赖注入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> App mApplication;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AppModule</span><span class="params">(App application)</span> </span>&#123;</span><br><span class="line">        mApplication = application;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@ForApplication</span></span><br><span class="line">    <span class="function">Context <span class="title">providerApplication</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mApplication;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建-Component"><a href="#创建-Component" class="headerlink" title="创建 Component"></a>创建 Component</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component</span>(modules = ApplicationModule<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候编译一遍工程  mac 下快捷键：<code>command+f9</code></p>
<p>dagger2 会自动生成一个类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerApplicationComponent</span> <span class="keyword">implements</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Provider&lt;LocationManager&gt; provideLocationManagerProvider;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> MembersInjector&lt;App&gt; appMembersInjector;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> MembersInjector&lt;MainActivity&gt; mainActivityMembersInjector;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">DaggerApplicationComponent</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">assert</span> builder != <span class="keyword">null</span>;</span><br><span class="line">    initialize(builder);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title">builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Builder();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">final</span> Builder builder)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.provideLocationManagerProvider =</span><br><span class="line">        DoubleCheck.provider(</span><br><span class="line">            ApplicationModule_ProvideLocationManagerFactory.create(builder.applicationModule));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.appMembersInjector = App_MembersInjector.create(provideLocationManagerProvider);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.mainActivityMembersInjector =</span><br><span class="line">        MainActivity_MembersInjector.create(provideLocationManagerProvider);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span> </span>&#123;</span><br><span class="line">    appMembersInjector.injectMembers(app);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span> </span>&#123;</span><br><span class="line">    mainActivityMembersInjector.injectMembers(mainActivity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationModule applicationModule;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationComponent <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (applicationModule == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">            ApplicationModule.class.getCanonicalName() + " must be set");</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DaggerApplicationComponent(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Builder <span class="title">applicationModule</span><span class="params">(ApplicationModule applicationModule)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.applicationModule = Preconditions.checkNotNull(applicationModule);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="将-Application-注册到-Component"><a href="#将-Application-注册到-Component" class="headerlink" title="将 Application 注册到 Component"></a>将 Application 注册到 Component</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">    mApplicationComponent = DaggerApplicationComponent.builder()</span><br><span class="line">            .applicationModule(<span class="keyword">new</span> ApplicationModule(<span class="keyword">this</span>))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    mApplicationComponent.inject(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="google-todo-mvp-Dagger"><a href="#google-todo-mvp-Dagger" class="headerlink" title="google todo mvp Dagger"></a>google todo mvp Dagger</h1><p>DemoPresenter:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StatisticsPresenter</span> <span class="keyword">implements</span> <span class="title">StatisticsContract</span>.<span class="title">Presenter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TasksRepository mTasksRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StatisticsContract.View mStatisticsView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    StatisticsPresenter(TasksRepository tasksRepository,</span><br><span class="line">                               StatisticsContract.View statisticsView) &#123;</span><br><span class="line">        mTasksRepository = tasksRepository;</span><br><span class="line">        mStatisticsView = statisticsView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setupListeners</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mStatisticsView.setPresenter(<span class="keyword">this</span>); <span class="comment">// 将 presenter 对象传给 view， 通过 module 获取 view 对象，通过 view 对象的  </span></span><br><span class="line">                                            <span class="comment">//setPresenter 方法将 presenter 对象传给 view</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        loadStatistics();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DemoPresenterModule:</p>
<pre><code>@Module
public class StatisticsPresenterModule {

    private final StatisticsContract.View mView;

    public StatisticsPresenterModule(StatisticsContract.View view) {
        mView = view;
    }

    @Provides
    StatisticsContract.View provideStatisticsContractView() {
        return mView;
    }
}
</code></pre><p>DemoComponent:</p>
<pre><code>@FragmentScoped
@Component(dependencies = TasksRepositoryComponent.class, modules = StatisticsPresenterModule.class)
public interface StatisticsComponent {
    void inject(StatisticsActivity statisticsActivity);
}
</code></pre><p>DemoActivity:</p>
<pre><code>// 属性：
@Inject StatisticsPresenter mStatiticsPresenter;

// 注入代码
DaggerStatisticsComponent.builder()
    .statisticsPresenterModule(new StatisticsPresenterModule(statisticsFragment)) // 给 presenter 注入 view
    .tasksRepositoryComponent(((ToDoApplication) getApplication()) // model
    .getTasksRepositoryComponent())
    .build()
    .inject(this);
</code></pre><h1 id="使用scope时规则"><a href="#使用scope时规则" class="headerlink" title="使用scope时规则"></a>使用scope时规则</h1><ol>
<li>component的dependencies与component自身的scope不能相同，即组件之间的scope不同</li>
<li>Singleton的组件不能依赖其他scope的组件，只能其他scope的组件依赖Singleton的组件。</li>
<li><p>没有scope的不能依赖有scope的组件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error:(21, 1) 错误: com.android.example.devsummit.archdemo.di.component.MyTestComponent (unscoped) cannot depend on scoped components:</span><br><span class="line">@com.android.example.devsummit.archdemo.di.scope.ActivityScope com.android.example.devsummit.archdemo.di.component.MyTestComponentX</span><br></pre></td></tr></table></figure>
</li>
<li><p>一个component不能同时有多个scope(Subcomponent除外)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error:Execution failed for task ‘:app:compileDebugJavaWithJavac’.</span><br><span class="line">java.lang.IllegalArgumentException: com.android.example.devsummit.archdemo.di.component.MyTestComponent was annotated with more than one @Scope annotation</span><br></pre></td></tr></table></figure>
</li>
<li><p>component关联的Model中的任何一个被构造的对象有scope，则该整个component要加上这个scope。在暴露或者注入时（不暴露且不注入时，既不使用它构造对象时，不报错），会有如下错误</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error:(21, 1) 错误: com.android.example.devsummit.archdemo.di.component.MyTestComponent (unscoped) may not reference scoped bindings:</span><br><span class="line">@Provides @com.android.example.devsummit.archdemo.di.scope.ActivityScope com.android.example.devsummit.archdemo.vo.User com.android.example.devsummit.archdemo.di.module.TestModule.user()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="MVP-Dagger2"><a href="#MVP-Dagger2" class="headerlink" title="MVP Dagger2"></a>MVP Dagger2</h1><p>参考：</p>
<ul>
<li><a href="https://github.com/googlesamples/android-architecture" target="_blank" rel="noopener">google_mvp_dagger</a></li>
<li><a href="https://asce1885.gitbooks.io/android-rd-senior-advanced/content/androidzhong_de_yi_lai_zhu_ru_ff1a_dagger_han_shu_ku_de_shi_yong_ff08_er_ff09.html" target="_blank" rel="noopener">https://asce1885.gitbooks.io/android-rd-senior-advanced/content/androidzhong_de_yi_lai_zhu_ru_ff1a_dagger_han_shu_ku_de_shi_yong_ff08_er_ff09.html</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0519/2892.html" target="_blank" rel="noopener">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0519/2892.html</a></li>
<li><a href="http://www.jianshu.com/p/94d47da32656" target="_blank" rel="noopener">http://www.jianshu.com/p/94d47da32656</a></li>
<li><a href="http://www.jianshu.com/p/65737ac39c44" target="_blank" rel="noopener">http://www.jianshu.com/p/65737ac39c44</a></li>
<li><a href="http://limuzhi.com/2016/03/06/Android%E6%B3%A8%E5%85%A5%E6%A1%86%E6%9E%B6Dagger2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">http://limuzhi.com/2016/03/06/Android%E6%B3%A8%E5%85%A5%E6%A1%86%E6%9E%B6Dagger2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/01/Android/gradle/gradle密钥配置方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/01/Android/gradle/gradle密钥配置方式/" itemprop="url">Gradle 密钥配置方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-01T09:13:12+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>app/gradle</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Properties props = new Properties()</span><br><span class="line">props.load(new FileInputStream(file(&quot;signing.properties&quot;)))</span><br><span class="line">android &#123;</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        release&#123;</span><br><span class="line">            keyAlias props[&apos;KEY_ALIAS&apos;]</span><br><span class="line">            keyPassword props[&apos;KEY_PASSWORD&apos;]</span><br><span class="line">            storeFile file(props[&apos;KEYSTORE_FILE&apos;])</span><br><span class="line">            storePassword props[&apos;KEYSTORE_PASSWORD&apos;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>app/siging.properties</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">KEYSTORE_FILE = C:\\Users\\Mr.Jude\\Documents\\Android\\HelloWorld.jks</span><br><span class="line">KEYSTORE_PASSWORD = xxxxxx</span><br><span class="line">KEY_ALIAS = xxxxxx</span><br><span class="line">KEY_PASSWORD = xxxxxx</span><br></pre></td></tr></table></figure>
<p>将signing.properties添加进忽略目录。<br>其他人pull下来代码后。自己新建signing.properties填入相应信息后即可编译成功。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/27/Android/第三方/RxJava/看了一些RxJava的文章依然不知道的事/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/27/Android/第三方/RxJava/看了一些RxJava的文章依然不知道的事/" itemprop="url">看了一些 RxJava 的文章我依然不知道的事</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-27T13:18:12+08:00">
                2016-11-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>以下代码基于 RxJava2</p>
</blockquote>
<h1 id="内存泄露处理"><a href="#内存泄露处理" class="headerlink" title="内存泄露处理"></a>内存泄露处理</h1><p>基本代码：</p>
<pre><code>private final CompositeDisposable disposables = new CompositeDisposable();

public void doSomeWork2() {
    // 1. 创建一个普通的 observable
    Observable&lt;String&gt; observable = Observable.create(new ObservableOnSubscribe&lt;String&gt;() {
        @Override
        public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception {
            if (e.isDisposed()) return;
            SystemClock.sleep(2000);
            e.onNext(&quot;next&quot;);
            e.onComplete();
        }
    });

    // 2. 创建一个可被 CompositeDisposable 管理的 observer
    DisposableObserver&lt;String&gt; observer = new DisposableObserver&lt;String&gt;() {
        @Override
        public void onNext(String value) {

        }

        @Override
        public void onError(Throwable e) {

        }

        @Override
        public void onComplete() {

        }
    };

    // 3. 订阅事件
    observable.subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
            .subscribe(observer);

    // 4. 将需要被 CompositeDisposable 管理的 observer 加入到管理集合中
    disposables.add(observer);
}
</code></pre><p>在 Activity／Fragment 销毁生命周期中取消异步操作防止内存泄露：</p>
<pre><code>@Override
protected void onDestroy() {
    super.onDestroy();
    // 将所有的 observer 取消订阅
    disposables.clear();
}
</code></pre><h1 id="在-mvp-的项目中处理内存泄露"><a href="#在-mvp-的项目中处理内存泄露" class="headerlink" title="在 mvp 的项目中处理内存泄露"></a>在 mvp 的项目中处理内存泄露</h1><p>基于 <a href="https://github.com/googlesamples/android-architecture/tree/todo-mvp-rxjava/" target="_blank" rel="noopener">google todo-mvp-rxjava </a> 搭建项目 mvp 框架：</p>
<p>BasePresenter :</p>
<pre><code>public abstract class BasePresenter {

    CompositeDisposable mCompositeDisposable = new CompositeDisposable();

    public void unSubscribe() {
        mCompositeDisposable.clear();
    }


    public void register(Disposable disposable) {
        mCompositeDisposable.add(disposable);
    }


}
</code></pre><p>一个例子 SimplePresenter extends BasePresenter :</p>
<pre><code>public class SimplePresenter extends BasePresenter {
    private static final String TAG = SimplePresenter.class.getSimpleName();


    //.....

    public void startWork() {

        DisposableObserver&lt;Long&gt; observer = new DisposableObserver&lt;Long&gt;() {
            @Override
            public void onNext(Long value) {
                Log.d(TAG, &quot;onNext: &quot;);
            }

            @Override
            public void onError(Throwable e) {

            }

            @Override
            public void onComplete() {

            }
        };
        Observable.interval(2000, TimeUnit.MILLISECONDS)
                .subscribeOn(Schedulers.io())
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(observer);

        register(observer);

    }

}
</code></pre><p><strong>注意：</strong>在使用 RxJava 做异步操作的时候，调用 <code>register(observer);</code> 注册 observer 到 CompositeDisposable 中统一管理。</p>
<p>Activity/Fragment:</p>
<pre><code>@Override
protected void onDestroy() {
    super.onDestroy();
    mSimplePresenter.unSubscribe();
}
</code></pre><h1 id="慎用-functions"><a href="#慎用-functions" class="headerlink" title="慎用 functions"></a>慎用 functions</h1><p>functions：Action，Consumer，Function 等</p>
<p>原因：这些方法只会对 <code>onNext</code> 事件进行处理，如果 observable 中出现异常产生了 <code>onError</code> 事件就会导致 app 奔溃。</p>
<p>解决方案：</p>
<ol>
<li>不用简化方法</li>
<li>自己封装一个：</li>
</ol>
<p>封装一个类似下面的基类：</p>
<pre><code>public abstract class BaseDisposableObserver&lt;T&gt; extends DisposableObserver&lt;T&gt; {

    private static final String TAG = BaseDisposableObserver.class.getSimpleName();

    @Override
    public void onError(Throwable e) {
        Log.e(TAG, &quot;onError: &quot; + e.getMessage());
    }

    @Override
    public void onComplete() {

    }
}
</code></pre><p>使用的时候和 functions 是一样的：（这样下面的代码就不会导致app奔溃了）</p>
<pre><code>BaseDisposableObserver&lt;Long&gt; baseDisposableObserver = new BaseDisposableObserver&lt;Long&gt;() {
    @Override
    public void onNext(Long value) {
        Log.d(TAG, &quot;onNext: &quot;);
    }
};

Observable.interval(2000, TimeUnit.MILLISECONDS)
        .filter(new Predicate&lt;Long&gt;() {
            @Override
            public boolean test(Long aLong) throws Exception {
                Log.d(TAG, &quot;test: along:&quot; + aLong);

                if (aLong &gt; 2) {
                    throw new Exception(&quot;sdf&quot;);
                }

                return true;
            }
        })
//                .subscribeOn(Schedulers.io())
//                .observeOn(AndroidSchedulers.mainThread())
        .subscribe(baseDisposableObserver);
</code></pre><blockquote>
<p>RxJava 看的还不多，如有错误还请指出</p>
</blockquote>
<p>参考</p>
<ul>
<li><a href="https://github.com/googlesamples/android-architecture/tree/todo-mvp-rxjava/" target="_blank" rel="noopener">google todo-mvp-rxjava </a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/28/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><span class="page-number current">29</span><a class="page-number" href="/page/30/">30</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/30/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/head1.jpg" alt="Double">
          <p class="site-author-name" itemprop="name">Double</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">548</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">260</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Double</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
