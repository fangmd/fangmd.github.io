<!doctype html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Double">
<meta property="og:url" content="http://yoursite.com/page/30/index.html">
<meta property="og:site_name" content="Double">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Double">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/30/">





  <title>Double</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Double</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/27/Android/view/RecyclerView/RecyclerView悬浮条/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/27/Android/view/RecyclerView/RecyclerView悬浮条/" itemprop="url">RecyclerView悬浮条</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-27T09:38:14+08:00">
                2016-11-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><pre><code>&lt;FrameLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;


    &lt;android.support.v7.widget.RecyclerView
        android:id=&quot;@+id/rv_float&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        app:layoutManager=&quot;LinearLayoutManager&quot;/&gt;


    &lt;TextView
        android:id=&quot;@+id/tv_float&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;60dp&quot;
        android:background=&quot;#fff&quot;
        android:gravity=&quot;center&quot;
        android:text=&quot;head&quot;
        android:textSize=&quot;20sp&quot;/&gt;


&lt;/FrameLayout&gt;
</code></pre><h1 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h1><pre><code>mRV.addOnScrollListener(new RecyclerView.OnScrollListener() {
    @Override
    public void onScrollStateChanged(RecyclerView recyclerView, int newState) {
        super.onScrollStateChanged(recyclerView, newState);

    }

    @Override
    public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
        super.onScrolled(recyclerView, dx, dy);

        LinearLayoutManager layoutManager = (LinearLayoutManager) recyclerView.getLayoutManager();
        View view = layoutManager.findViewByPosition(mFloatItemCurrentPos + 1);

        if (view != null &amp;&amp; view.getTop() &lt;= mFloatItemHeight) {
            mTV.setY(-(mFloatItemHeight - view.getTop()));
        }else {
            mTV.setY(0);
        }

        if (mFloatItemCurrentPos != layoutManager.findFirstVisibleItemPosition()) {
            mFloatItemCurrentPos = layoutManager.findFirstVisibleItemPosition();
            mTV.setY(0);

            updateFloatItem();
        }
    }
});

private void updateFloatItem() {
     String s = mStrings.get(mFloatItemCurrentPos);
     mTV.setText(s);
 }
</code></pre><p>参考：</p>
<ul>
<li><a href="http://www.jianshu.com/p/fe69a53502ab[](http://www.jianshu.com/p/fe69a53502ab)" target="_blank" rel="noopener">http://www.jianshu.com/p/fe69a53502ab[](http://www.jianshu.com/p/fe69a53502ab)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/27/Android/features/clear_data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/27/Android/features/clear_data/" itemprop="url">Android clean data in Application</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-27T09:23:14+08:00">
                2016-11-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://stackoverflow.com/questions/6134103/clear-applications-data-programmatically" alt="http://stackoverflow.com/questions/6134103/clear-applications-data-programmatically"></p>
<p>Utils:</p>
<pre><code>public static void clearApplicationData() {
    File cacheDirectory = BaseApplication.getInstance().getCacheDir();
    File applicationDirectory = new File(cacheDirectory.getParent());
    if (applicationDirectory.exists()) {
        String[] fileNames = applicationDirectory.list();
        for (String fileName : fileNames) {
            if (!fileName.equals(&quot;lib&quot;)) {
                deleteFile(new File(applicationDirectory, fileName));
            }
        }
    }
}

public static boolean deleteFile(File file) {
    boolean deletedAll = true;
    if (file != null) {
        if (file.isDirectory()) {
            String[] children = file.list();
            for (int i = 0; i &lt; children.length; i++) {
                deletedAll = deleteFile(new File(file, children[i])) &amp;&amp; deletedAll;
            }
        } else {
            deletedAll = file.delete();
        }
    }

    return deletedAll;
}
</code></pre><h1 id="Clean-SharePreferences"><a href="#Clean-SharePreferences" class="headerlink" title="Clean SharePreferences"></a>Clean SharePreferences</h1><pre><code>prefs.edit().clear().commit();
</code></pre><h1 id="Api-19"><a href="#Api-19" class="headerlink" title="Api 19"></a>Api 19</h1><pre><code>import android.os.Build.*;
if (VERSION_CODES.KITKAT &lt;= VERSION.SDK_INT) {
    ((ActivityManager)context.getSystemService(ACTIVITY_SERVICE))
            .clearApplicationUserData(); // note: it has a return value!
} else {
    // use old hacky way, which can be removed
    // once minSdkVersion goes above 19 in a few years.
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/24/Android/第三方/RxJava/Rxjava2代码例子/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/24/Android/第三方/RxJava/Rxjava2代码例子/" itemprop="url">Rxjava2 代码例子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-24T13:18:12+08:00">
                2016-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Backpressure-背压"><a href="#Backpressure-背压" class="headerlink" title="Backpressure 背压"></a>Backpressure 背压</h1><p>背压是指在异步场景中，被观察者发送事件速度远快于观察者的处理速度的情况下，一种告诉上游的被观察者降低发送速度的策略。</p>
<p>简单的说：发射数据太快，观察者来不及处理。</p>
<p>强调两点：</p>
<ol>
<li>背压策略的一个前提是异步环境，也就是说，被观察者和观察者处在不同的线程环境中。</li>
<li>背压（Backpressure）并不是一个像 flatMap 一样可以在程序中直接使用的操作符，他只是一种控制事件流速的策略。</li>
</ol>
<p>使用 Flowable 处理背压</p>
<h1 id="使用的基本流"><a href="#使用的基本流" class="headerlink" title="使用的基本流"></a>使用的基本流</h1><ol>
<li>创建 Observable：被观察者</li>
<li>创建 Observer：观察者</li>
<li>订阅事件 subscribe：Observable 和 Observer 通过 subscribe() 方法实现订阅关系</li>
</ol>
<h1 id="SimpleExample"><a href="#SimpleExample" class="headerlink" title="SimpleExample"></a>SimpleExample</h1><pre><code>Observable.just(&quot;observable&quot;)
        .subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(new Observer&lt;String&gt;() {
            @Override
            public void onSubscribe(Disposable d) {
                // Disposable 对象用于取消订阅
            }

            @Override
            public void onNext(String value) {

            }

            @Override
            public void onError(Throwable e) {

            }

            @Override
            public void onComplete() {

            }
        });
</code></pre><p>使用 <code>Disposable</code> 对象取消订阅：</p>
<pre><code>if (!d.isDisposed()) {
    d.dispose();
}
</code></pre><blockquote>
<p>注意: 调用dispose()并不会导致上游不再继续发送事件, 上游会继续发送剩余的事件.</p>
</blockquote>
<h1 id="Map-操作符"><a href="#Map-操作符" class="headerlink" title="Map 操作符"></a>Map 操作符</h1><p>将被观察者发射的数据转化后发射给观察者。</p>
<pre><code>Observable&lt;List&lt;ApiUser&gt;&gt; observable = Observable.create(new ObservableOnSubscribe&lt;List&lt;ApiUser&gt;&gt;() {
    @Override
    public void subscribe(ObservableEmitter&lt;List&lt;ApiUser&gt;&gt; e) throws Exception {
        // 代码判断是否订阅被取消了
        if (!e.isDisposed()) {
            e.onNext(Utils.getApiUserList());
            e.onComplete();
        }
    }
});

Observer&lt;List&lt;User&gt;&gt; observer = new Observer&lt;List&lt;User&gt;&gt;() {
    @Override
    public void onSubscribe(Disposable d) {

    }

    @Override
    public void onNext(List&lt;User&gt; value) {

    }

    @Override
    public void onError(Throwable e) {

    }

    @Override
    public void onComplete() {

    }
};

Function&lt;List&lt;ApiUser&gt;, List&lt;User&gt;&gt; mapper = new Function&lt;List&lt;ApiUser&gt;, List&lt;User&gt;&gt;() {
    @Override
    public List&lt;User&gt; apply(List&lt;ApiUser&gt; apiUsers) throws Exception {
        return Utils.convertApiUserListToUserList(apiUsers);
    }
};

observable.subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread())
        .map(mapper)
        .subscribe(observer);
</code></pre><h2 id="ObservableEmitter-发射器"><a href="#ObservableEmitter-发射器" class="headerlink" title="ObservableEmitter 发射器"></a>ObservableEmitter 发射器</h2><p>RxJava2 中使用发射器向观察者发送数据。</p>
<p>继承自 <code>Emitter</code></p>
<pre><code>public interface ObservableEmitter&lt;T&gt; extends Emitter&lt;T&gt; {

    void setDisposable(Disposable d);
    void setCancellable(Cancellable c);
    boolean isDisposed();
    ObservableEmitter&lt;T&gt; serialize();

}
</code></pre><p>发射方法在 <code>Emitter</code>:</p>
<pre><code>void onNext(T value);
void onError(Throwable error);
void onComplete();
</code></pre><p>一些发射规则：</p>
<ol>
<li>可以发送无限个 onNext, Observer 也可以接收无限个 onNext.</li>
<li>当发送了一个onComplete后继续发送 onNext, 而 Observable 收到 onComplete 事件之后将不再继续接收事件.</li>
<li>当发送了一个onError后继续发送 onNext, 而 Observable 收到 onError 事件之后将不再继续接收事件.</li>
<li>可以不发送onComplete或onError.</li>
<li>最为关键的是onComplete和onError必须唯一并且互斥, 即不能发多个onComplete, 也不能发多个onError, 也不能先发一个onComplete, 然后再发一个onError, 反之亦然</li>
</ol>
<h1 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h1><blockquote>
<p>flatMap并不保证事件的顺序</p>
</blockquote>
<h2 id="使用例子"><a href="#使用例子" class="headerlink" title="使用例子"></a>使用例子</h2><p>解决嵌套请求</p>
<pre><code>api.register(new RegisterRequest())            //发起注册请求
    .subscribeOn(Schedulers.io())               //在IO线程进行网络请求
    .observeOn(AndroidSchedulers.mainThread())  //回到主线程去处理请求注册结果
    .doOnNext(new Consumer&lt;RegisterResponse&gt;() {
        @Override
        public void accept(RegisterResponse registerResponse) throws Exception {
            //先根据注册的响应结果去做一些操作
        }
    })
    .observeOn(Schedulers.io())                 //回到IO线程去发起登录请求
    .flatMap(new Function&lt;RegisterResponse, ObservableSource&lt;LoginResponse&gt;&gt;() {
        @Override
        public ObservableSource&lt;LoginResponse&gt; apply(RegisterResponse registerResponse) throws Exception {
            return api.login(new LoginRequest());
        }
    })
    .observeOn(AndroidSchedulers.mainThread())  //回到主线程去处理请求登录的结果
    .subscribe(new Consumer&lt;LoginResponse&gt;() {
        @Override
        public void accept(LoginResponse loginResponse) throws Exception {
            Toast.makeText(MainActivity.this, &quot;登录成功&quot;, Toast.LENGTH_SHORT).show();
        }
    }, new Consumer&lt;Throwable&gt;() {
        @Override
        public void accept(Throwable throwable) throws Exception {
            Toast.makeText(MainActivity.this, &quot;登录失败&quot;, Toast.LENGTH_SHORT).show();
        }
    });
</code></pre><h1 id="concatMap"><a href="#concatMap" class="headerlink" title="concatMap"></a>concatMap</h1><p>和 flatMap 一样，不过可以保证事件的顺序</p>
<h1 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h1><p>合并两个 Observerable</p>
<h2 id="实例，将连个请求的数据合并"><a href="#实例，将连个请求的数据合并" class="headerlink" title="实例，将连个请求的数据合并"></a>实例，将连个请求的数据合并</h2><pre><code>Observable&lt;UserBaseInfoResponse&gt; observable1 =                                            
        api.getUserBaseInfo(new UserBaseInfoRequest()).subscribeOn(Schedulers.io());      

Observable&lt;UserExtraInfoResponse&gt; observable2 =                                           
        api.getUserExtraInfo(new UserExtraInfoRequest()).subscribeOn(Schedulers.io());    

Observable.zip(observable1, observable2,                                                  
        new BiFunction&lt;UserBaseInfoResponse, UserExtraInfoResponse, UserInfo&gt;() {         
            @Override                                                                     
            public UserInfo apply(UserBaseInfoResponse baseInfo,                          
                                  UserExtraInfoResponse extraInfo) throws Exception {     
                return new UserInfo(baseInfo, extraInfo);                                 
            }                                                                             
        }).observeOn(AndroidSchedulers.mainThread())                                      
        .subscribe(new Consumer&lt;UserInfo&gt;() {                                             
            @Override                                                                     
            public void accept(UserInfo userInfo) throws Exception {                      
                //do something;                                                           
            }                                                                             
        });
</code></pre><h1 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h1><h1 id="Disposable-防止内存泄露"><a href="#Disposable-防止内存泄露" class="headerlink" title="Disposable 防止内存泄露"></a>Disposable 防止内存泄露</h1><p>需要用到的对象： <code>CompositeDisposable</code></p>
<p>使用：</p>
<pre><code>private final CompositeDisposable disposables = new CompositeDisposable();

public void mine() {
    Observable&lt;String&gt; observable = Observable.create(new ObservableOnSubscribe&lt;String&gt;() {
        @Override
        public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception {
            if (e.isDisposed()) return;
            SystemClock.sleep(2000);
            e.onNext(&quot;next&quot;);
            e.onComplete();
        }
    });

    DisposableObserver&lt;String&gt; observer = new DisposableObserver&lt;String&gt;() {
        @Override
        public void onNext(String value) {

        }

        @Override
        public void onError(Throwable e) {

        }

        @Override
        public void onComplete() {

        }
    };

    observable.subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
            .subscribeWith(observer);  //  从源码看  subscribeWith 和 subscribe 没有区别，除了返回值：subscribeWith 会返回 observer 本身，这里也可以使用 subscribe

    disposables.add(observer);


}

@Override
protected void onDestroy() {
    super.onDestroy();
    disposables.clear(); // do not send event after activity has been destroyed
}
</code></pre><h2 id="可以利用这个封装一个防止泄露的框架"><a href="#可以利用这个封装一个防止泄露的框架" class="headerlink" title="可以利用这个封装一个防止泄露的框架"></a>可以利用这个封装一个防止泄露的框架</h2><p>BasePresenter:</p>
<pre><code>public abstract class BasePresenter {

    CompositeDisposable mCompositeDisposable = new CompositeDisposable();

    public void unSubscribe() {
        mCompositeDisposable.clear();
    }


    public void register(Disposable disposable) {
        mCompositeDisposable.add(disposable);
    }


}
</code></pre><p>SimplePresenter extends BasePresenter:</p>
<pre><code>public class SimplePresenter extends BasePresenter {
    private static final String TAG = SimplePresenter.class.getSimpleName();


    //.....

    public void startWork() {

        DisposableObserver&lt;Long&gt; observer = new DisposableObserver&lt;Long&gt;() {
            @Override
            public void onNext(Long value) {
                Log.d(TAG, &quot;onNext: &quot;);
            }

            @Override
            public void onError(Throwable e) {

            }

            @Override
            public void onComplete() {

            }
        };
        Observable.interval(2000, TimeUnit.MILLISECONDS)
                .subscribeOn(Schedulers.io())
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(observer);

        register(observer);

    }

}
</code></pre><p><strong>注意：</strong>在使用 RxJava 做异步操作的时候，调用 <code>register(observer);</code> 注册 observer 到 CompositeDisposable 中统一管理。</p>
<p>Activity/Fragment:</p>
<pre><code>@Override
protected void onDestroy() {
    super.onDestroy();
    mSimplePresenter.unSubscribe();
}
</code></pre><p>尽量在使用 functions 包下的简化接口时要谨慎，因为他们不具备异常处理方法，可以使用类似下面的封装简化代码：</p>
<pre><code>public abstract class BaseDisposableObserver&lt;T&gt; extends DisposableObserver&lt;T&gt; {

    private static final String TAG = BaseDisposableObserver.class.getSimpleName();

    @Override
    public void onError(Throwable e) {
        Log.e(TAG, &quot;onError: &quot; + e.getMessage());
    }

    @Override
    public void onComplete() {

    }
}
</code></pre><p>使用：</p>
<pre><code>BaseDisposableObserver&lt;Long&gt; baseDisposableObserver = new BaseDisposableObserver&lt;Long&gt;() {
    @Override
    public void onNext(Long value) {
        Log.d(TAG, &quot;onNext: &quot;);
    }
};

//.... 对于不需要处理的异常让其父类捕获，需要就重写 onError 方法即可
.subscribe(baseDisposableObserver);
</code></pre><h1 id="take"><a href="#take" class="headerlink" title="take"></a>take</h1><p>设置 Observable 能够发射（ onNext ）的最大消息数，超过的不会被接收到</p>
<pre><code>observable.subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread())
        .take(3)
        .subscribe(observer);
</code></pre><h1 id="timer-延时操作"><a href="#timer-延时操作" class="headerlink" title="timer 延时操作"></a>timer 延时操作</h1><pre><code>Observable&lt;Long&gt; observable = Observable.timer(2, TimeUnit.SECONDS);
</code></pre><h1 id="interval-循环执行"><a href="#interval-循环执行" class="headerlink" title="interval 循环执行"></a>interval 循环执行</h1><pre><code>Observable.interval(0, 2, TimeUnit.SECONDS)
</code></pre><h1 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h1><p>将所有的发送数据进行处理，返回一个统一的数据。</p>
<pre><code>Observable.just(1, 2, 3, 4).reduce(new BiFunction&lt;Integer, Integer, Integer&gt;() {
    @Override
    public Integer apply(Integer t1, Integer t2) {
        return t1 + t2;
    }
}).subscribe(getObserver());

//结果：10
</code></pre><h1 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h1><pre><code>Observable&lt;List&lt;String&gt;&gt; buffered = Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;).buffer(3, 1);

// 3 means,  it takes max of three from its start index and create list
// 1 means, it jumps one step every time
// so the it gives the following list
// 1 - one, two, three
// 2 - two, three, four
// 3 - three, four, five
// 4 - four, five
// 5 - five

buffered.subscribe(getObserver());
</code></pre><h1 id="filter-过滤"><a href="#filter-过滤" class="headerlink" title="filter 过滤"></a>filter 过滤</h1><pre><code>Observable.just(1, 2, 3, 4, 5, 6)
        .filter(new Predicate&lt;Integer&gt;() {
            @Override
            public boolean test(Integer integer) throws Exception {
                return integer % 2 == 0;
            }
        })
        .subscribe(getObserver());
</code></pre><h1 id="skip-跳过"><a href="#skip-跳过" class="headerlink" title="skip 跳过"></a>skip 跳过</h1><p>设置跳过发射的数据的个数</p>
<pre><code>getObservable()
        .subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread())
        .skip(2)
        .subscribe(getObserver());
</code></pre><h1 id="replay-重复发射"><a href="#replay-重复发射" class="headerlink" title="replay 重复发射"></a>replay 重复发射</h1><h1 id="repeat-重复"><a href="#repeat-重复" class="headerlink" title="repeat 重复"></a>repeat 重复</h1><p>在接收到 onComplete 事件后触发</p>
<h2 id="repeatWhen"><a href="#repeatWhen" class="headerlink" title="repeatWhen"></a>repeatWhen</h2><h1 id="retry-重复"><a href="#retry-重复" class="headerlink" title="retry 重复"></a>retry 重复</h1><p>参数 times：表示重试次数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Observable&lt;T&gt; <span class="title">retry</span><span class="params">(<span class="keyword">long</span> times)</span> </span>&#123;</span><br></pre></td></tr></table></figure></p>
<p>接收到.onError()事件后触发重订阅</p>
<h2 id="retryWhen"><a href="#retryWhen" class="headerlink" title="retryWhen"></a>retryWhen</h2><h3 id="retryWhen-操作符实现错误重试机制"><a href="#retryWhen-操作符实现错误重试机制" class="headerlink" title="retryWhen 操作符实现错误重试机制"></a>retryWhen 操作符实现错误重试机制</h3><p>RetryWithDelay:</p>
<pre><code>public class RetryWithDelay implements Function&lt;Flowable&lt;Throwable&gt;, Publisher&lt;?&gt;&gt; {

    private final int maxRetries;
    private final int retryDelayMillis;
    private int retryCount;

    public RetryWithDelay(int maxRetries, int retryDelayMillis) {
        this.maxRetries = maxRetries;
        this.retryDelayMillis = retryDelayMillis;
    }


    @Override
    public Publisher&lt;?&gt; apply(Flowable&lt;Throwable&gt; throwableFlowable) throws Exception {
        Flowable&lt;Throwable&gt; delay = throwableFlowable.delay(retryDelayMillis, TimeUnit.MILLISECONDS);
        return delay;
    }
}
</code></pre><p>usage:</p>
<pre><code>mDisposable = Flowable.create(new LongConnectFlowableOnSubscribe(), BackpressureStrategy.BUFFER)
          .subscribeOn(Schedulers.io())
          .observeOn(AndroidSchedulers.mainThread())
          .retryWhen(new RetryWithDelay(3, 3000))
          .repeat()
          .subscribe(new Consumer&lt;String&gt;() {
              @Override
              public void accept(String s) throws Exception {
                  dealMsg(s);
              }
          }, throwable -&gt; {
              LoggerUtils.e(throwable.getMessage());
          });
</code></pre><h1 id="concat-将多个被观察者顺序执行"><a href="#concat-将多个被观察者顺序执行" class="headerlink" title="concat 将多个被观察者顺序执行"></a>concat 将多个被观察者顺序执行</h1><pre><code>Observable.concat(aObservable, bObservable)
                .subscribe(getObserver());

// aObservable 发射完数据后，bObservable发射数据
</code></pre><h1 id="merge-结合多个被观察者"><a href="#merge-结合多个被观察者" class="headerlink" title="merge 结合多个被观察者"></a>merge 结合多个被观察者</h1><p>和concat比无序，接收到的数据可能是穿插的</p>
<pre><code>Observable.merge(aObservable, bObservable)
        .subscribe(getObserver());
</code></pre><h1 id="defer-延迟"><a href="#defer-延迟" class="headerlink" title="defer 延迟"></a>defer 延迟</h1><pre><code>Observable.defer(new Callable&lt;ObservableSource&lt;? extends String&gt;&gt;() {
            @Override
            public ObservableSource&lt;? extends String&gt; call() throws Exception {
                return Observable.just(brand);
            }
        });

// 通过上面创建的 Observable

//....修改 brand 有效

brandDeferObservable
            .subscribe(getObserver()); // 获取到的数据是修改后的 brand
</code></pre><h1 id="distinct-保证发射的数据不重复"><a href="#distinct-保证发射的数据不重复" class="headerlink" title="distinct 保证发射的数据不重复"></a>distinct 保证发射的数据不重复</h1><pre><code>getObservable().distinct() .subscribe(getObserver());
</code></pre><h1 id="last-最后的数据"><a href="#last-最后的数据" class="headerlink" title="last 最后的数据"></a>last 最后的数据</h1><p>观察者只会收到被观察者最后发射的数据，可以设置默认值</p>
<pre><code>getObservable().last(&quot;A1&quot;) // the default item (&quot;A1&quot;) to emit if the source ObservableSource is empty
         .subscribe(getObserver());
</code></pre><h1 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h1><p>每隔 [时间] 发送里时间点最近那个事件，</p>
<h2 id="Obserable-基本类型"><a href="#Obserable-基本类型" class="headerlink" title="Obserable 基本类型"></a>Obserable 基本类型</h2><h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h2><h2 id="Maybe"><a href="#Maybe" class="headerlink" title="Maybe"></a>Maybe</h2><h2 id="Single-发送一个消息"><a href="#Single-发送一个消息" class="headerlink" title="Single 发送一个消息"></a>Single 发送一个消息</h2><pre><code>Single.just(&quot;Amit&quot;)...
</code></pre><h2 id="CompletableObserver"><a href="#CompletableObserver" class="headerlink" title="CompletableObserver"></a>CompletableObserver</h2><pre><code>Completable completable = Completable.create(new CompletableOnSubscribe() {
    @Override
    public void subscribe(CompletableEmitter e) throws Exception {
        //
    }
});
</code></pre><p><code>CompletableEmitter</code> 只能发射结束事件和异常事件 <code>onComplete</code>,<code>onError</code></p>
<p>用于执行单任务</p>
<h2 id="Flowable"><a href="#Flowable" class="headerlink" title="Flowable"></a>Flowable</h2><p>在RxJava1.x中背压控制是由Observable完成的，而在RxJava2.x中将其独立了出来，取名为Flowable。</p>
<p>通过Flowable我们可以自定义背压处理策略</p>
<pre><code>Flowable.create(new FlowableOnSubscribe&lt;Integer&gt;() {

          @Override
          public void subscribe(FlowableEmitter&lt;Integer&gt; e) throws Exception {

              for(int i=0;i&lt;10000;i++){
                  e.onNext(i);
              }
              e.onComplete();
          }
      }, FlowableEmitter.BackpressureMode.ERROR) //指定背压处理策略，抛出异常
              .subscribeOn(Schedulers.computation())
              .observeOn(Schedulers.newThread())
              .subscribe(new Consumer&lt;Integer&gt;() {
                  @Override
                  public void accept(Integer integer) throws Exception {
                      Log.d(&quot;JG&quot;, integer.toString());
                      Thread.sleep(1000);
                  }
              }, new Consumer&lt;Throwable&gt;() {
                  @Override
                  public void accept(Throwable throwable) throws Exception {
                      Log.d(&quot;JG&quot;,throwable.toString());
                  }
              });
</code></pre><p>或者：</p>
<pre><code>Flowable.range(1,10000)
               .onBackpressureDrop()
               .subscribe(integer -&gt; Log.d(&quot;JG&quot;,integer.toString()));
</code></pre><p>参考：</p>
<ul>
<li><a href="https://github.com/amitshekhariitbhu/RxJava2-Android-Samples" target="_blank" rel="noopener">Rxjava2代码例子</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/0907/6604.html" target="_blank" rel="noopener">Rxjava2和Rxjava1的不同点</a></li>
<li><a href="http://gold.xitu.io/post/582d413c8ac24700619cceed" target="_blank" rel="noopener">背压</a></li>
<li><a href="https://gold.xitu.io/post/5848d96761ff4b0058c9d3dc" target="_blank" rel="noopener">https://gold.xitu.io/post/5848d96761ff4b0058c9d3dc</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/21/java/Listenner&Filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/java/Listenner&Filter/" itemprop="url">Listener&Filter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-21T21:18:12+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java基础/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h1><p>监听器</p>
<h2 id="Web-监听器"><a href="#Web-监听器" class="headerlink" title="Web 监听器"></a>Web 监听器</h2><p>总共有 8 种，划分成三种类型</p>
<h3 id="1-监听三个作用域创建和销毁"><a href="#1-监听三个作用域创建和销毁" class="headerlink" title="1. 监听三个作用域创建和销毁"></a>1. 监听三个作用域创建和销毁</h3><p>request – httpServletRequest<br>session – httpSession<br>application – ServletContext</p>
<p>ServletContextListener<br>    ServletContext 创建：启动 tomcat 服务器的时候<br>    ServletContext 销毁：tomcat 关闭的时候</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.passon.student_manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyServletContextListener init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyServletContextListener destory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册监听：<code>WEB_INFO/web.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;listener&gt;</span><br><span class="line">   &lt;listener-class&gt;com.passon.student_manager.MyServletContextListener&lt;/listener-class&gt;</span><br><span class="line">&lt;/listener&gt;</span><br></pre></td></tr></table></figure>
<p>ServletRequestListener<br>    request 创建：访问服务器上的任意资源<br>    request 销毁：服务器已经对请求作出响应</p>
<p>HttpSessionListener<br>    session 的创建：只要调用 getSession(html不会，jsp会，servlet会)<br>    session 的销毁：超时 30分钟，非正常关闭，正常关闭服务器(序列化)</p>
<p>ServletContextListener 作用：</p>
<ol>
<li>在初始化中，做一些代码初始化工作</li>
<li>在初始化中，执行自定义的任务调度 (Timer)</li>
</ol>
<p>HttpSessionListener 作用</p>
<ol>
<li>统计在线人数</li>
</ol>
<h3 id="2-监听三个作用域属性状态变更"><a href="#2-监听三个作用域属性状态变更" class="headerlink" title="2. 监听三个作用域属性状态变更"></a>2. 监听三个作用域属性状态变更</h3><blockquote>
<p>监听在作用域中值的 添加，替换，移除</p>
</blockquote>
<ul>
<li>ServletContextAttributeListener</li>
<li>ServletRequestAttributeListener</li>
<li>HttpSessionAttributeListener</li>
</ul>
<h3 id="3-监听-httpSession-里面存值的状态变更"><a href="#3-监听-httpSession-里面存值的状态变更" class="headerlink" title="3. 监听 httpSession 里面存值的状态变更"></a>3. 监听 httpSession 里面存值的状态变更</h3><blockquote>
<p>这类监听器不用注册, 需要让 JavaBean 实现这个接口</p>
</blockquote>
<ol>
<li>HttpSessionBindingListener</li>
</ol>
<p>监听对象与 sessoin 绑定状态</p>
<ol start="2">
<li>HttpSessionActivationListener</li>
</ol>
<blockquote>
<p>JavaBean 需要实现序列化接口</p>
</blockquote>
<p>用于监听 session 的值，是钝化(序列化)还是活化(反序列化)。</p>
<p>如何让 session 在一定时间内钝化?</p>
<p>配置:</p>
<ol>
<li>tomcat 配置 conf/context.xml 里面配置；对服务器中所有项目都生效</li>
<li>在 conf/Catalina/localhost/context.xml 对 localhost 域名的工程生效</li>
<li>web 工程中配置 META_INF/context.xml; 对当前工程生效</li>
</ol>
<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><blockquote>
<p>过滤器，对客户端发出的请求进行过滤。起到拦截作用</p>
</blockquote>
<p>创建时间：服务器启动的时候<br>销毁时间：服务器关闭的时候</p>
<p>多个拦截器的先后顺序和注册顺序有关</p>
<p>请求的来回都会经过过滤器。</p>
<p>常用设置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] urlPatterns() default &#123;&#125;;</span><br><span class="line">DispatcherType[] dispatcherTypes() default &#123;DispatcherType.REQUEST&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="实现一个过滤器"><a href="#实现一个过滤器" class="headerlink" title="实现一个过滤器"></a>实现一个过滤器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"FirstFilter"</span>, urlPatterns = <span class="string">"/firstFilter.jsp"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"firstFilter...."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 放行</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>init</code> 函数中可以获取 filter 的相关配置</li>
</ol>
<h2 id="自动登入功能"><a href="#自动登入功能" class="headerlink" title="自动登入功能"></a>自动登入功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自动登入过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"FirstFilter"</span>, urlPatterns = <span class="string">"/index.jsp"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object user = ((HttpServletRequest) req).getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">            chain.doFilter(req, resp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cookie[] cookies = ((HttpServletRequest) req).getCookies();</span><br><span class="line">        Cookie auto_login = CookieUtils.findCookie(cookies, <span class="string">"auto_login"</span>);</span><br><span class="line">        <span class="keyword">if</span> (auto_login == <span class="keyword">null</span>) &#123;</span><br><span class="line">            chain.doFilter(req, resp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String value = auto_login.getValue();</span><br><span class="line">        String[] split = value.split(<span class="string">"#"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户登入已经过时 session 中数据失效</span></span><br><span class="line">        User o = <span class="keyword">new</span> User();</span><br><span class="line">        o.setUsername(split[<span class="number">0</span>]);</span><br><span class="line">        o.setPassword(split[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> UserDaoImpl().login(o)) &#123;</span><br><span class="line">                <span class="comment">// login success</span></span><br><span class="line">                ((HttpServletRequest) req).getSession().setAttribute(<span class="string">"user"</span>, o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            chain.doFilter(req, resp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BeanUtils"><a href="#BeanUtils" class="headerlink" title="BeanUtils"></a>BeanUtils</h3><p><code>commons-beanutils-1.9.3.jar</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanUtils.populate(user, request.getParameterMap());</span><br></pre></td></tr></table></figure>
<p>扩展支持类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ConvertUtils.register(<span class="keyword">new</span> Converter() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">convert</span><span class="params">(Class&lt;T&gt; aClass, Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, Date<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/21/Python/django/offical-doc/Django 报错记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/Python/django/offical-doc/Django 报错记录/" itemprop="url">Django 报错记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-21T13:18:12+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NoReverseMatch"><a href="#NoReverseMatch" class="headerlink" title="NoReverseMatch"></a>NoReverseMatch</h1><pre><code>Reverse for &apos;index&apos; with arguments &apos;()&apos; and keyword arguments &apos;{}&apos; not found. 0 pattern(s) tried: []
</code></pre><p>原因：URLconf 设置错误</p>
<p>错误例子：</p>
<pre><code>主urls.py中的
url(r&apos;^$&apos;, include(&apos;blog.urls&apos;)),
修改成
url(r&apos;^&apos;, include(&apos;blog.urls&apos;)),就可以了。
</code></pre><p>$判断字符串结束，所以后面的子url她没法解析了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/21/Python/django/offical-doc/Common Web application tools - Static files management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/Python/django/offical-doc/Common Web application tools - Static files management/" itemprop="url">Common Web application tools - Static files management</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-21T13:18:12+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>django.contrib.staticfiles</code> 收集所有的 app 的静态文件到一个地方，方便程序调用</p>
<h1 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h1><p><code>settings.py</code></p>
<ul>
<li>STATIC_ROOT:设置 collectstatic 将会收集静态文件地址的绝对路径地址</li>
<li><p>STATIC_URL:定义静态文件的 url</p>
<p>  Example: “/static/“ or “<a href="http://static.example.com/&quot;" target="_blank" rel="noopener">http://static.example.com/&quot;</a></p>
</li>
<li><p>STATICFILES_DIRS：</p>
</li>
</ul>
<pre><code>exa：

        STATICFILES_DIRS = [
        &quot;/home/special.polls.com/polls/static&quot;,
        &quot;/home/polls.com/polls/static&quot;,
        &quot;/opt/webfiles/common&quot;,
    ]
</code></pre><ul>
<li>STATICFILES_STORAGE</li>
<li>STATICFILES_FINDERS</li>
</ul>
<p>。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/18/program/SVN 使用记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/18/program/SVN 使用记录/" itemprop="url">SVN 使用记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-18T13:18:12+08:00">
                2016-11-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SVN-生命周期"><a href="#SVN-生命周期" class="headerlink" title="SVN  生命周期"></a>SVN  生命周期</h1><h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>版本库相当于一个集中的空间</p>
<h2 id="检出"><a href="#检出" class="headerlink" title="检出"></a>检出</h2><p>Checkout：操作从版本库创建一个工作副本。工作副本是正常开发的地方，修改后提交到版本库中。</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>update：操作从版本库中下载代码，将工作副本与版本库进行同步</p>
<h2 id="执行变更"><a href="#执行变更" class="headerlink" title="执行变更"></a>执行变更</h2><p>commit：提交，将工作副本中的代码提交到版本库中。</p>
<p>rename：操作，更改文件／目录的名字</p>
<h2 id="复查变化"><a href="#复查变化" class="headerlink" title="复查变化"></a>复查变化</h2><p>update，checkout，操作后工作副本就和版本库中的数据相同了。</p>
<p>status：操作，列出工作副本中所进行的变动，变动列表</p>
<p>diff：操作显示变动详细信息</p>
<h2 id="修复错误"><a href="#修复错误" class="headerlink" title="修复错误"></a>修复错误</h2><p>当工作副本中做了许多修改，但是不想要这个修改的时候，</p>
<p>revert：操作重置对工作副本的修改。可以重置部分修改</p>
<h2 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h2><p>合并的时候会发生冲突</p>
<p>merge：操作可以处理部分冲突，不能处理的冲突需要用户自己处理</p>
<p>resolver：操作可以找出需要用户解决的冲突</p>
<h2 id="提交更改"><a href="#提交更改" class="headerlink" title="提交更改"></a>提交更改</h2><p>commit：操作将工作副本的内容发送到版本库中</p>
<h1 id="SVN-启动模式"><a href="#SVN-启动模式" class="headerlink" title="SVN 启动模式"></a>SVN 启动模式</h1><p>默认端口：<code>3690</code></p>
<p>方式一：-r直接指定到版本库(称之为单库svnserve方式):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnserve -d -r /opt/svn/runoob</span><br></pre></td></tr></table></figure></p>
<p>方式二：指定到版本库的上级目录(称之为多库svnserve方式):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnserve -d -r /opt/svn</span><br></pre></td></tr></table></figure></p>
<p>多库启动 svn 的时候，当 svn 目录下有两个版本库：<code>runoob</code>,<code>runoob01</code></p>
<p>runoob01 svn 地址：<code>svn://192.168.0.1/runoob01</code></p>
<h1 id="Mac-下安装和使用"><a href="#Mac-下安装和使用" class="headerlink" title="Mac 下安装和使用"></a>Mac 下安装和使用</h1><h2 id="install-svn-server-服务器端"><a href="#install-svn-server-服务器端" class="headerlink" title="install svn server 服务器端"></a>install svn server 服务器端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew options subversion</span><br><span class="line">$ brew install (OPTIONS) subversion</span><br></pre></td></tr></table></figure>
<h2 id="创建版本库-1"><a href="#创建版本库-1" class="headerlink" title="创建版本库"></a>创建版本库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnadmin create /opt/svn/runoob01</span><br></pre></td></tr></table></figure>
<p>版本库配置文件位置:<code>/opt/svn/runoob01/conf</code>:</p>
<ol>
<li><p>svnserve.conf: svn 服务配置文件</p>
<p> 去掉下面的注释</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># anon-access = read</span><br><span class="line"># auth-access = write</span><br><span class="line"></span><br><span class="line"># password-db = passwd</span><br><span class="line"></span><br><span class="line"># authz-db = authz</span><br></pre></td></tr></table></figure>
<p> anon-access = read代表匿名访问的时候是只读的，若改为anon-access = none代表禁止匿名访问，需要帐号密码才能访问</p>
</li>
<li><p>passwd: 用户名口令</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#&lt;用户名&gt; = &lt;口令&gt;</span><br><span class="line"></span><br><span class="line">[users]</span><br><span class="line">fang = 123456</span><br><span class="line">fang02 = 123456</span><br></pre></td></tr></table></figure>
</li>
<li><p>authz: 权限配置文件 </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 定义组</span><br><span class="line">[groups]</span><br><span class="line">@g_admin = fang,fang02</span><br><span class="line"></span><br><span class="line"># [&lt;版本库名&gt;:&lt;路径&gt;]</span><br><span class="line">[runoob01:/]</span><br><span class="line">@g_admin=rw</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="mac-下-svn-的一些基本操作"><a href="#mac-下-svn-的一些基本操作" class="headerlink" title="mac 下 svn 的一些基本操作"></a>mac 下 svn 的一些基本操作</h2><h3 id="从本地导入代码到服务器-第一次初始化导入"><a href="#从本地导入代码到服务器-第一次初始化导入" class="headerlink" title="从本地导入代码到服务器(第一次初始化导入)"></a>从本地导入代码到服务器(第一次初始化导入)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn import /Users/apple/webSite svn://localhost/mycode/webSite --username=mj --password=123 -m &quot;初始化导入&quot;</span><br></pre></td></tr></table></figure>
<p>这种方法将本地文件上传到 svn 版本库中，本地文件不会和 svn 关联（之后不能使用 commit）</p>
<h3 id="从服务器端下载代码到客户端本地"><a href="#从服务器端下载代码到客户端本地" class="headerlink" title="从服务器端下载代码到客户端本地"></a>从服务器端下载代码到客户端本地</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn checkout svn://localhost/mycode --username=mj --password=123 /Users/apple/svnwebSite</span><br></pre></td></tr></table></figure>
<p>这种方法会将本地代码和版本库代码关联（之后修改后可以直接 commit）</p>
<h3 id="提交更改过的代码到服务器"><a href="#提交更改过的代码到服务器" class="headerlink" title="提交更改过的代码到服务器"></a>提交更改过的代码到服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn commit -m &quot;修改了webSite文件&quot;</span><br></pre></td></tr></table></figure>
<h3 id="更新服务器端的代码到客户端"><a href="#更新服务器端的代码到客户端" class="headerlink" title="更新服务器端的代码到客户端"></a>更新服务器端的代码到客户端</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn update</span><br></pre></td></tr></table></figure>
<h1 id="svn-add"><a href="#svn-add" class="headerlink" title="svn add ."></a>svn add .</h1><p><a href="http://tiankonguse.com/record/record.php?id=690" target="_blank" rel="noopener">http://tiankonguse.com/record/record.php?id=690</a></p>
<pre><code>svn: warning: W150002: &apos;目录路径&apos; is already under version control
svn: E200009: Could not add all targets because some targets are already versioned
svn: E200009: Illegal target for the requested operation
</code></pre><p>解决方案：</p>
<pre><code>svn add 目录名 --force
</code></pre><h1 id="svn-commit-m’…-’"><a href="#svn-commit-m’…-’" class="headerlink" title="svn commit -m’…..’"></a>svn commit -m’…..’</h1><h1 id="删除文件夹后点commit提交，但是报错，报错内容如下："><a href="#删除文件夹后点commit提交，但是报错，报错内容如下：" class="headerlink" title="删除文件夹后点commit提交，但是报错，报错内容如下："></a>删除文件夹后点commit提交，但是报错，报错内容如下：</h1><p>提示 “svn: Commit failed (details follow): svn: <code>&#39;/***/xxx.c&#39; is scheduled for addition, but is missing &quot;</code></p>
<p>原因：之前用SVN提交过的文件，被标记为”add”状态，等待被加入到仓库。若此时你把这个文件删除了，SVN提交的时候还是会尝试提交这个文件，虽然它的状态已经是 “missing”了。</p>
<p>解决：</p>
<pre><code>svn revert xxx.c --depth infinity
</code></pre><p>参考：</p>
<p><a href="https://cnbin.github.io/blog/2015/06/13/mac-da-jian-svn-fu-wu-qi-huan-jing/" target="_blank" rel="noopener">https://cnbin.github.io/blog/2015/06/13/mac-da-jian-svn-fu-wu-qi-huan-jing/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/17/Android/debug/Debug -- Databases And Shared Preferences/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/17/Android/debug/Debug -- Databases And Shared Preferences/" itemprop="url">Debug -- Databases And Shared Preferences</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T13:18:12+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>添加下面的依赖：（版本可能需要更新了）</p>
<pre><code>debugCompile &apos;com.amitshekhar.android:debug-db:0.1.0&apos;
</code></pre><p>运行 App 后在log中会看到：</p>
<pre><code>D/DebugDB: Open http://XXX.XXX.X.XXX:8080 in your browser
</code></pre><p>在游览器中打开这个地址就可以了。</p>
<p>原文链接：<a href="https://medium.com/@amitshekhar/debugging-android-databases-and-shared-preferences-in-the-easiest-way-e5f705dfc06b#.bgorqpgg5" target="_blank" rel="noopener">Android debug Databalses And Shared Preferences</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/Android/触摸事件/ViewDragHelper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/Android/触摸事件/ViewDragHelper/" itemprop="url">ViewDragHelper</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-16T13:18:12+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>用于分析手势处理的类,一般用在一个自定义 ViewGroup 的内部</p>
<p>ViewDragHelper.Callback 是连接 ViewDragHelper 与 view 之间的桥梁（这个 view 一般是指拥子 view 的容器即 parentView）；</p>
<p>   ViewDragHelper的实例是创建的；</p>
<p>   ViewDragHelper 并不是直接作用于要被拖动的View，而是使其控制的视图容器中的子 View 可以被拖动，如果要指定某个子 view 的行为，需要在 Callback 中想办法；</p>
<p>   ViewDragHelper 的本质其实是分析 onInterceptTouchEvent 和onTouchEvent 的 MotionEvent 参数，然后根据分析的结果去改变一个容器中被拖动子 View 的位置（ 通过 offsetTopAndBottom(int offset)和offsetLeftAndRight(int offset)方法 ），他能在触摸的时候判断当前拖动的是哪个子 View；</p>
<h1 id="ViewDragHelper-类"><a href="#ViewDragHelper-类" class="headerlink" title="ViewDragHelper 类"></a>ViewDragHelper 类</h1><p>创建 ViewDragHelper 对象的方法：（通过静态工厂方法）</p>
<pre><code>public static ViewDragHelper create(ViewGroup forParent, Callback cb)

public static ViewDragHelper create(ViewGroup forParent, float sensitivity, Callback cb)
</code></pre><p>参数：</p>
<ol>
<li>ViewGroup：ViewDragHelper 作用于的控件组</li>
<li>sensitivity：灵敏度，最大越灵敏 1.0f为正常值</li>
<li>Callback: 事件回调的接口</li>
</ol>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="创建-ViewDragHelper"><a href="#创建-ViewDragHelper" class="headerlink" title="创建 ViewDragHelper"></a>创建 ViewDragHelper</h2><h2 id="让-ViewDragHelper-接管-ViewGroup-的触摸事件"><a href="#让-ViewDragHelper-接管-ViewGroup-的触摸事件" class="headerlink" title="让 ViewDragHelper 接管 ViewGroup 的触摸事件"></a>让 ViewDragHelper 接管 ViewGroup 的触摸事件</h2><pre><code>@Override
public boolean onInterceptTouchEvent(MotionEvent ev) {
  final int action = MotionEventCompat.getActionMasked(ev);
  if (action == MotionEvent.ACTION_CANCEL || action == MotionEvent.ACTION_UP) {
      mDragHelper.cancel();
      return false;
  }
  return mDragHelper.shouldInterceptTouchEvent(ev);
}
@Override
public boolean onTouchEvent(MotionEvent ev) {
  mDragHelper.processTouchEvent(ev);
  return true;
}
</code></pre><p>然后就可以在回调中处理事件了</p>
<h2 id="触摸事件处理"><a href="#触摸事件处理" class="headerlink" title="触摸事件处理"></a>触摸事件处理</h2><h3 id="拖动行为的处理"><a href="#拖动行为的处理" class="headerlink" title="拖动行为的处理"></a>拖动行为的处理</h3><h4 id="处理横向的拖动"><a href="#处理横向的拖动" class="headerlink" title="处理横向的拖动"></a>处理横向的拖动</h4><p>在 Callback 中实现下面的方法：</p>
<pre><code>@Override
public int clampViewPositionHorizontal(View child, int left, int dx) {
  Log.d(&quot;DragLayout&quot;, &quot;clampViewPositionHorizontal &quot; + left + &quot;,&quot; + dx);
  final int leftBound = getPaddingLeft();
  final int rightBound = getWidth() - mDragView.getWidth();
  // 为了让被拖动的view遇到边界之后就不在拖动，对返回的值做了更多的考虑。
  final int newLeft = Math.min(Math.max(left, leftBound), rightBound);
  return newLeft;
  // return left; //就能实现移动
}
</code></pre><p>参数：</p>
<ol>
<li>View：表示当前触摸作用于的子 View</li>
<li>left：当前子 View 的 x 坐标</li>
<li>dx: 触摸点在 x 轴上做出的移动距离</li>
</ol>
<p>返回值：表示子 View 新的 x 坐标</p>
<h4 id="处理纵向的拖动"><a href="#处理纵向的拖动" class="headerlink" title="处理纵向的拖动"></a>处理纵向的拖动</h4><pre><code>@Override
public int clampViewPositionVertical(View child, int top, int dy) {
  final int topBound = getPaddingTop();
  final int bottomBound = getHeight() - mDragView.getHeight();
  final int newTop = Math.min(Math.max(top, topBound), bottomBound);
  return newTop;
}
</code></pre><h2 id="滑动边缘"><a href="#滑动边缘" class="headerlink" title="滑动边缘"></a>滑动边缘</h2><p>滑动边缘： EDGE_LEFT ,EDGE_TOP, EDGE_RIGHT, EDGE_BOTTOM</p>
<p>设置边缘：</p>
<pre><code>mDragHelper.setEdgeTrackingEnabled(ViewDragHelper.EDGE_LEFT);
</code></pre><p>实现方法 Callback：</p>
<pre><code>@Override
public void onEdgeTouched(int edgeFlags, int pointerId) {
    super.onEdgeTouched(edgeFlags, pointerId);
    Toast.makeText(getContext(), &quot;edgeTouched&quot;, Toast.LENGTH_SHORT).show();
}
</code></pre><p>如果你想在边缘滑动的时候根据滑动距离移动一个子view，可以通过实现onEdgeDragStarted方法，并在onEdgeDragStarted方法中手动指定要移动的子View:</p>
<pre><code>@Override
public void onEdgeDragStarted(int edgeFlags, int pointerId) {
    mDragHelper.captureChildView(mDragView2, pointerId);
}
</code></pre><p>参数：</p>
<ol>
<li>edgeFlags：滑动的边缘</li>
<li>pointerId：本次触摸事件的ID</li>
</ol>
<h2 id="加速度检测"><a href="#加速度检测" class="headerlink" title="加速度检测"></a>加速度检测</h2><h2 id="回调Drag-Release"><a href="#回调Drag-Release" class="headerlink" title="回调Drag Release"></a>回调Drag Release</h2><p>Callback: 手指抬起回调</p>
<pre><code>@Override
public void onViewReleased(View releasedChild, float xvel, float yvel) {
    //...
}
</code></pre><h3 id="实现-View-返回动画"><a href="#实现-View-返回动画" class="headerlink" title="实现 View 返回动画"></a>实现 View 返回动画</h3><p>Callback：</p>
<pre><code>@Override
public void onViewReleased(View releasedChild, float xvel, float yvel) {

    //mAutoBackView手指释放时可以自动回去
    if (releasedChild == mAutoBackView) {
        mViewDragHelper.settleCapturedViewAt(mAutoBackOriginPos.x, mAutoBackOriginPos.y);
        invalidate();
    }
}
</code></pre><p>CustomView：</p>
<pre><code>@Override
public void computeScroll()
{
    if(mViewDragHelper.continueSettling(true))
    {
        invalidate();
    }
}
</code></pre><p>View 滑动返回动画内部使用的是： mScroller.startScroll。</p>
<h2 id="移动到某个指定的位置"><a href="#移动到某个指定的位置" class="headerlink" title="移动到某个指定的位置"></a>移动到某个指定的位置</h2><pre><code>mViewDragHelper.settleCapturedViewAt(mAutoBackOriginPos.x, mAutoBackOriginPos.y);
</code></pre><h2 id="设置触摸处理的开关"><a href="#设置触摸处理的开关" class="headerlink" title="设置触摸处理的开关"></a>设置触摸处理的开关</h2><blockquote>
<p>这种方法也可以用于滑动冲突的解决</p>
</blockquote>
<p>在自定义 View 中自定义一个方法：</p>
<pre><code>public void setDragAble(boolean b) {
    mDragAble = b;
//        if (b) {
//
//        } else {
//            mViewDragHelper.abort();
//        }
}
</code></pre><p>在 Callback 中：</p>
<pre><code>@Override
public boolean tryCaptureView(View child, int pointerId) {
    //.....
    return mDragAble;
}
</code></pre><p>参考：</p>
<ul>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/0911/1680.html" target="_blank" rel="noopener">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/0911/1680.html</a></li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/46858663" target="_blank" rel="noopener">http://blog.csdn.net/lmj623565791/article/details/46858663</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/16/Android/触摸事件/触摸事件冲突处理方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/16/Android/触摸事件/触摸事件冲突处理方法/" itemprop="url">触摸事件冲突处理方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-16T13:18:12+08:00">
                2016-11-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="情景一：-父控件拦截了子控件的触摸"><a href="#情景一：-父控件拦截了子控件的触摸" class="headerlink" title="情景一： 父控件拦截了子控件的触摸"></a>情景一： 父控件拦截了子控件的触摸</h1><p>希望父控件不要拦截子控件的触摸事件，即让子控件处理触摸事件</p>
<p>方式一：</p>
<pre><code>// 表示父控件不拦截 子 View 的触摸事件
viewGroup.requestDisallowInterceptTouchEvent(true);
</code></pre><h1 id="情景二：子控件处理的触摸事件"><a href="#情景二：子控件处理的触摸事件" class="headerlink" title="情景二：子控件处理的触摸事件"></a>情景二：子控件处理的触摸事件</h1><p>需要：子控件处理部分的触摸事件</p>
<p>自定义 ViewGroup，继承指定的 ViewGroup，重写下面的方法，让父控件在合适的时候拦截触摸事件</p>
<pre><code>public boolean onInterceptTouchEvent(MotionEvent ev) {

    boolean ret = false;

    //....逻辑处理，如果返回 true 表示拦截子View的触摸事件，false 表示不拦截子View的触摸事件
    return ret;
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/29/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/31/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/head1.jpg" alt="Double">
          <p class="site-author-name" itemprop="name">Double</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">548</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">260</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Double</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
