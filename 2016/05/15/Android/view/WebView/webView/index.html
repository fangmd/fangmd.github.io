<!doctype html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="WebView,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="Modern WebView Best Practices Android Dev Summit 2018 关于 WebView 部分  A breif WebView history WebView 在 API 1 就加入了 在 Andreoid Lollipop 版本的时候，重新实现了 Api: 修复 bug 和一些安全问题 添加了 40+ 个新的 APIs  WebView 的 API 在">
<meta name="keywords" content="WebView">
<meta property="og:type" content="article">
<meta property="og:title" content="WebView">
<meta property="og:url" content="http://yoursite.com/2016/05/15/Android/view/WebView/webView/index.html">
<meta property="og:site_name" content="Double">
<meta property="og:description" content="Modern WebView Best Practices Android Dev Summit 2018 关于 WebView 部分  A breif WebView history WebView 在 API 1 就加入了 在 Andreoid Lollipop 版本的时候，重新实现了 Api: 修复 bug 和一些安全问题 添加了 40+ 个新的 APIs  WebView 的 API 在">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-08-12T14:50:57.278Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebView">
<meta name="twitter:description" content="Modern WebView Best Practices Android Dev Summit 2018 关于 WebView 部分  A breif WebView history WebView 在 API 1 就加入了 在 Andreoid Lollipop 版本的时候，重新实现了 Api: 修复 bug 和一些安全问题 添加了 40+ 个新的 APIs  WebView 的 API 在">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/05/15/Android/view/WebView/webView/">





  <title>WebView | Double</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Double</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/15/Android/view/WebView/webView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Double">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/head1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Double">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WebView</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-15T11:38:14+08:00">
                2016-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Modern-WebView-Best-Practices"><a href="#Modern-WebView-Best-Practices" class="headerlink" title="Modern WebView Best Practices"></a>Modern WebView Best Practices</h1><blockquote>
<p>Android Dev Summit 2018 关于 WebView 部分</p>
</blockquote>
<h2 id="A-breif-WebView-history"><a href="#A-breif-WebView-history" class="headerlink" title="A breif WebView history"></a>A breif WebView history</h2><ol>
<li>WebView 在 API 1 就加入了</li>
<li>在 Andreoid Lollipop 版本的时候，重新实现了 Api: 修复 bug 和一些安全问题</li>
<li>添加了 40+ 个新的 APIs</li>
</ol>
<p>WebView 的 API 在 Lollipop 版本后有了比较大的更新，但是很多应用并没有去使用新的特性，包括 Stachoverflow 上的一些回答都是过时的，接口文档也是过时的。</p>
<h2 id="关于版本兼容问题"><a href="#关于版本兼容问题" class="headerlink" title="关于版本兼容问题"></a>关于版本兼容问题</h2><p>WebView 在 Lollipop 上实现的新 Api 无法在低版本设备中运行。</p>
<p><strong>AndroidX</strong></p>
<ul>
<li>AndroidX brings new Apis to old devices<ul>
<li>Leverages WebView`s update cycle on L+</li>
</ul>
</li>
<li>AndroidX APIs are simple to use<ul>
<li>easy to swap out Framework APIs</li>
</ul>
</li>
</ul>
<h2 id="如何使用-AndroidX"><a href="#如何使用-AndroidX" class="headerlink" title="如何使用 AndroidX"></a>如何使用 AndroidX</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(new WebViewClientCompat()&#123;</span><br><span class="line"></span><br><span class="line">    // 支持 Lollipop+ 设备（低版本设备中也能运行）</span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) &#123;</span><br><span class="line">        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">            if (!request.hasGesture()) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return super.shouldOverrideUrlLoading(view, request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // @Deprecated 支持 Lollipop 之前的设备</span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line"></span><br><span class="line">        return super.shouldOverrideUrlLoading(view, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Loading-in-app-content"><a href="#Loading-in-app-content" class="headerlink" title="Loading in-app content"></a>Loading in-app content</h2><p>app 加载离线的 html。</p>
<p>通常我们会使用 <code>WebView#loadData()</code> 但是这会导致一些问题。</p>
<p>避免编码问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loadData(encodedHtml, mimeType, &quot;base64&quot;)</span><br><span class="line"></span><br><span class="line">encodedHtml = Base64.encodeToString(unencodedHtml.getBytes(), Base64.No_PADDING);</span><br></pre></td></tr></table></figure>
<p>避免 same-origin restrictions 使用 <code>loadDataWithBaseURL</code></p>
<p><a href="https://www.youtube.com/watch?v=HGZYtDZhOEQ&amp;list=PLWz5rJ2EKKc8WFYCR9esqGGY0vOZm2l6e&amp;index=29" target="_blank" rel="noopener">Modern WebView Best Practices (Android Dev Summit ‘18)</a></p>
<h1 id="WebView-属性的设置"><a href="#WebView-属性的设置" class="headerlink" title="WebView 属性的设置"></a>WebView 属性的设置</h1><h2 id="通过-WebSettings-设置"><a href="#通过-WebSettings-设置" class="headerlink" title="通过 WebSettings 设置"></a>通过 <code>WebSettings</code> 设置</h2><a id="more"></a>
<pre><code>// 支持获取手势焦点，输入用户名、密码或其他
webview.requestFocusFromTouch();
setNeedInitialFocus(true); //当webview调用requestFocus时为webview设置节点
setLoadsImagesAutomatically(true);  //支持自动加载图片
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">WebSettings webSettings = mWebView.getSettings();</span><br><span class="line"></span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="keyword">true</span>);  <span class="comment">// 是否允许js脚本运行</span></span><br><span class="line"></span><br><span class="line">webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">true</span>); <span class="comment">//支持通过JS打开新窗口</span></span><br><span class="line"></span><br><span class="line">webSettings.setPluginsEnabled(<span class="keyword">true</span>);  <span class="comment">//支持插件</span></span><br><span class="line"></span><br><span class="line">webSettings.setDefaultTextEncodingName(<span class="string">"utf-8"</span>);<span class="comment">//设置编码格式</span></span><br><span class="line"></span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_DEFAULT); <span class="comment">// 设置缓存模式， 关闭webview中缓存：WebSettings.LOAD_CACHE_ELSE_NETWORK </span></span><br><span class="line"></span><br><span class="line">webSettings.setDomStorageEnabled(<span class="keyword">true</span>); </span><br><span class="line"></span><br><span class="line">webSettings.setDatabaseEnabled(<span class="keyword">true</span>); <span class="comment">// 是否允许使用数据库api</span></span><br><span class="line"></span><br><span class="line">webSettings.setAppCacheEnabled(<span class="keyword">true</span>); <span class="comment">// 设置H5的缓存是否打开，默认关闭。</span></span><br><span class="line"></span><br><span class="line">webSettings.setAllowFileAccess(<span class="keyword">true</span>); <span class="comment">// 是否可以进行文件操作</span></span><br><span class="line"></span><br><span class="line">webSettings.setSavePassword(<span class="keyword">true</span>); <span class="comment">// 是否密码保存</span></span><br><span class="line"></span><br><span class="line">webSettings.setSupportZoom(<span class="keyword">true</span>); <span class="comment">//页面是否支持放大和缩小</span></span><br><span class="line"></span><br><span class="line">webSettings.setDisplayZoomControls(<span class="keyword">false</span>); <span class="comment">//隐藏原生的缩放控件</span></span><br><span class="line"></span><br><span class="line">webSettings.supportMultipleWindows();  <span class="comment">//多窗口 </span></span><br><span class="line"></span><br><span class="line">webSettings.setBuiltInZoomControls(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">webSettings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.NARROW_COLUMNS); <span class="comment">// 1、LayoutAlgorithm.NARROW_COLUMNS ：适应内容大小  2、LayoutAlgorithm.SINGLE_COLUMN : 适应屏幕，内容将自动缩放</span></span><br><span class="line"></span><br><span class="line">webSettings.setUseWideViewPort(<span class="keyword">true</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">//设置自适应屏幕，两者合用</span></span><br><span class="line">webSettings.setUseWideViewPort(<span class="keyword">true</span>);  <span class="comment">//将图片调整到适合webview的大小 </span></span><br><span class="line">webSettings.setLoadWithOverviewMode(<span class="keyword">true</span>); <span class="comment">// 缩放至屏幕的大小</span></span><br><span class="line"><span class="comment">//若上面是false，则该WebView不可缩放，这个不管设置什么都不能缩放。</span></span><br><span class="line"></span><br><span class="line">mWebView.setScrollBarStyle(WebView.SCROLLBARS_OUTSIDE_OVERLAY);</span><br><span class="line"></span><br><span class="line">mWebView.setHorizontalScrollbarOverlay(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">mWebView.setHorizontalScrollBarEnabled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">mWebView.requestFocus();</span><br></pre></td></tr></table></figure>
<h2 id="设置WebViewClient子类"><a href="#设置WebViewClient子类" class="headerlink" title="设置WebViewClient子类"></a>设置WebViewClient子类</h2><blockquote>
<p>WebViewClient 会在一些影响内容渲染的动作发生时被调用，比如表单的错误提交需要重新提交、页面开始加载及加载完成、资源加载中、接收到https认证需要处理、页面键盘响应、页面中的url打开处理等等</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(<span class="keyword">new</span> MyWebViewClient());</span><br></pre></td></tr></table></figure>
<h3 id="设置当前网页的链接仍在-WebView-中跳转，而不是跳到手机浏览器里显示"><a href="#设置当前网页的链接仍在-WebView-中跳转，而不是跳到手机浏览器里显示" class="headerlink" title="设置当前网页的链接仍在 WebView 中跳转，而不是跳到手机浏览器里显示"></a>设置当前网页的链接仍在 WebView 中跳转，而不是跳到手机浏览器里显示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">    view.loadUrl(url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>@return True if the host application wants to leave the current WebView and handle the url itself, otherwise return false.</p>
</blockquote>
<h3 id="设置开始加载网页、加载完成、加载错误时处理"><a href="#设置开始加载网页、加载完成、加载错误时处理" class="headerlink" title="设置开始加载网页、加载完成、加载错误时处理"></a>设置开始加载网页、加载完成、加载错误时处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView webView, String s, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onPageStarted(webView, s, bitmap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DialogManager.showLoadingDialog(this);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView webView, String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onPageFinished(webView, s);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 网页加载完成时处理  如：让 加载对话框 消失</span></span><br><span class="line">    <span class="comment">// DialogManager.dismissLoadingDialog();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView webView, <span class="keyword">int</span> i, String s, String s1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onReceivedError(webView, i, s, s1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载网页失败时处理  如：</span></span><br><span class="line">    webView.loadDataWithBaseURL(<span class="keyword">null</span>,<span class="string">"&lt;span style=\"\"color:#FF0000\"\"&gt;网页加载失败&lt;/span&gt;"</span>, <span class="string">"text/html"</span>, <span class="string">"utf-8"</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="WebView-在Android4-4的手机上onPageFinished-回调会多调用一次"><a href="#WebView-在Android4-4的手机上onPageFinished-回调会多调用一次" class="headerlink" title="WebView 在Android4.4的手机上onPageFinished()回调会多调用一次"></a>WebView 在Android4.4的手机上onPageFinished()回调会多调用一次</h4><p>需要尽量避免在onPageFinished()中做业务操作，否则会导致重复调用，还有可能会引起逻辑上的错误.</p>
<h3 id="处理https请求，为WebView处理ssl证书设置"><a href="#处理https请求，为WebView处理ssl证书设置" class="headerlink" title="处理https请求，为WebView处理ssl证书设置"></a>处理https请求，为WebView处理ssl证书设置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView webView, SslErrorHandler sslErrorHandler, SslError sslError)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="前进-后退"><a href="#前进-后退" class="headerlink" title="前进 后退"></a>前进 后退</h1><p>相关方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">goBack()<span class="comment">//后退</span></span><br><span class="line">goForward()<span class="comment">//前进</span></span><br><span class="line">goBackOrForward(intsteps) <span class="comment">//以当前的index为起始点前进或者后退到历史记录中指定的steps， 如果steps为负数则为后退，正数则为前进</span></span><br><span class="line"></span><br><span class="line">canGoForward()<span class="comment">//是否可以前进</span></span><br><span class="line">canGoBack() <span class="comment">//是否可以后退</span></span><br></pre></td></tr></table></figure></p>
<h2 id="实现方法一"><a href="#实现方法一" class="headerlink" title="实现方法一"></a>实现方法一</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mWV.setOnKeyListener(<span class="keyword">new</span> View.OnKeyListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(View v, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event.getAction() == KeyEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; mWV.canGoBack()) &#123;  <span class="comment">//表示按返回键</span></span><br><span class="line">                mWV.goBack();   <span class="comment">//后退</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;    <span class="comment">//已处理</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="实现方法二"><a href="#实现方法二" class="headerlink" title="实现方法二"></a>实现方法二</h2><p>Avtivity 层处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;       </span><br><span class="line">    <span class="keyword">if</span> ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; mWebView.canGoBack()) &#123;       </span><br><span class="line">    mWebView.goBack();       </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;       </span><br><span class="line">    &#125;       </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="WebView-与-js-交互"><a href="#WebView-与-js-交互" class="headerlink" title="WebView 与 js 交互"></a>WebView 与 js 交互</h1><h2 id="使用-addJavascriptInterface-完成和-js-交互"><a href="#使用-addJavascriptInterface-完成和-js-交互" class="headerlink" title="使用 addJavascriptInterface 完成和 js 交互"></a>使用 addJavascriptInterface 完成和 js 交互</h2><blockquote>
<p>使 Js 调用 Native 本地 Java 对象,实现本地 Java 代码和 HTML 页面进行交互，<br>注意: 因为安全问题的考虑 Google 在使用 Android API 17以上的版本的时候 需要通过 @JavascriptInterface 来注解的 Java 函数才能被识别可以被 Js 调用。</p>
</blockquote>
<h3 id="Js-中调-Native-本地-Java-方法"><a href="#Js-中调-Native-本地-Java-方法" class="headerlink" title="Js 中调 Native 本地 Java 方法"></a>Js 中调 Native 本地 Java 方法</h3><p>设置webView的addJavascriptInterface方法，该方法有两个参数，第一个参数为被绑定到js中的类实例，第二个参数为在js中暴露的类别名，在js中引用java对象就是用这个名字：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mWebView.addJavascriptInterface(<span class="keyword">new</span> JavaScriptInterface(<span class="keyword">this</span>), <span class="string">"Android"</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JavaScriptInterface</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Instantiate the interface and set the context */</span></span><br><span class="line">    JavaScriptInterface(Context c) &#123;</span><br><span class="line">        mContext = c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *Show a toast from the web page </span></span><br><span class="line"><span class="comment">    *由Js调用执行Native本地Java方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String toast)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"TAG"</span>,<span class="string">"Js Invoker Native Function"</span>);</span><br><span class="line">        Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在HTML中Js调用Native方法 代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag"> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Say hello"</span> <span class="attr">onclick</span>=<span class="string">"showAndroidToast('Hello Android!')"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">showAndroidToast</span>(<span class="params">toast</span>) </span>&#123;</span></span><br><span class="line">        Android.showToast(toast);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Java调Js方法"><a href="#Java调Js方法" class="headerlink" title="Java调Js方法"></a>Java调Js方法</h3><p>比如在HTML中有如下Js函数:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">showAlert</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">"Be executed by Native"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在Native调Js方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.loadUrl(<span class="string">"javascript：showAlert()"</span>);</span><br></pre></td></tr></table></figure></p>
<h1 id="WebView-缓存模式的设置"><a href="#WebView-缓存模式的设置" class="headerlink" title="WebView 缓存模式的设置"></a>WebView 缓存模式的设置</h1><h2 id="网页数据缓存"><a href="#网页数据缓存" class="headerlink" title="网页数据缓存"></a>网页数据缓存</h2><p>当使用 WebView 加载 HTML 网页时，会在我们data/应用package下生成database与cache两个文件夹: 我们请求的Url记录是保存在webviewCache.db里，而url的内容是保存在webviewCache文件夹下.</p>
<p>五种缓存模式：</p>
<ol>
<li>LOAD_CACHE_ONLY：不使用网络，只读取本地缓存数据</li>
<li>LOAD_DEFAULT：根据cache-control决定是否从网络上取数据</li>
<li>LOAD_CACHE_NORMAL：API level 17中已经废弃, 从API level 11开始作用同LOAD_DEFAULT模式</li>
<li>LOAD_NO_CACHE：不使用缓存，只从网络获取数据</li>
<li>LOAD_CACHE_ELSE_NETWORK：只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置 缓存模式  </span></span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_DEFAULT); </span><br><span class="line"><span class="comment">// 开启 DOM storage API 功能  </span></span><br><span class="line">webSettings.setDomStorageEnabled(<span class="keyword">true</span>); </span><br><span class="line"><span class="comment">//开启 database storage API 功能  </span></span><br><span class="line">webSettings.setDatabaseEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<h2 id="H5缓存"><a href="#H5缓存" class="headerlink" title="H5缓存"></a>H5缓存</h2><ul>
<li>通过<code>setAppCacheEnabled(boolean flag)</code>设置H5的缓存是否打开，默认关闭。</li>
<li>根据<code>setAppCachePath(String appCachePath)</code>提供的路径，在H5使用缓存过程中生成的缓存文件。</li>
<li>通过<code>setAppCacheMaxSize(long appCacheMaxSize)</code>设置缓存最大容量。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">String cacheDirPath = getCacheDir().getAbsolutePath()+ <span class="string">"/webViewCache"</span>;</span><br><span class="line">WebSettings webSettings = mWebView.getSettings();</span><br><span class="line"><span class="comment">//开启 database storage API 功能  </span></span><br><span class="line">webSettings.setDatabaseEnabled(<span class="keyword">true</span>);   </span><br><span class="line"><span class="comment">//设置数据库缓存路径 </span></span><br><span class="line">webSettings.setDatabasePath(cacheDirPath);</span><br><span class="line"><span class="comment">//开启Application H5 Caches 功能  </span></span><br><span class="line">webSettings.setAppCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//设置Application Caches 缓存目录  </span></span><br><span class="line">webSettings.setAppCachePath(cacheDirPath);</span><br></pre></td></tr></table></figure>
<h1 id="加快HTML网页加载完成速度"><a href="#加快HTML网页加载完成速度" class="headerlink" title="加快HTML网页加载完成速度"></a>加快HTML网页加载完成速度</h1><p>默认情况html代码下载到WebView后，webkit开始解析网页各个节点，发现有外部样式文件或者外部脚本文件时，会异步发起网络请求下载文件，但如果在这之前也有解析到image节点，那势必也会发起网络请求下载相应的图片。在网络情况较差的情况下，过多的网络请求就会造成带宽紧张，影响到css或js文件加载完成的时间，造成页面空白loading过久。解决的方法就是告诉WebView先不要自动加载图片，等页面finish后再发起图片加载。</p>
<p>初始化 WebView 的时候: 禁止自动加载图片，等页面加载成功后再开始加载图片<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">19</span>) &#123;</span><br><span class="line">    mWV.getSettings().setLoadsImagesAutomatically(<span class="keyword">true</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mWV.getSettings().setLoadsImagesAutomatically(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重写 <code>onPageFinished()</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView webView, String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onPageFinished(webView, s);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 网页加载完成时处理  如：让 加载对话框 消失</span></span><br><span class="line">    <span class="comment">// DialogManager.dismissLoadingDialog();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 优化 html 加载</span></span><br><span class="line">    <span class="keyword">if</span> (!webView.getSettings().getLoadsImagesAutomatically()) &#123;</span><br><span class="line">        webView.getSettings().setLoadsImagesAutomatically(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>从上面的代码，可以看出我们对系统API在19以上的版本作了兼容。因为4.4以上系统在onPageFinished时再恢复图片加载时,如果存在多张图片引用的是相同的src时，会只有一个image标签得到加载，因而对于这样的系统我们就先直接加载。</p>
</blockquote>
<h1 id="WebView-硬件加速导致页面渲染闪烁问题解决方法"><a href="#WebView-硬件加速导致页面渲染闪烁问题解决方法" class="headerlink" title="WebView 硬件加速导致页面渲染闪烁问题解决方法"></a>WebView 硬件加速导致页面渲染闪烁问题解决方法</h1><p>关于Android硬件加速 开始于Android 3.0 (API level 11),在四个级别上开启/关闭硬件加速</p>
<ol>
<li>Application级别：为整个应用程序开启硬件加速，在AndroidManifest中加入如下配置</li>
<li>Activity级别：控制每个activity是否开启硬件加速，只需在activity元素中添加android:hardwareAccelerated属性即可</li>
<li><p>Window级别：注：目前还不支持在Window级别上关闭硬件加速</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setFlags(</span><br><span class="line">    WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED，</span><br><span class="line">    WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED);</span><br></pre></td></tr></table></figure>
</li>
<li><p>View级别：运行时单个view硬件加速，目前Android还不支持在View级别开启硬件加速 代码如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mView.setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>我们开启硬件加速后，WebView渲染页面更加快速，拖动也更加顺滑。但有个副作用就是容易会出现页面加载白块同时界面闪烁现象。解决这个问题的方法是设置WebView暂时关闭硬件加速 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">    webview.setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="为WebView自定义错误显示界面"><a href="#为WebView自定义错误显示界面" class="headerlink" title="为WebView自定义错误显示界面"></a>为WebView自定义错误显示界面</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示自定义错误提示页面，用一个View覆盖在WebView </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">showErrorPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinearLayout webParentView = (LinearLayout) mWebView.getParent();</span><br><span class="line"></span><br><span class="line">    initErrorPage();</span><br><span class="line">    <span class="keyword">while</span> (webParentView.getChildCount() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        webParentView.removeViewAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    LinearLayout.LayoutParams lp = <span class="keyword">new</span> LinearLayout.LayoutParams(LinearLayout.LayoutParams.FILL_PARENT, LinearLayout.LayoutParams.FILL_PARENT);</span><br><span class="line">    webParentView.addView(mErrorView, <span class="number">0</span>, lp);</span><br><span class="line">    mIsErrorPage = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">hideErrorPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinearLayout webParentView = (LinearLayout) mWebView.getParent();</span><br><span class="line"></span><br><span class="line">    mIsErrorPage = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (webParentView.getChildCount() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        webParentView.removeViewAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initErrorPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mErrorView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mErrorView = View.inflate(<span class="keyword">this</span>, R.layout.online_error, <span class="keyword">null</span>);</span><br><span class="line">        Button button = (Button) mErrorView.findViewById(R.id.online_error_btn_retry);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                mWebView.reload();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mErrorView.setOnClickListener(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="WebView-cookies清理："><a href="#WebView-cookies清理：" class="headerlink" title="WebView cookies清理："></a>WebView cookies清理：</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CookieSyncManager.createInstance(<span class="keyword">this</span>);   </span><br><span class="line">CookieSyncManager.getInstance().startSync();   </span><br><span class="line">CookieManager.getInstance().removeSessionCookie();</span><br></pre></td></tr></table></figure>
<h1 id="清理cache-和历史记录"><a href="#清理cache-和历史记录" class="headerlink" title="清理cache 和历史记录"></a>清理cache 和历史记录</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">webView.clearCache(<span class="keyword">true</span>); <span class="comment">//清除网页访问留下的缓存，由于内核缓存是全局的因此这个方法不仅仅针对webview而是针对整个应用程序.</span></span><br><span class="line">webView.clearHistory();  <span class="comment">//清除当前webview访问的历史记录，只会webview访问历史记录里的所有记录除了当前访问记录.</span></span><br><span class="line">webView.clearFormData()<span class="comment">//这个api仅仅清除自动完成填充的表单数据，并不会清除WebView存储到本地的数据。</span></span><br><span class="line">``</span><br><span class="line"></span><br><span class="line"># 判断WebView是否已经滚动到页面底端</span><br><span class="line"></span><br><span class="line">- getScrollY()方法返回的是当前可见区域的顶端距整个页面顶端的距离,也就是当前内容滚动的距离.   </span><br><span class="line">- getHeight()或者getBottom()方法都返回当前WebView 这个容器的高度   </span><br><span class="line">- getContentHeight 返回的是整个html 的高度,但并不等同于当前整个页面的高度,因为WebView 有缩放功能, 所以当前整个页面的高度实际上应该是原始html 的高度再乘上缩放比例. </span><br><span class="line"></span><br><span class="line">*准确方法：*</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">    <span class="keyword">if</span> (webView.getContentHeight() * webView.getScale() == (webView.getHeight() + webView.getScrollY())) &#123;</span><br><span class="line">        <span class="comment">//已经处于底端</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(webView.getScrollY() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//处于顶端</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="屏蔽掉长按事件-因为webview长按时将会调用系统的复制控件"><a href="#屏蔽掉长按事件-因为webview长按时将会调用系统的复制控件" class="headerlink" title="屏蔽掉长按事件 因为webview长按时将会调用系统的复制控件"></a>屏蔽掉长按事件 因为webview长按时将会调用系统的复制控件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setOnLongClickListener(<span class="keyword">new</span> OnLongClickListener() &#123;  </span><br><span class="line">            </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="在WebView加入-flash支持"><a href="#在WebView加入-flash支持" class="headerlink" title="在WebView加入 flash支持"></a>在WebView加入 flash支持</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String temp = <span class="string">"&lt;html&gt;&lt;body bgcolor=\""</span> + <span class="string">"black"</span>  </span><br><span class="line">                + <span class="string">"\"&gt; &lt;br/&gt;&lt;embed src=\""</span> + url + <span class="string">"\" width=\""</span> + <span class="string">"100%"</span>  </span><br><span class="line">                + <span class="string">"\" height=\""</span> + <span class="string">"90%"</span> + <span class="string">"\" scale=\""</span> + <span class="string">"noscale"</span>  </span><br><span class="line">                + <span class="string">"\" type=\""</span> + <span class="string">"application/x-shockwave-flash"</span>  </span><br><span class="line">                + <span class="string">"\"&gt; &lt;/embed&gt;&lt;/body&gt;&lt;/html&gt;"</span>;  </span><br><span class="line">String mimeType = <span class="string">"text/html"</span>;  </span><br><span class="line">String encoding = <span class="string">"utf-8"</span>;  </span><br><span class="line">web.loadDataWithBaseURL(<span class="string">"null"</span>, temp, mimeType, encoding, <span class="string">""</span>);</span><br></pre></td></tr></table></figure>
<h1 id="WebView保留缩放功能但隐藏缩放控件"><a href="#WebView保留缩放功能但隐藏缩放控件" class="headerlink" title="WebView保留缩放功能但隐藏缩放控件:"></a>WebView保留缩放功能但隐藏缩放控件:</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mWebView.getSettings().setSupportZoom(<span class="keyword">true</span>);  </span><br><span class="line">mWebView.getSettings().setBuiltInZoomControls(<span class="keyword">true</span>);  </span><br><span class="line"><span class="keyword">if</span> (DeviceUtils.hasHoneycomb())  </span><br><span class="line">    mWebView.getSettings().setDisplayZoomControls(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<h1 id="正确关闭-WebView-同时解决-WebView页面中播放了音频-退出Activity后音频仍然在播放"><a href="#正确关闭-WebView-同时解决-WebView页面中播放了音频-退出Activity后音频仍然在播放" class="headerlink" title="正确关闭 WebView 同时解决 WebView页面中播放了音频,退出Activity后音频仍然在播放"></a>正确关闭 WebView 同时解决 WebView页面中播放了音频,退出Activity后音频仍然在播放</h1><p>Activity <code>onDestory</code> 方法中执行下面代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mWebView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mWebView.loadDataWithBaseURL(<span class="keyword">null</span>, <span class="string">""</span>, <span class="string">"text/html"</span>, <span class="string">"utf-8"</span>, <span class="keyword">null</span>);</span><br><span class="line">        mWebView.clearHistory();</span><br><span class="line"></span><br><span class="line">        ((ViewGroup) mWebView.getParent()).removeView(mWebView);</span><br><span class="line">        mWebView.destroy();</span><br><span class="line">        mWebView = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="加载网页方式"><a href="#加载网页方式" class="headerlink" title="加载网页方式"></a>加载网页方式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载一个网页：</span></span><br><span class="line">webView.loadUrl(<span class="string">"http://www.google.com/"</span>);</span><br><span class="line"><span class="comment">//加载apk包中的一个html页面</span></span><br><span class="line">webView.loadUrl(<span class="string">"file:///android_asset/test.html"</span>);</span><br><span class="line"><span class="comment">//加载手机本地的一个html页面的方法：</span></span><br><span class="line">webView.loadUrl(<span class="string">"content://com.android.htmlfileprovider/sdcard/test.html"</span>);</span><br></pre></td></tr></table></figure>
<p>#　WebView的状态：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onResume() <span class="comment">//激活WebView为活跃状态，能正常执行网页的响应</span></span><br><span class="line">onPause()<span class="comment">//当页面被失去焦点被切换到后台不可见状态，需要执行onPause动过， onPause动作通知内核暂停所有的动作，比如DOM的解析、plugin的执行、JavaScript执行。</span></span><br><span class="line"></span><br><span class="line">pauseTimers()<span class="comment">//当应用程序被切换到后台我们使用了webview， 这个方法不仅仅针对当前的webview而是全局的全应用程序的webview，它会暂停所有webview的layout，parsing，javascripttimer。降低CPU功耗。</span></span><br><span class="line">resumeTimers()<span class="comment">//恢复pauseTimers时的动作。</span></span><br><span class="line"></span><br><span class="line">destroy()<span class="comment">//销毁，关闭了Activity时，音乐或视频，还在播放。就必须销毁。</span></span><br></pre></td></tr></table></figure>
<p>但是注意：webview调用destory时,webview仍绑定在Activity上.这是由于自定义webview构建时传入了该Activity的context对象,因此需要先从父容器中移除webview,然后再销毁webview:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootLayout.removeView(webView);</span><br><span class="line">webView.destroy();</span><br></pre></td></tr></table></figure>
<h1 id="避免WebView内存泄露的一些方式"><a href="#避免WebView内存泄露的一些方式" class="headerlink" title="避免WebView内存泄露的一些方式"></a>避免WebView内存泄露的一些方式</h1><ol>
<li>可以将 Webview 的 Activity 新起一个进程，结束的时候直接System.exit(0);退出当前进程；</li>
</ol>
<p>启动新进程，主要代码： AndroidManifest.xml 配置文件代码如下</p>
<pre><code>&lt;activity
android:name=&quot;.ui.activity.Html5Activity&quot;
android:process=&quot;:lyl.boon.process.web&quot;&gt;
&lt;intent-filter&gt;
    &lt;action android:name=&quot;com.lyl.boon.ui.activity.htmlactivity&quot;/&gt;
    &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre><p>在新进程中启动 Activity ，里面传了 一个 Url：</p>
<pre><code>Intent intent = new Intent(&quot;com.lyl.boon.ui.activity.htmlactivity&quot;);
Bundle bundle = new Bundle();
bundle.putString(&quot;url&quot;, gankDataEntity.getUrl());
intent.putExtra(&quot;bundle&quot;,bundle);
startActivity(intent);
</code></pre><p>然后在 Html5Activity 的 onDestory() 最后加上 System.exit(0); 杀死当前进程。</p>
<ol start="2">
<li><p>不能在xml中定义 Webview ，而是在需要的时候创建，并且Context使用 getApplicationgContext()，如下代码：</p>
<pre><code>LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);
mWebView = new WebView(getApplicationContext());
mWebView.setLayoutParams(params);
mLayout.addView(mWebView);
</code></pre></li>
<li><p>在 Activity 销毁的时候，可以先让 WebView 加载null内容，然后移除 WebView，再销毁 WebView，最后置空。</p>
<pre><code>@Override
protected void onDestroy() {
if (mWebView != null) {
    mWebView.loadDataWithBaseURL(null, &quot;&quot;, &quot;text/html&quot;, &quot;utf-8&quot;, null);
    mWebView.clearHistory();

    ((ViewGroup) mWebView.getParent()).removeView(mWebView);
    mWebView.destroy();
    mWebView = null;
}
super.onDestroy();
}
</code></pre></li>
</ol>
<hr>
<h2 id="WebViewClient"><a href="#WebViewClient" class="headerlink" title="WebViewClient"></a>WebViewClient</h2><blockquote>
<p>WebViewClient就是帮助WebView处理各种通知、请求事件的。</p>
</blockquote>
<h3 id="WebViewClient-方法"><a href="#WebViewClient-方法" class="headerlink" title="WebViewClient 方法"></a>WebViewClient 方法</h3><pre><code>WebViewClient mWebViewClient = new WebViewClient()
{
    shouldOverrideUrlLoading(WebView view, String url)  最常用的，比如上面的。
    //在网页上的所有加载都经过这个方法,这个函数我们可以做很多操作。
    //比如获取url，查看url.contains(“add”)，进行添加操作

    shouldOverrideKeyEvent(WebView view, KeyEvent event)
    //重写此方法才能够处理在浏览器中的按键事件。 

    onPageStarted(WebView view, String url, Bitmap favicon) 
    //这个事件就是开始载入页面调用的，我们可以设定一个loading的页面，告诉用户程序在等待网络响应。 

    onPageFinished(WebView view, String url)
    //在页面加载结束时调用。同样道理，我们可以关闭loading 条，切换程序动作。 

    onLoadResource(WebView view, String url) 
    // 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次。 

    onReceivedError(WebView view, int errorCode, String description, String failingUrl)
    // (报告错误信息) 

    doUpdateVisitedHistory(WebView view, String url, boolean isReload)  
    //(更新历史记录) 

    onFormResubmission(WebView view, Message dontResend, Message resend) 
    //(应用程序重新请求网页数据) 

    onReceivedHttpAuthRequest(WebView view, HttpAuthHandler handler, String host,String realm)
    //（获取返回信息授权请求） 

    onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) 
    //重写此方法可以让webview处理https请求。

    onScaleChanged(WebView view, float oldScale, float newScale) 
    // (WebView发生改变时调用) 

    onUnhandledKeyEvent(WebView view, KeyEvent event) 
    //（Key事件未被加载时调用） 
}
</code></pre><p>将上面定义的WebViewClient设置给WebView：</p>
<pre><code>webView.setWebViewClient(mWebViewClient);
</code></pre><h2 id="WebChromeClient"><a href="#WebChromeClient" class="headerlink" title="WebChromeClient"></a>WebChromeClient</h2><blockquote>
<p>WebChromeClient是辅助WebView处理Javascript的对话框，网站图标，网站title，加载进度等 :<br>方法中的代码都是由Android端自己处理。</p>
</blockquote>
<pre><code>WebChromeClient mWebChromeClient = new WebChromeClient() {


    //获得网页的加载进度，显示在右上角的TextView控件中
    @Override
    public void onProgressChanged(WebView view, int newProgress) {
    if (newProgress &lt; 100) {
        String progress = newProgress + &quot;%&quot;;
    } else {
    }
    }

    //获取Web页中的title用来设置自己界面中的title
    //当加载出错的时候，比如无网络，这时onReceiveTitle中获取的标题为 找不到该网页,
    //因此建议当触发onReceiveError时，不要使用获取到的title
    @Override
    public void onReceivedTitle(WebView view, String title) {
    MainActivity.this.setTitle(title);
    }

    @Override
    public void onReceivedIcon(WebView view, Bitmap icon) {
    //
    }

    @Override
    public boolean onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg) {
    //
    return true;
    }

    @Override
    public void onCloseWindow(WebView window) {
    }

    //处理alert弹出框，html 弹框的一种方式
    @Override
    public boolean onJsAlert(WebView view, String url, String message, JsResult result) {
    //
    return true;
    }

    //处理confirm弹出框
    @Override
    public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult 
        result) {
    //
    return true;
    }

    //处理prompt弹出框
    @Override
    public boolean onJsConfirm(WebView view, String url, String message, JsResult result) {
    //
    return true;
    }
};
</code></pre><p>同样，将上面定义的WebChromeClient设置给WebView：</p>
<pre><code>webView.setWebChromeClient(mWebChromeClient);
</code></pre><h2 id="一个Activity实例"><a href="#一个Activity实例" class="headerlink" title="一个Activity实例"></a>一个Activity实例</h2><p>public class Html5Activity extends AppCompatActivity {</p>
<pre><code>private String mUrl;

private LinearLayout mLayout;
private WebView mWebView;


@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_web);

    Bundle bundle = getIntent().getBundleExtra(&quot;bundle&quot;);
    mUrl = bundle.getString(&quot;url&quot;);

    Log.d(&quot;Url:&quot;, mUrl);

    mLayout = (LinearLayout) findViewById(R.id.web_layout);


    LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);
    mWebView = new WebView(getApplicationContext());
    mWebView.setLayoutParams(params);
    mLayout.addView(mWebView);

    WebSettings mWebSettings = mWebView.getSettings();
    mWebSettings.setSupportZoom(true);
    mWebSettings.setLoadWithOverviewMode(true);
    mWebSettings.setUseWideViewPort(true);
    mWebSettings.setDefaultTextEncodingName(&quot;utf-8&quot;);
    mWebSettings.setLoadsImagesAutomatically(true);

    //调用JS方法.安卓版本大于17,加上注解 @JavascriptInterface
    mWebSettings.setJavaScriptEnabled(true);

    saveData(mWebSettings);

    newWin(mWebSettings);

    mWebView.setWebChromeClient(webChromeClient);
    mWebView.setWebViewClient(webViewClient);
    mWebView.loadUrl(mUrl);
}

/**
 * 多窗口的问题
 */
private void newWin(WebSettings mWebSettings) {
    //html中的_bank标签就是新建窗口打开，有时会打不开，需要加以下
    //然后 复写 WebChromeClient的onCreateWindow方法
    mWebSettings.setSupportMultipleWindows(true);
    mWebSettings.setJavaScriptCanOpenWindowsAutomatically(true);
}


/**
 * HTML5数据存储
 */
private void saveData(WebSettings mWebSettings) {
    //有时候网页需要自己保存一些关键数据,Android WebView 需要自己设置
    mWebSettings.setDomStorageEnabled(true);
    mWebSettings.setDatabaseEnabled(true);
    mWebSettings.setAppCacheEnabled(true);
    String appCachePath = getApplicationContext().getCacheDir().getAbsolutePath();
    mWebSettings.setAppCachePath(appCachePath);
}

WebViewClient webViewClient = new WebViewClient(){

    /**
     * 多页面在同一个WebView中打开，就是不新建activity或者调用系统浏览器打开
     */
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {
        view.loadUrl(url);
        return true;
    }

};

WebChromeClient webChromeClient = new WebChromeClient() {

    //=========HTML5定位==========================================================
    //需要先加入权限
    //&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
    //&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;
    //&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;
    @Override
    public void onReceivedIcon(WebView view, Bitmap icon) {
        super.onReceivedIcon(view, icon);
    }

    @Override
    public void onGeolocationPermissionsHidePrompt() {
        super.onGeolocationPermissionsHidePrompt();
    }

    @Override
    public void onGeolocationPermissionsShowPrompt(final String origin, final GeolocationPermissions.Callback callback) {
        callback.invoke(origin, true, false);//注意个函数，第二个参数就是是否同意定位权限，第三个是是否希望内核记住
        super.onGeolocationPermissionsShowPrompt(origin, callback);
    }
    //=========HTML5定位==========================================================


    //=========多窗口的问题==========================================================
    @Override
    public boolean onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg) {
        WebView.WebViewTransport transport = (WebView.WebViewTransport) resultMsg.obj;
        transport.setWebView(mWebView);
        resultMsg.sendToTarget();
        return true;
    }
    //=========多窗口的问题==========================================================
};


@Override
public boolean onKeyDown(int keyCode, KeyEvent event) {
    if (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; mWebView.canGoBack()) {
        mWebView.goBack();
        return true;
    }

    return super.onKeyDown(keyCode, event);
}

@Override
protected void onDestroy() {
    if (mWebView != null) {
        mWebView.loadDataWithBaseURL(null, &quot;&quot;, &quot;text/html&quot;, &quot;utf-8&quot;, null);
        mWebView.clearHistory();

        ((ViewGroup) mWebView.getParent()).removeView(mWebView);
        mWebView.destroy();
        mWebView = null;
    }
    super.onDestroy();
}
</code></pre><p>}</p>
<h1 id="WebViewFragment"><a href="#WebViewFragment" class="headerlink" title="WebViewFragment"></a>WebViewFragment</h1><h1 id="webview-没有虚拟键盘"><a href="#webview-没有虚拟键盘" class="headerlink" title="webview 没有虚拟键盘"></a>webview 没有虚拟键盘</h1><p>构造方法写法有问题</p>
<p>错误写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Web3View</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="http://www.jianshu.com/users/320f9e8f7fc9/latest_articles" target="_blank" rel="noopener">http://www.jianshu.com/users/320f9e8f7fc9/latest_articles</a></li>
<li><a href="http://blog.csdn.net/u011200604/article/details/52767304" target="_blank" rel="noopener">http://blog.csdn.net/u011200604/article/details/52767304</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/WebView/" rel="tag"># WebView</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/15/Android/view/WebView/WebView js 交互/" rel="next" title="WebView js交互">
                <i class="fa fa-chevron-left"></i> WebView js交互
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/15/Android/网络/网络协议/" rel="prev" title="网络协议">
                网络协议 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/head1.jpg" alt="Double">
          <p class="site-author-name" itemprop="name">Double</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">548</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">260</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Modern-WebView-Best-Practices"><span class="nav-number">1.</span> <span class="nav-text">Modern WebView Best Practices</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-breif-WebView-history"><span class="nav-number">1.1.</span> <span class="nav-text">A breif WebView history</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于版本兼容问题"><span class="nav-number">1.2.</span> <span class="nav-text">关于版本兼容问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何使用-AndroidX"><span class="nav-number">1.3.</span> <span class="nav-text">如何使用 AndroidX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loading-in-app-content"><span class="nav-number">1.4.</span> <span class="nav-text">Loading in-app content</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView-属性的设置"><span class="nav-number">2.</span> <span class="nav-text">WebView 属性的设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#通过-WebSettings-设置"><span class="nav-number">2.1.</span> <span class="nav-text">通过 WebSettings 设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置WebViewClient子类"><span class="nav-number">2.2.</span> <span class="nav-text">设置WebViewClient子类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置当前网页的链接仍在-WebView-中跳转，而不是跳到手机浏览器里显示"><span class="nav-number">2.2.1.</span> <span class="nav-text">设置当前网页的链接仍在 WebView 中跳转，而不是跳到手机浏览器里显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置开始加载网页、加载完成、加载错误时处理"><span class="nav-number">2.2.2.</span> <span class="nav-text">设置开始加载网页、加载完成、加载错误时处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WebView-在Android4-4的手机上onPageFinished-回调会多调用一次"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">WebView 在Android4.4的手机上onPageFinished()回调会多调用一次</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理https请求，为WebView处理ssl证书设置"><span class="nav-number">2.2.3.</span> <span class="nav-text">处理https请求，为WebView处理ssl证书设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#前进-后退"><span class="nav-number">3.</span> <span class="nav-text">前进 后退</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现方法一"><span class="nav-number">3.1.</span> <span class="nav-text">实现方法一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现方法二"><span class="nav-number">3.2.</span> <span class="nav-text">实现方法二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView-与-js-交互"><span class="nav-number">4.</span> <span class="nav-text">WebView 与 js 交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-addJavascriptInterface-完成和-js-交互"><span class="nav-number">4.1.</span> <span class="nav-text">使用 addJavascriptInterface 完成和 js 交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Js-中调-Native-本地-Java-方法"><span class="nav-number">4.1.1.</span> <span class="nav-text">Js 中调 Native 本地 Java 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java调Js方法"><span class="nav-number">4.1.2.</span> <span class="nav-text">Java调Js方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView-缓存模式的设置"><span class="nav-number">5.</span> <span class="nav-text">WebView 缓存模式的设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#网页数据缓存"><span class="nav-number">5.1.</span> <span class="nav-text">网页数据缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#H5缓存"><span class="nav-number">5.2.</span> <span class="nav-text">H5缓存</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#加快HTML网页加载完成速度"><span class="nav-number">6.</span> <span class="nav-text">加快HTML网页加载完成速度</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView-硬件加速导致页面渲染闪烁问题解决方法"><span class="nav-number">7.</span> <span class="nav-text">WebView 硬件加速导致页面渲染闪烁问题解决方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为WebView自定义错误显示界面"><span class="nav-number">8.</span> <span class="nav-text">为WebView自定义错误显示界面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView-cookies清理："><span class="nav-number">9.</span> <span class="nav-text">WebView cookies清理：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#清理cache-和历史记录"><span class="nav-number">10.</span> <span class="nav-text">清理cache 和历史记录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#屏蔽掉长按事件-因为webview长按时将会调用系统的复制控件"><span class="nav-number">11.</span> <span class="nav-text">屏蔽掉长按事件 因为webview长按时将会调用系统的复制控件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在WebView加入-flash支持"><span class="nav-number">12.</span> <span class="nav-text">在WebView加入 flash支持</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebView保留缩放功能但隐藏缩放控件"><span class="nav-number">13.</span> <span class="nav-text">WebView保留缩放功能但隐藏缩放控件:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#正确关闭-WebView-同时解决-WebView页面中播放了音频-退出Activity后音频仍然在播放"><span class="nav-number">14.</span> <span class="nav-text">正确关闭 WebView 同时解决 WebView页面中播放了音频,退出Activity后音频仍然在播放</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#加载网页方式"><span class="nav-number">15.</span> <span class="nav-text">加载网页方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#避免WebView内存泄露的一些方式"><span class="nav-number">16.</span> <span class="nav-text">避免WebView内存泄露的一些方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WebViewClient"><span class="nav-number">16.1.</span> <span class="nav-text">WebViewClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebViewClient-方法"><span class="nav-number">16.1.1.</span> <span class="nav-text">WebViewClient 方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebChromeClient"><span class="nav-number">16.2.</span> <span class="nav-text">WebChromeClient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个Activity实例"><span class="nav-number">16.3.</span> <span class="nav-text">一个Activity实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebViewFragment"><span class="nav-number">17.</span> <span class="nav-text">WebViewFragment</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webview-没有虚拟键盘"><span class="nav-number">18.</span> <span class="nav-text">webview 没有虚拟键盘</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Double</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
